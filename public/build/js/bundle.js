var melisCms=function(){function e(e,t,i){0===e?($("#"+i+" .form-group label").css("color","#686868"),$.each(t,function(e,t){$("#"+i+" .form-control[name='"+e+"']").prev("label").css("color","red")})):$("#"+i+" .form-group label").css("color","#686868")}function t(){var e=$(this).data("pagenumber");melisHelper.tabClose("0_id_meliscms_page"),melisHelper.tabOpen(translations.tr_meliscms_page_creation,"fa-file-text-o","0_id_meliscms_page","meliscms_page_creation",{idPage:0,idFatherPage:e})}function i(t){var i="string"==typeof t?t:$(this).data("pagenumber"),a=$(this).data("fatherpageid"),s=$("#"+i+"_id_meliscms_page form").serializeArray();if($("#"+i+"_id_page_taxonomy").length){var o=$("#"+i+"_id_page_taxonomy").data("tags").toString();s.push({name:"page_taxonomy",value:o})}s=$.param(s),$.ajax({type:"POST",url:"/melis/MelisCms/Page/savePage?idPage="+i+"&fatherPageId="+a,data:s,dataType:"json",encode:!0}).success(function(t){if(1===t.success){m(t.datas.idPage),melisHelper.melisOkNotification(t.textTitle,t.textMessage,"#72af46"),e(t.success,t.errors,t.datas.item_zoneid);var a=t.datas.item_zoneid;if("0_id_meliscms_page"===a){melisHelper.tabClose(a);var s=t.datas.idPage+a.substring(1,a.length);melisHelper.tabOpen(t.datas.item_name,t.datas.item_icon,s,t.datas.item_melisKey,{idPage:t.datas.idPage})}else melisHelper.zoneReload(i+"_id_meliscms_page","meliscms_page",{idPage:i})}else melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors,"#000"),e(t.success,t.errors,t.datas.item_zoneid);melisCore.flashMessenger()}).error(function(e,t,i){alert(translations.tr_meliscore_error_message)})}function a(t){var i="string"==typeof t?t:$(this).data("pagenumber"),a=$("#"+i+"_id_meliscms_page form").serializeArray();if($("#"+i+"_id_page_taxonomy").length){var s=$("#"+i+"_id_page_taxonomy").data("tags").toString();a.push({name:"page_taxonomy",value:s})}a=$.param(a),$.ajax({type:"POST",url:"/melis/MelisCms/Page/publishPage?idPage="+i,data:a,dataType:"json",encode:!0}).success(function(t){1===t.success?(m(t.datas.idPage),$(".page-publishunpublish").bootstrapSwitch("setState",!0,!0),melisHelper.melisOkNotification(t.textTitle,t.textMessage,"#72af46"),e(t.success,t.errors,t.datas.item_zoneid),melisCore.flashMessenger(),$("#"+t.datas.item_zoneid+" .page-title h1:not('span')").text(t.datas.item_name),$(".tabsbar a[data-id='"+t.datas.item_zoneid+"'] .navtab-pagename").text(t.datas.item_name),$("#"+t.datas.item_zoneid+" .page-title .saved-version-notif").fadeOut(),melisHelper.zoneReload(i+"_id_meliscms_page","meliscms_page",{idPage:i})):(melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors,"#000"),e(t.success,t.errors,t.datas.item_zoneid)),melisCore.flashMessenger()}).error(function(e,t,i){alert(translations.tr_meliscore_error_message)})}function s(e){var t="string"==typeof e?e:$(this).data("pagenumber");$.ajax({type:"GET",url:"/melis/MelisCms/Page/unpublishPage?idPage="+t,dataType:"json",encode:!0}).success(function(e){1===e.success?(m(t),melisHelper.melisOkNotification(e.textTitle,e.textMessage,"#72af46"),melisCore.flashMessenger()):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,"#000"),melisCore.flashMessenger(),melisHelper.zoneReload(t+"_id_meliscms_page","meliscms_page",{idPage:t})}).error(function(e,t,i){alert(translations.tr_meliscore_error_message)})}function o(){var e=$(this).data(),t=e.pagenumber,i=(activeTabId,e.confirmmsg);melisCoreTool.confirm(translations.tr_meliscms_page_action_clear,translations.tr_meliscms_menu_cancel,translations.tr_meliscms_delete_saved_page_title,i,function(){$.ajax({type:"GET",url:"/melis/MelisCms/Page/clearSavedPage?idPage="+t,encode:!0}).success(function(e){1===e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage,"#72af46"),melisCms.refreshTreeview(t),melisCore.flashMessenger(),melisHelper.zoneReload(t+"_id_meliscms_page","meliscms_page",{idPage:t})):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,"#000")}).error(function(e,t,i){alert(translations.tr_meliscore_error_message)})})}function l(){var e=$(this).data(),t=e.pagenumber,i=activeTabId,a=$(this).attr("disabled");void 0!==a&&!1!==a||melisCoreTool.confirm(translations.tr_meliscms_menu_delete,translations.tr_meliscms_menu_cancel,translations.tr_meliscms_delete_confirmation,translations.tr_meliscms_delete_confirmation_msg,function(){melisCms.refreshTreeview(t),$.ajax({url:"/melis/MelisCms/Page/deletePage?idPage="+t,encode:!0}).success(function(e){1===e.success?(melisHelper.tabClose(i),melisHelper.melisOkNotification(e.textTitle,e.textMessage,"#72af46"),melisCore.flashMessenger()):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,"#000")}).error(function(e,t,i){alert(translations.tr_meliscore_error_message)})})}function n(e){$("div.make-switch label on, off").parent().css("z-index",-1).parents("div.make-switch").css("opacity",.5),$("#"+e+"_id_meliscms_page_action_tabs").addClass("relative").prepend("<li class='btn-disabled'></li>")}function r(e){$("#"+e+"_action_tabs").removeClass("relative"),$("#"+e+"_action_tabs li.btn-disabled").remove(),$("div.make-switch label on, off").parent().css("z-index",1).parents("div.make-switch").css("opacity",1)}function m(e,t){optionalArg=void 0===t?0:t,$.ajax({url:"/melis/MelisCms/TreeSites/getPageIdBreadcrumb?idPage="+e+"&includeSelf="+optionalArg,encode:!0,dataType:"json"}).success(function(e){var t,i=[];$.each(e,function(e,a){i.push("/"+a),0===e&&(t=a)}),i=i.toString(),i=i.replace(/,/g,"");var a=$("#id-mod-menu-dynatree").fancytree("getTree");a.reload({url:"/melis/MelisCms/TreeSites/get-tree-pages-by-page-id"}).done(function(){a.loadKeyPath(i,function(e,t){"ok"==t&&e.setActive(!0).done(function(){e.setExpanded(!0)})}).done(function(){a.clearFilter(),!1===$("#id-mod-menu-dynatree .ui-fancytree > li:last-child").hasClass("fancytree-lastsib")&&$("#id-mod-menu-dynatree .ui-fancytree > li:last-child").remove()})})}).error(function(e,t,i){alert(translations.tr_meliscore_error_message)})}function d(){var e=0,t=$(this).data("display");$(".displaysettingsicon span.fa").removeClass(),$(".displaysettingsicon span:first-child").addClass(t),e="fa fa-desktop"===t?"100%":"fa fa-tablet"===t?"980px":"480px",$(this).parents(".page-head-container").next(".page-content-container").find(".melis-iframe").animate({width:e},300,function(){$("#"+activeTabId+" .melis-iframe").css("height","1000px");var e=$("#"+activeTabId+" .melis-iframe").contents().height()+20;$("#"+activeTabId+" .melis-iframe").css("height",e)})}function c(e,t){var i=$(this).data("pagenumber").toString();!0===t.value?a(i):s(i)}function _(e){var t=$(this).val().length,i=$(this).prev("label");i.find("span").length?0===t&&(i.removeClass("limit"),i.find("span").remove()):0!==t&&i.append("<span class='text-counter-indicator'><i class='fa fa-text-width'></i>("+t+")</span>")}function p(){$("form[name='pageseo'] input[name='pseo_meta_title']").trigger("keyup"),$("form[name='pageseo'] input[textarea='pseo_meta_description']").trigger("keyup");var e=$("#"+activeTabId+" .melis-iframe").contents().height()+20;$("#"+activeTabId+" .melis-iframe").css("height",e)}function g(){var e=$(this).parents(".melis-page-table-cont"),t=e.attr("id"),i=e.data("meliskey"),a=e.data("page-id");melisHelper.zoneReload(t,i,{idPage:a})}function n(e){$("#"+activeTabId+" .page-publishunpublish").append("<div class='overlay-switch' style='width: 100%;height: 100%;position: absolute;top: 0;left: 0;z-index: 99999999;cursor: wait; '></div>"),$("#"+e+"_id_meliscms_page_action_tabs").addClass("relative").prepend("<li class='btn-disabled'></li>")}function r(e){$("#"+e+"_action_tabs").removeClass("relative"),$("#"+e+"_action_tabs li.btn-disabled").remove(),$("#"+activeTabId+" .overlay-switch").remove()}function f(){var e=$("#"+activeTabId+" .melis-iframe").contents().height();$("#"+activeTabId+" .melis-iframe").css("height",e),$("#"+activeTabId+" .melis-iframe").css("min-height","700px"),melisCms.enableCmsButtons(activeTabId),$.ajax({url:"/melis/MelisCms/TreeSites/canEditPages",encode:!0}).success(function(e){var t=$("#id-mod-menu-dynatree").fancytree("getTree");0===e.edit?($(".meliscms-search-box.sidebar-treeview-search").hide(),$("#id-mod-menu-dynatree").prepend("<div class='create-newpage'><span class='no-access'>"+translations.tr_meliscms_no_access+"</span></div>")):0===t.count()?($(".meliscms-search-box.sidebar-treeview-search").hide(),$("#id-mod-menu-dynatree").prepend("<div class='create-newpage'><span class='btn btn-success'>"+translations.tr_meliscms_create_page+"</span></div>")):($(".meliscms-search-box.sidebar-treeview-search").show(),$("#id-mod-menu-dynatree .create-newpage").remove())}).error(function(e,t,i){alert(translations.tr_meliscore_error_message)}),$.ajax({url:"/melis/MelisCms/Page/isActionActive?actionwanted=save",encode:!0}).success(function(e){0===e.active?$("body").addClass("disable-create"):$("body").removeClass("disable-create")}).error(function(e,t,i){alert(translations.tr_meliscore_error_message)}),$.ajax({url:"/melis/MelisCms/Page/isActionActive?actionwanted=delete",encode:!0}).success(function(e){0===e.active?$("body").addClass("disable-delete"):$("body").removeClass("disable-delete")}).error(function(e,t,i){alert(translations.tr_meliscore_error_message)})}var u,h=$("body");return window.scrollToViewTinyMCE=function(e,t){if(u=$(window).scrollTop(),!e||!t)return u;var i=t/2-e;$("html, body").animate({scrollTop:i},300)},window.scrollOffsetTinyMCE=function(){return u},$("body").on("click",".mce-btn",function(){if($("#mce-modal-block").length)if($("iframe.melis-iframe").length){$("iframe.melis-iframe").position().top,$("iframe.melis-iframe").height();var e=screen.height;bodyOffsetTop=$(window)[0].scrollHeight;var t=$(".mce-window").outerHeight(),i=bodyOffsetTop+e-t;$(".mce-floatpanel.mce-window").css("top",i),$("html, body").animate({scrollTop:i},300)}else $("#mce-modal-block").css("z-index",1049),$(".mce-floatpanel.mce-window").css("z-index",1050)}),melisCore.screenSize>=768&&(jQuery(window).scroll(function(){var e=$("body").hasClass("sidebar-mini"),t=0;e||(t=$("#id_meliscore_leftmenu").outerWidth());var i=$("#"+activeTabId+" div.page-title").outerHeight();jQuery(window).scrollTop()>i&&melisCore.screenSize>1120?($("#"+activeTabId+" .page-head-container").css("padding-top","72px"),$("#"+activeTabId+" .page-head-container > .innerAll").addClass("sticky-pageactions"),$("#"+activeTabId+" .page-head-container > .innerAll").css({width:h.width()-t,left:t})):($("#"+activeTabId+" .page-head-container").removeAttr("style"),$("#"+activeTabId+" .page-head-container > .innerAll").removeClass("sticky-pageactions"),$("#"+activeTabId+" .page-head-container > .innerAll").removeAttr("style"))}),$("body.show-breadcrumb.show-nav-tabs").scroll(function(){var e=$("body").hasClass("sidebar-mini"),t=0;e||(t=$("#id_meliscore_leftmenu").outerWidth());var i=$("#"+activeTabId+" div.page-title"),a=$("#"+activeTabId+" div[data-meliskey='meliscms_pagehead_title']");i.length&&(i=Math.abs(i.offset().top)),a.length&&(a=$("#"+activeTabId+" div[data-meliskey='meliscms_pagehead_title']").offset().top);$("#"+activeTabId+" div.page-title").outerHeight();a<=0&&melisCore.screenSize>1120?($("#"+activeTabId+" .page-head-container").css("padding-top","61px"),$("#"+activeTabId+" .page-head-container > .innerAll").addClass("sticky-pageactions"),$("#"+activeTabId+" .page-head-container > .innerAll").css({width:h.width()-t,left:t})):($("#"+activeTabId+" .page-head-container").removeAttr("style"),$("#"+activeTabId+" .page-head-container > .innerAll").removeClass("sticky-pageactions"),$("#"+activeTabId+" .page-head-container > .innerAll").removeAttr("style"))})),h.on("click",".melis-newpage",t),h.on("click",".melis-savepage",i),h.on("click",".melis-clearpage",o),h.on("click",".melis-publishpage",a),h.on("click",".melis-unpublishpage",s),h.on("click",".melis-deletepage",l),h.on("click",".display-settings",d),h.on("switch-change",".page-publishunpublish",c),h.on("keyup keydown change","form[name='pageseo'] input[name='pseo_meta_title']",_),h.on("keyup keydown change","form[name='pageseo'] textarea[name='pseo_meta_description']",_),h.on("shown.bs.tab",".page-content-container .widget-head.nav ul li a",p),h.on("shown.bs.tab",".melis-refreshPageTable",g),{savePage:i,publishPage:a,unpublishPage:s,refreshTreeview:m,disableCmsButtons:n,enableCmsButtons:r,iframeLoad:f}}();!function(e,t,i){e(t).on("load",function(){t.mainTree=function(t){var i;i=melisCore.screenSize<=767?["contextMenu","filter"]:["contextMenu","dnd","filter"],e("#id-mod-menu-dynatree").fancytree({extensions:i,activeVisible:!1,debugLevel:0,autoScroll:!0,generateIds:!0,idPrefix:"mt_",tabindex:"",toggleEffect:{height:"toggle",duration:250},source:{url:"/melis/MelisCms/TreeSites/get-tree-pages-by-page-id",cache:!0},contextMenu:{menu:{new:{name:translations.tr_meliscms_menu_new,icon:"paste"},edit:{name:translations.tr_meliscms_menu_edit,icon:"edit"},delete:{name:translations.tr_meliscms_menu_delete,icon:"delete"},dupe:{name:translations.tr_meliscms_menu_dupe,icon:"copy"}},actions:function(t,i,a){if("new"===i){var s=t.data;melisHelper.tabClose("0_id_meliscms_page"),melisHelper.tabOpen(translations.tr_meliscms_page_creation,"fa-file-text-o","0_id_meliscms_page","meliscms_page_creation",{idPage:0,idFatherPage:s.melisData.page_id})}if("edit"===i){var s=t.data;melisHelper.tabOpen(s.melisData.page_title,s.iconTab,s.melisData.item_zoneid,s.melisData.item_melisKey,{idPage:s.melisData.page_id})}if("delete"===i){var s=t.data,o=s.melisData.item_zoneid,l=s.melisData.page_id,n="root_1"==t.getParent().key?-1:t.getParent().key,r=e(".tabsbar a[data-id='"+o+"']").parent("li");melisCoreTool.confirm(translations.tr_meliscms_menu_delete,translations.tr_meliscms_menu_cancel,translations.tr_meliscms_delete_confirmation,translations.tr_meliscms_delete_confirmation_msg,function(){melisCms.refreshTreeview(n,1),e.ajax({url:"/melis/MelisCms/Page/deletePage?idPage="+l,encode:!0}).success(function(e){1===e.success?(1===r.length&&melisHelper.tabClose(o),melisHelper.melisOkNotification(e.textTitle,e.textMessage,"#72af46"),melisCore.flashMessenger()):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,"#000")}).error(function(e,t,i){alert(translations.tr_meliscore_error_message)})})}if("dupe"===i){var s=t.data;o="id_meliscms_tools_tree_modal_form_handler",melisKey="meliscms_tools_tree_modal_form_handler",modalUrl="melis/MelisCms/TreeSites/renderTreeSitesModalContainer",melisHelper.createModal(o,melisKey,!1,{sourcePageId:s.melisData.page_id},modalUrl,function(){})}}},lazyLoad:function(e,t){var i=t.node.data.melisData.page_id;t.result={url:"/melis/MelisCms/TreeSites/get-tree-pages-by-page-id?nodeId="+i,data:{mode:"children",parent:t.node.key},cache:!1}},create:function(t,i){melisHelper.loadingZone(e("#treeview-container"))},init:function(t,i,a){melisHelper.removeLoadingZone(e("#treeview-container")),e("input[name=left_tree_search]").focus(),0===e("#id-mod-menu-dynatree").fancytree("getTree").count()?(e(".meliscms-search-box.sidebar-treeview-search").hide(),e.get("/melis/MelisCms/TreeSites/checkUserPageTreeAccress",{idPage:-1},function(t){t.isAccessible&&e("#id-mod-menu-dynatree").prepend("<div class='create-newpage'><span class='btn btn-success'>"+translations.tr_meliscms_create_page+"</span></div>")})):(e(".meliscms-search-box.sidebar-treeview-search").show(),e("#id-mod-menu-dynatree .create-newpage").remove())},click:function(t,i){if(targetType=i.targetType,"title"===targetType&&(i.node.setExpanded(),melisCore.screenSize<=1024)){var i=i.node.data;melisHelper.tabOpen(i.melisData.page_title,i.iconTab,i.melisData.item_zoneid,i.melisData.item_melisKey,{idPage:i.melisData.page_id})}e(".hasNiceScroll").getNiceScroll().resize()},dblclick:function(t,i){var i=i.node.data;return melisHelper.tabOpen(i.melisData.page_title,i.iconTab,i.melisData.item_zoneid,i.melisData.item_melisKey,{idPage:i.melisData.page_id}),e(".hasNiceScroll").getNiceScroll().resize(),!1},loadChildren:function(t,i){e("#id-mod-menu-dynatree").fancytree("getTree")},renderNode:function(t,i){e(i.node.span).find(".fancytree-icon").addClass(i.node.data.iconTab).removeClass("fancytree-icon"),"loading"!==i.node.statusNodeType&&(0===i.node.data.melisData.page_is_online&&e(i.node.span).find(".fancytree-title, .fa").css("color","#686868"),1===i.node.data.melisData.page_has_saved_version&&0==e(i.node.span).children("span").hasClass("unpublish")&&e(i.node.span).find(".fancytree-title").before("<span class='unpublish'></span>"))},dnd:{autoExpandMS:400,smartRevert:!0,refreshPositions:!0,draggable:{zIndex:1e3,scroll:!1,appendTo:"body"},dragStart:function(e,t){return melisCore.screenSize>=1024&&!!t.node.data.dragdrop},dragEnter:function(e,t){return!0},dragOver:function(e,t){},dragLeave:function(e,t){},dragStop:function(e,t){},dragDrop:function(t,i){t.setExpanded(!0).always(function(){var a=i.otherNode.getParent().key.toString(),s=a.includes("root")?-1:i.otherNode.getParent().key;i.otherNode.moveTo(t,i.hitMode);var o=(e("#id-mod-menu-dynatree").fancytree("getTree"),i.otherNode.key),l=t.getParent().key.toString(),n=l.includes("root")?-1:t.getParent().key;"over"==i.hitMode&&(n=i.node.key);var r=i.otherNode.getIndex()+1,m={idPage:o,oldFatherIdPage:s,newFatherIdPage:n,newPositionIdPage:r};e.ajax({url:"/melis/MelisCms/Page/movePage",data:m,encode:!0}).success(function(e){}).error(function(e,t,i){alert(translations.tr_meliscore_error_message)})})}}})},mainTree()}),e("body").on("click","#id-mod-menu-dynatree .create-newpage .btn",function(){melisHelper.tabOpen(translations.tr_meliscms_page_creation,"fa-file-text-o","0_id_meliscms_page","meliscms_page_creation",{idPage:0,idFatherPage:"-1"})}),e("body").on("click","#sourcePageIdFindPageTree span",function(){melisLinkTree.createInputTreeModal("#sourcePageId")}),e("body").on("click","#destinationPageIdFindPageTree span",function(){melisLinkTree.createInputTreeModal("#destinationPageId")}),e("body").on("click",'button[data-inputid="#destinationPageId"]',function(){e('[name="use_root"]').each(function(){e(this).is(":checked")&&e(this).prop("checked",!1)}),e(".remember-me-cont .cbmask-inner").removeClass("cb-active"),e("#destinationPageId").prop("disabled",!1)}),e("body").on("change",'[name="use_root"]',function(){e('[name="use_root"]:checked').length?(e("#destinationPageId").val(""),e("#destinationPageId").prop("disabled",!0)):e("#destinationPageId").prop("disabled",!1)}),t.treeCallBack=function(){0==e("#id-mod-menu-dynatree").children().length&&mainTree()},e("body").on("click","#duplicatePageTree",function(){var t=e("#duplicatePageTreeForm").serializeArray(),i=e('#duplicatePageTreeForm input[name="destinationPageId"]').val();melisCoreTool.pending("#duplicatePageTree"),e("#duplicatePageTree").find("i").removeClass(),e("#duplicatePageTree").find("i").addClass("fa fa-spinner fa-spin"),e.ajax({type:"POST",url:"/melis/MelisCms/TreeSites/duplicateTreePage",data:t,dataType:"json",encode:!0}).done(function(t){t.success?(e("#id_meliscms_tools_tree_modal_form_handler_container").modal("hide"),melisCms.refreshTreeview(i,1),melisHelper.melisOkNotification(t.textTitle,t.textMessage)):(melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors),melisCoreTool.highlightErrors(t.success,t.errors,"stylesForm")),melisCore.flashMessenger(),melisCoreTool.done("#duplicatePageTree"),e("#duplicatePageTree").find("i").removeClass(),e("#duplicatePageTree").find("i").addClass("fa fa-save")}).fail(function(){alert(translations.tr_meliscore_error_message)})})}(jQuery,window),$(document).ready(function(){$("body").on("click",".btnEditTemplates",function(){var e=$(this).parents("tr").attr("id");melisCoreTool.hideAlert("#templateupdateformalert"),melisCoreTool.showOnlyTab("#modal-template-manager-actions","#id_modal_tool_template_edit"),toolTemplate.retrieveTemplateData(e)}),$("body").on("click",".btnDelTemplate",function(){var e=$(this).parents("tr").attr("id");toolTemplate.deleteTemplate(e)}),$("body").on("click","#id_meliscms_tool_templates_header_add",function(){melisCoreTool.hideAlert("#templateaddformalert"),melisCoreTool.resetLabels("#id_modal_tool_template_add #id_tool_template_generic_form")}),$("body").on("click","#btnTemplateUpdate",function(){toolTemplate.updateTemplate()}),$("body").on("click",".btnMelisTemplatesExport",function(){var e=$("input[type='search'][aria-controls='tableToolTemplateManager']").val();melisCoreTool.isTableEmpty("tableToolTemplateManager")||melisCoreTool.exportData("/melis/MelisCms/ToolTemplate/exportToCsv?filter="+e)}),$("body").on("change","#templatesSiteSelect",function(){var e=$(this).parents().eq(6).find("table").attr("id");$("#"+e).DataTable().ajax.reload()})});var toolTemplate={table:function(){return"#tableToolTemplate"},initTool:function(){melisCoreTool.initTable(toolTemplate.table())},refreshTable:function(){melisCoreTool.switchTab("#id_modal_tool_template_add"),melisHelper.zoneReload("id_meliscms_tool_templates","meliscms_tool_templates")},addNewTemplate:function(){var e=$("#id_modal_tool_template_add #id_tool_template_generic_form").serialize();melisCoreTool.pending("#btnTemplateAdd"),$.ajax({type:"POST",url:"/melis/MelisCms/ToolTemplate/newTemplateData",data:e,dataType:"json",encode:!0}).done(function(e){e.success?($("#modal-template-manager-actions").modal("hide"),toolTemplate.refreshTable(),melisCoreTool.clearForm("id_tool_template_generic_form"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisCoreTool.alertDanger("#templateaddformalert","",e.textMessage),melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_modal_tool_template_add #id_tool_template_generic_form")),melisCore.flashMessenger(),melisCoreTool.done("#btnTemplateAdd")}).fail(function(){alert(translations.tr_meliscore_error_message)})},updateTemplate:function(){var e=$("#id_modal_tool_template_edit #id_tool_template_generic_form").serializeArray();e.push({name:"tpl_id",value:$("#tplid").html()}),e=$.param(e),melisCoreTool.resetLabels("#id_modal_tool_template_edit #id_tool_template_generic_form"),melisCoreTool.pending("#btnTemplateEdit"),$.ajax({type:"POST",url:"/melis/MelisCms/ToolTemplate/updateTemplateData",data:e,dataType:"json",encode:!0}).done(function(e){e.success?($("#modal-template-manager-actions").modal("hide"),toolTemplate.refreshTable(),melisCoreTool.clearForm("id_tool_template_generic_form"),melisCoreTool.resetLabels("#id_tool_template_generic_form"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisCoreTool.alertDanger("#templateupdateformalert","",e.textMessage),melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_tool_template_generic_form")),melisCore.flashMessenger(),melisCoreTool.done("#btnTemplateEdit")}).fail(function(){alert(translations.tr_meliscore_error_message)})},retrieveTemplateData:function(e){var t="#id_modal_tool_template_edit form#id_tool_template_generic_form ";melisCoreTool.resetLabels(t),$.ajax({type:"POST",url:"/melis/MelisCms/ToolTemplate/getTemplateDataById",data:{templateId:e},dataType:"json",encode:!0}).done(function(e){$.each(e,function(e,i){$(t+" input, "+t+" select").each(function(e){var a=$(this).attr("name");$(t+" #"+$(this).attr("id")).val(i[a]),$("#tplid").html(i.tpl_id)})})}).fail(function(){alert(translations.tr_meliscore_error_message)})},deleteTemplate:function(e){melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_tool_template_fm_delete_title,translations.tr_tool_template_fm_delete_confirm,function(){$.ajax({type:"POST",url:"/melis/MelisCms/ToolTemplate/deleteTemplateData",data:{templateId:e},dataType:"json",encode:!0}).done(function(e){melisCoreTool.pending(".delTemplate"),e.success&&(toolTemplate.refreshTable(),melisCore.flashMessenger(),melisHelper.melisOkNotification(e.textTitle,e.textMessage)),melisCoreTool.done(".delTemplate")}).fail(function(){alert(translations.tr_meliscore_error_message)})})}};window.initTemplateList=function(e,t){$("#templatesSiteSelect").length&&(e.tpl_site_id=$("#templatesSiteSelect").val())},$(document).ready(function(){function e(e){siteVal_id="id_meliscms_tool_site_new_site_confirmation_modal",siteVal_melisKey="meliscms_tool_site_new_site_confirmation_modal",modalUrl="/melis/MelisCore/MelisGenericModal/emptyGenericModal",melisHelper.createModal(siteVal_id,siteVal_melisKey,!1,{siteId:e},modalUrl)}function t(e,t){melisCoreTool.resetLabels("#siteEditionForm"),$.ajax({type:"POST",url:"/melis/MelisCms/Site/getSiteByIdAndEnvironment",data:{siteId:e,siteEnv:t},dataType:"json",encode:!0}).done(function(e){$("#siteEditionForm #id_sdom_domain").val(""),$.each(e,function(e,i){$("#siteEditionForm input, select").each(function(e){var t=$(this).attr("name");$("#siteEditionForm #"+$(this).attr("id")).val(i[t]),null===i.sdom_scheme&&$("#siteEditionForm #id_sdom_scheme>option:eq(0)").prop("selected",!0)}),"selnewsite"===t&&($("#siteEditionForm #id_sdom_env").val(""),$("#siteEditionForm #id_sdom_domain").val(""))})}).fail(function(){alert(translations.tr_meliscore_error_message)})}function i(e,t){$("body").on("click",e,t)}var a="";i("#meliscms-site-selector",function(){zoneId="id_meliscms_page_tree_id_selector",melisKey="meliscms_page_tree_id_selector",modalUrl="melis/MelisCms/Page/renderPageModal",$("#melis-modals-container").find("#id_meliscms_page_tree_id_selector_container").remove(),a=$(this).parents(".input-group").find("input"),$("body").on("hide.bs.modal","#id_meliscms_page_tree_id_selector_container",function(){$("#id_meliscms_page_tree_id_selector_container").remove(),2==$("body").find(".modal-backdrop").length&&$("body").find(".modal-backdrop").last().remove()}),melisHelper.createModal(zoneId,melisKey,!1,{},modalUrl,function(){$.contextMenu("destroy",".fancytree-title")})}),i("#selectPageId",function(){var e=$("#find-page-dynatree .fancytree-active").parent("li").attr("id");if(void 0!==e){var t=e.split("_")[1];a.length?(a.val(t),a.data("callback")&&(callback=a.data("callback"),"function"==typeof window[callback]?window[callback](t,a):console.log("callback "+a.data("callback")+" is not a function.")),$(this).closest(".modal").modal("hide")):melisHelper.melisKoNotification("tr_meliscms_menu_sitetree_Name","tr_meliscore_error_message")}else melisHelper.melisKoNotification("tr_meliscms_menu_sitetree_Name","tr_meliscms_page_tree_no_selected_page")}),window.generatePageLink=function(e,t){var e="undifined"!=typeof e?e:null;t.data("idPage",e),dataString=t.data(),e?$.ajax({type:"GET",url:"/melis/MelisCms/Page/getPageLink",data:dataString,dataType:"json",encode:!0,success:function(e){t.val(e.link)}}):console.log("PageId is null")},i("#id_meliscms_tool_site_header_add",function(e){melisCoreTool.showOnlyTab("#modal-cms-tool-site","#id_meliscms_tool_site_modal_add"),melisCoreTool.hideAlert("#siteaddalert"),melisCoreTool.resetLabels("#siteCreationForm")}),i(".btnEditSite",function(e){melisCoreTool.showOnlyTab("#modal-cms-tool-site","#id_meliscms_tool_site_modal_edit");$(".widget #siteEditionForm").append('<div id="loader" class="overlay-loader"><img class="loader-icon spinning-cog" src="/MelisCore/assets/images/cog12.svg" data-cog="cog12"></div>');var i=$(this).parents("td"),a=i.parents("tr"),s=a.attr("id"),o=$("#siteEditionForm #id_sdom_env");$("#siteEditionForm #id_site_id").val(s),melisCoreTool.hideAlert("#siteeditalert"),melisCoreTool.resetLabels("#siteEditionForm"),$(o).show(),melisCoreTool.clearForm("siteEditionForm"),$(o).html(""),$.ajax({type:"GET",url:"/melis/MelisCms/Site/getSiteEnvironment",data:{siteId:s},dataType:"json",encode:!0,success:function(e){$.getJSON("/melis/MelisCms/Site/getSiteEnvironments",{siteId:s},function(i){$.each(i.data,function(e,t){o.append($("<option />").val(t).text(t))}),$("#siteEditionForm #id_sdom_env>option:eq(0)").prop("selected",!0);var a=e.data;t(s,a);var l=setInterval(function(){var e=$("#siteEditionForm #id_site_name").val();null===e&&""===e||(clearInterval(l),$(".overlay-loader").remove())},300)})}})}),i(".btnDeleteSite",function(e){var t=$(this).parents("tr").attr("id");melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscms_tool_site_delete_confirm_title,translations.tr_meliscms_tool_site_delete_confirm,function(){$.ajax({type:"POST",url:"/melis/MelisCms/Site/deleteSite",data:{id:t},dataType:"json",encode:!0,success:function(e){melisCoreTool.pending(".btnDeleteSite"),e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscms_tool_site","meliscms_tool_site")):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,0),melisCore.flashMessenger(),melisCoreTool.done(".btnDeleteSite")}})})}),i("#btnDelEnv",function(e){melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscms_tool_site_env_delete_confirm_title,translations.tr_meliscms_tool_site_env_delete_confirm,function(){var e=new Array,i=$("#siteEditionForm #id_sdom_env"),a=$(i).val(),s=$("#siteEditionForm #id_site_id").val(),o=$("#siteEditionForm #id_s404_page_id").val();e.push({name:"siteid",value:s}),e.push({name:"env",value:a}),e.push({name:"site404Page",value:o}),e=$.param(e),$.ajax({type:"POST",url:"/melis/MelisCms/Site/deleteSiteById",data:e,dataType:"json",encode:!0,success:function(e){e.success?($(i).html(""),melisHelper.melisOkNotification(e.textTitle,e.textMessage),$.getJSON("/melis/MelisCms/Site/getSiteEnvironments",{siteId:s},function(e){$.each(e.data,function(e,t){i.append($("<option />").val(t).text(t))}),$("#siteEditionForm #id_select_env>option:eq(0)").prop("selected",!0);var a=$(i).val();t(s,a)})):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,0),melisCore.flashMessenger()}})})}),i("#btnSiteAdd",function(t){var i=$("#siteCreationForm").serializeArray();void 0!==t.originalEvent&&i.push({name:"gen_site_mod",value:!0}),melisCoreTool.pending("#btnSiteAdd"),melisCoreTool.hideAlert("#siteaddalert"),$.ajax({type:"POST",url:"/melis/MelisCms/Site/saveSite",data:i,dataType:"json",encode:!0}).done(function(t){t.success?($("#modal-cms-tool-site").modal("hide"),e(t.siteId),melisHelper.melisOkNotification(t.textTitle,t.textMessage)):(melisCoreTool.highlightErrors(t.success,t.errors,"siteCreationForm"),"tr_meliscms_tool_site_directory_exist"===t.textMessage?melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscms_tool_site_add,translations.tr_meliscms_tool_site_directory_exist,function(){$("#btnSiteAdd").trigger("click")}):(melisCoreTool.alertDanger("#siteaddalert","",t.textMessage),melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors))),melisCoreTool.done("#btnSiteAdd"),melisCore.flashMessenger()}).fail(function(){alert(translations.tr_meliscore_error_message)})}),i(".btnSiteUpdate",function(e){var t=$("#siteEditionForm").serializeArray(),i=$("#siteEditionForm #id_site_id").val();t.push({name:"site_id",value:i}),melisCoreTool.pending(".btnSiteUpdate"),$.ajax({type:"POST",url:"/melis/MelisCms/Site/saveSite",data:t,dataType:"json",encode:!0}).done(function(e){e.success?($("#modal-cms-tool-site").modal("hide"),melisHelper.zoneReload("id_meliscms_tool_site","meliscms_tool_site"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisCoreTool.alertDanger("#siteeditalert","",e.textMessage),melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"siteEditionForm")),melisCore.flashMessenger(),melisCoreTool.done(".btnSiteUpdate")}).fail(function(){alert(translations.tr_meliscore_error_message)})}),$("body").on("change","#siteEditionForm #id_sdom_env",function(e){var t=$("#siteEditionForm #id_site_id").val(),i=$("#siteEditionForm #id_sdom_env").val();melisCoreTool.resetLabels("#siteEditionForm"),$.ajax({type:"POST",url:"/melis/MelisCms/Site/getSiteByIdAndEnvironment",data:{siteId:t,
siteEnv:i},dataType:"json",encode:!0}).done(function(e){$("#siteEditionForm #id_sdom_domain").val(""),$.each(e,function(e,t){$("#siteEditionForm input").each(function(e){var i=$(this).attr("name");$("#siteEditionForm #"+$(this).attr("id")).val(t[i]),null===t.sdom_scheme&&$("#siteEditionForm #id_sdom_scheme>option:eq(0)").prop("selected",!0)}),"selnewsite"===i&&($("#siteEditionForm #id_sdom_env").val(""),$("#siteEditionForm #id_sdom_domain").val(""))})})}),$("body").on("click","#siteMainPageId span",function(){melisLinkTree.createInputTreeModal("#id_site_main_page_id")}),$("body").on("click","#s404PageId span",function(){melisLinkTree.createInputTreeModal("#id_s404_page_id")}),$("body").on("hidden.bs.modal","#id_meliscms_tool_site_new_site_confirmation_modal_container",function(e){melisHelper.zoneReload("id_meliscms_tool_site","meliscms_tool_site"),melisCms.refreshTreeview(-1)})}),$(document).ready(function(){function e(e,t){$("body").on("click",e,t)}var t="#formplatformedit form#idformlang";e("#btn_cms_new_lang",function(){melisCoreTool.showOnlyTab("#modal-language-cms","#id_meliscms_tool_language_modal_content_new"),melisCoreTool.clearForm("idformlang")}),e("#btnLangCmsAdd",function(){var e=$("#idformlang").serialize();melisCoreTool.pending("#btnLangCmsAdd"),melisCoreTool.processing(),$.ajax({type:"POST",url:"/melis/MelisCms/Language/addLanguage",data:e,dataType:"json",encode:!0}).success(function(e){e.success?($("#modal-language-cms").modal("hide"),melisHelper.zoneReload("id_meliscms_tool_language","meliscms_tool_language"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisCoreTool.alertDanger("#languagealert","",e.textMessage),melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"idformlang")),melisCoreTool.done("#btnLangCmsAdd"),melisCore.flashMessenger(),melisCoreTool.processDone()}).fail(function(){alert(translations.tr_meliscore_error_message)})}),e("#btnLangCmsEdit",function(){melisCoreTool.showOnlyTab("#modal-language-cms","#id_meliscms_tool_language_modal_content_edit");var e=$(this).parents("tr").attr("id");$.ajax({type:"POST",url:"/melis/MelisCms/Language/getLanguageById",data:{id:e},dataType:"json",encode:!0}).success(function(e){melisCoreTool.pending(".btn"),$(t+" input[type='text']").each(function(t){var i=$(this).attr("name");$("input#"+$(this).attr("id")).val(e.language[i]),$("span#platformupdateid").html(e.language.lang_cms_id)}),melisCoreTool.done(".btn")}).error(function(){alert(translations.tr_meliscore_error_message)})}),e("#btnLangEdit",function(){var e=$(t).serializeArray();e.push({name:"id",value:$("#platformupdateid").html()}),e=$.param(e),melisCoreTool.pending("#btnLangEdit"),melisCoreTool.processing(),$.ajax({type:"POST",url:"/melis/MelisCms/Language/editLanguage",data:e,dataType:"json",encode:!0}).done(function(e){e.success?($("#modal-language-cms").modal("hide"),melisHelper.zoneReload("id_meliscms_tool_language","meliscms_tool_language"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisCoreTool.alertDanger("#langeditalert","",e.textMessage),melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"formplatformedit form#idformlang")),melisCoreTool.done("#btnLangEdit"),melisCore.flashMessenger(),melisCoreTool.processDone()}).fail(function(){alert(translations.tr_meliscore_error_message)})}),e("#btnLangCmsDelete",function(){var e=$(this).parents("tr").attr("id");melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscore_tool_language,translations.tr_meliscore_tool_language_delete_confirm,function(){$.ajax({type:"POST",url:"/melis/MelisCms/Language/deleteLanguage",data:{id:e},dataType:"json",encode:!0}).success(function(e){melisCoreTool.pending(".btn-danger"),e.success?(melisHelper.zoneReload("id_meliscms_tool_language_content","meliscms_tool_language_content"),melisHelper.zoneReload("id_meliscms_header_language","meliscms_header_language"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger(),melisCoreTool.done(".btn-danger")}).error(function(){alert(translations.tr_meliscore_error_message)})})})}),window.initLangJs=function(){$('#tableLanguages td:nth-child(3):contains("'+melisLangId+'")').siblings(":last").html("-")},$(function(){$("body").on("click",".btnCmsPlatfomEdit",function(){var e=$(this).parents("tr").attr("id");modalId="platform_tool_modal",platform_modal_content="meliscms_tool_platform_ids_modal_content",modalUrl="/melis/MelisCms/Platform/renderPlatformModal",melisHelper.createModal(modalId,platform_modal_content,!1,{id:e},modalUrl)}),$("body").on("click",".btnSavePlatfomrRange",function(){var e=$(this).data("id"),t=$("#idformplatform").serializeArray();t.push({name:"pids_id",value:e}),t=$.param(t),$("#cmsPlatformAlert").addClass("hidden"),$.ajax({type:"POST",url:"/melis/MelisCms/Platform/savePlatformIdsRange",data:t,dataType:"json",encode:!0}).done(function(e){e.success?($("#platform_tool_modal_container").modal("hide"),melisHelper.zoneReload("id_meliscms_tool_platform_ids","meliscms_tool_platform_ids"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisCoreTool.alertDanger("#cmsPlatformAlert","",e.textMessage),melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors)),melisCore.flashMessenger(),melisCoreTool.highlightErrors(e.success,e.errors,"idformplatform")}).error(function(e,t,i){alert("ERROR !! Status = "+t+"\n Error = "+i+"\n xhr = "+e.statusText)})}),$("body").on("click","#id_meliscms_tool_platform_ids_add_button",function(){modalId="platform_tool_modal",platform_modal_content="meliscms_tool_platform_ids_modal_content",modalUrl="/melis/MelisCms/Platform/renderPlatformModal",melisHelper.createModal(modalId,platform_modal_content,!1,null,modalUrl)}),$("body").on("click",".btnCmsPlatformIdsDelete",function(){var e=$(this).parents("tr").attr("id"),t=new Array;t.push({name:"pid_id",value:e}),melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscms_tool_platform_ids,translations.tr_meliscms_tool_platform_ids_confirm_msg,function(){$.ajax({type:"POST",url:"/melis/MelisCms/Platform/deletePlatformId",data:t,dataType:"json",encode:!0}).done(function(e){melisHelper.zoneReload("id_meliscms_tool_platform_ids","meliscms_tool_platform_ids"),melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisCore.flashMessenger()}).fail(function(){alert(translations.tr_meliscore_error_message)})})}),window.initPlatformIdTbl=function(){$("#platformToolTable").find(".noPlatformIdDeleteBtn").each(function(){var e="#"+$(this).attr("id");$("#platformToolTable").find(e).find(".btnCmsPlatformIdsDelete").remove()})}}),$(function(){var e=$("body");e.on("click",".addRedirectSite",function(){s301Id=$(this).data("s301id"),createSite301Modal(s301Id)}),e.on("click",".editRedirectSite",function(){var e=$(this),t=e.parents("tr").attr("id");createSite301Modal(t)}),e.on("click",".saveSiteRedirect",function(){s301Id=$(this).data("s301id");var e=new Array;e=$("#siteRedirectForm").serializeArray(),$.ajax({type:"POST",url:"/melis/MelisCms/SiteRedirect/saveSiteRedirect",data:e,dataType:"json",encode:!0}).done(function(e){e.success?($("#id_meliscms_tool_site_301_generic_form_container").modal("hide"),melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscms_tool_site_301_content","meliscms_tool_site_301_content")):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger(),melisCoreTool.highlightErrors(e.success,e.errors,"siteRedirectForm")}).fail(function(){alert(translations.tr_meliscore_error_message)})}),e.on("click",".deleteRedirectSite",function(){var e=$(this),t=e.parents("tr").attr("id");melisCoreTool.confirm(translations.tr_meliscms_common_yes,translations.tr_meliscms_common_no,translations.tr_meliscms_tool_site_301_delete_site_redirect,translations.meliscms_tool_site_301_delete_confirm_msg,function(){$.ajax({type:"POST",url:"/melis/MelisCms/SiteRedirect/deleteSiteRedirect",data:{s301Id:t},dataType:"json",encode:!0}).done(function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscms_tool_site_301_content","meliscms_tool_site_301_content")):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger()}).fail(function(){alert(translations.tr_meliscore_error_message)})})}),e.on("click",".testRedirectSite",function(){var e=$(this),t=e.parents("tr"),i=t.attr("id"),a=$("#tableToolSite301 tr#"+i+" td:nth-child(4)").text();""!==a?window.open(a,"_blank"):alert(translations.tr_meliscore_error_message)}),e.on("change","#redirectSiteSelect",function(){var e=$(this).parents().eq(6).find("table").attr("id");$("#"+e).DataTable().ajax.reload()})}),window.createSite301Modal=function(e){void 0===e&&(e=null),zoneId="id_meliscms_tool_site_301_generic_form",melisKey="meliscms_tool_site_301_generic_form",modalUrl="/melis/MelisCms/SiteRedirect/renderToolSiteRedirectModal",melisHelper.createModal(zoneId,melisKey,!1,{s301Id:e},modalUrl)},window.initRedirectTemplateList=function(e,t){$("#redirectSiteSelect").length&&(e.s301_site_id=$("#redirectSiteSelect").val())};var melisLinkTree=function(e,t){function i(){var t=e("input[name=tree_search]").val(),i=e("#find-page-dynatree").fancytree("getTree"),a=i.filterNodes,s={};i.clearFilter(),e("#find-page-dynatree").fancytree("getRootNode").visit(function(e){e.resetLazy()}),e("input[name=tree_search]").prop("disabled",!0);var o=e("input[name=tree_search]").closest(".meliscms-search-box");o.addClass("searching"),e.ajax({type:"POST",url:"melis/MelisCms/Page/searchTreePages",data:{name:"value",value:t},dataType:"json",encode:!0}).success(function(l){if(e.trim(l)){var n=e.map(l,function(e){return e});i.loadKeyPath(n,function(e,o){if(!e.isVisible())switch(o){case"loaded":case"ok":e.makeVisible()}a.call(i,t,s)}).done(function(){e("input[name=tree_search]").prop("disabled",!1),o.removeClass("searching")})}else o.append("<div class='melis-search-overlay'>Not Found</div>").hide().fadeIn(600),setTimeout(function(){e(".melis-search-overlay").fadeOut(600,function(){e(this).remove()}),e("input[name=tree_search]").prop("disabled",!1),e("input[name=tree_search]").focus()},1e3)}).error(function(){console.log("failed")})}function a(){e(".melis-iframe").contents().find("#mce-link-tree").parent().find("input").val(m);e(".mce-floatpanel.mce-window").find("#mce-link-tree").parent().find("input").val(m)}function s(){e("body").find(".mce-has-open").prev().text(),d.find(".mce-has-open")[0];e("body").find(".mce-widget.mce-label").each(function(){if("Url"===e(this).text()){var t,i=d.find(".mce-btn.mce-open"),a=i.width()+1,s=e(this).next(),l=s.children(".mce-textbox");i.length?(t=l.width()-a,i.css({left:"0"}),l.css({width:t}),o()):(t=l.width()-32,l.css({width:t}),s.append('<div id="mce-link-tree" class="mce-btn mce-open" style="position: absolute; right: 0; width: 32px; height: 28px;"><button><i class="icon icon-sitemap fa fa-sitemap" style="font-family: FontAwesome; position: relative; top: 2px; font-size: 16px;"></i></button></div>'))}})}function o(){d.find(".mce-has-open").append('<div id="mce-link-tree" class="mce-btn mce-open" style="position: absolute; right: 0; width: 32px; height: 28px;"><button><i class="icon icon-sitemap fa fa-sitemap" style="font-family: FontAwesome; position: relative; top: 2px; font-size: 16px;"></i></button></div>')}function l(){zoneId="id_meliscms_find_page_tree",melisKey="meliscms_find_page_tree",modalUrl="melis/MelisCms/Page/renderPageModal",e("#id_meliscms_find_page_tree_container").length&&e("#id_meliscms_find_page_tree_container").parent().remove(),t.parent.melisHelper.createModal(zoneId,melisKey,!1,{},modalUrl,function(){}),e("#mce-link-tree").closest(".mce-panel").css("z-index",1049),e("#mce-modal-block").css("z-index",1048)}function n(i){zoneId="id_meliscms_input_page_tree",melisKey="meliscms_input_page_tree",modalUrl="melis/MelisCms/Page/renderPageModal",e("#id_meliscms_input_page_tree_container").length&&e("#id_meliscms_input_page_tree_container").parent().remove(),t.parent.melisHelper.createModal(zoneId,melisKey,!1,{pageTreeInputId:i},modalUrl,function(){})}function r(){e("#find-page-dynatree").fancytree({extensions:["filter"],keyboard:!0,generateIds:!0,idPrefix:"pageid_",source:{url:"/melis/MelisCms/TreeSites/get-tree-pages-by-page-id",cache:!0},lazyload:function(e,t){var i=t.node.data.melisData.page_id;t.result={url:"/melis/MelisCms/TreeSites/get-tree-pages-by-page-id?nodeId="+i,data:{mode:"children",parent:t.node.key},cache:!1}},renderNode:function(t,i){e(i.node.span).find(".fancytree-icon").addClass(i.node.data.iconTab).removeClass("fancytree-icon"),"loading"!==i.node.statusNodeType&&(i.node.data.melisData.page_is_online,1===i.node.data.melisData.page_has_saved_version&&0==e(i.node.span).children("span").hasClass("unpublish")&&e(i.node.span).find(".fancytree-title").before("<span class='unpublish'></span>"))},filter:{autoApply:!0,autoExpand:!1,counter:!0,fuzzy:!1,hideExpandedCounter:!0,hideExpanders:!1,highlight:!0,leavesOnly:!1,nodata:!0,mode:"hide"}})}var m,d=e("body");return d.on("click","div[aria-label='Insert/edit link']",s),d.on("click","div.mce-menu-item",s),d.on("click","#mce-link-tree",l),e(document).on("keyup","input[name=tree_search]",function(e){"13"==(e.keyCode?e.keyCode:e.which)&&i()}).focus(),d.on("click","#searchTreeView",function(e){i()}),d.on("click","#resetTreeView",function(t){melisHelper.loadingZone(e(".page-evolution-content")),e("input[name=tree_search]").val(""),e("#find-page-dynatree").fancytree("getTree").clearFilter(),e("#find-page-dynatree").fancytree("getRootNode").visit(function(e){e.setExpanded(!1)}),setTimeout(function(){melisHelper.removeLoadingZone(e(".page-evolution-content"))},2e3)}),d.on("click","#generateTreePageLink",function(){melisCoreTool.pending("#generateTreePageLink");var t=e("#find-page-dynatree .fancytree-active").parent("li").attr("id").split("_")[1];e.ajax({type:"GET",url:"melis/MelisCms/Page/getPageLink",data:{idPage:t},dataType:"json",encode:!0}).success(function(t){m=t.link,a(),e("#id_meliscms_find_page_tree_container").modal("hide")}).error(function(){console.log("failed")}),melisCoreTool.done("#generateTreePageLink")}),d.on("click","#generateTreePageId",function(){melisCoreTool.pending("#generateTreePageLink");var t=e("#find-page-dynatree .fancytree-active").parent("li").attr("id").split("_")[1],i=e("#generateTreePageId").data("inputid");e(i).val(t),e("#id_meliscms_input_page_tree_container").modal("hide"),melisCoreTool.done("#generateTreePageLink")}),{createTreeModal:l,createInputTreeModal:n,findPageMainTree:r,checkBtn:s,showUrl:a}}(jQuery,window);$(function(){$("body").on("click","a.melis-pageduplicate",function(){var e=$(this).data().pagenumber;$.ajax({type:"POST",url:"/melis/MelisCms/PageDuplication/duplicate-page",data:{id:e},dataType:"json",encode:!0}).success(function(e){e.success?(melisCms.refreshTreeview(e.response.pageId),e.response.openPageAfterDuplicate&&melisHelper.tabOpen(e.response.name,e.response.icon,e.response.pageId+"_id_meliscms_page","meliscms_page",{idPage:e.response.pageId}),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,0),melisCore.flashMessenger()}).fail(function(e){console.log(e)})})});var melisSearchPageTree=function(e,t){function i(){var t=e.trim(e("input[name=left_tree_search]").val()),i=e("#id-mod-menu-dynatree").fancytree("getTree"),a=i.filterNodes;if(t.length){var s={};e(".meliscms-search-box.sidebar-treeview-search").append("<div class='melis-overlay-loading'></div>"),i.clearFilter(),e("#id-mod-menu-dynatree").fancytree("getRootNode").visit(function(e){e.isExpanded()&&e.resetLazy()}),e("input[name=left_tree_search]").prop("disabled",!0);var o=e("input[name=left_tree_search]").closest(".meliscms-search-box");e.ajax({type:"POST",url:"melis/MelisCms/Page/searchTreePages",data:{name:"value",value:t},dataType:"json",encode:!0}).success(function(l){if(e.trim(l)){var n=e.map(l,function(e){return e});i.loadKeyPath(n,function(e,o){switch(o){case"loaded":case"ok":e.makeVisible()}a.call(i,t,s)}).done(function(){e("input[name=left_tree_search]").prop("disabled",!1),e(".meliscms-search-box.sidebar-treeview-search .melis-overlay-loading").remove(),e("input[name=left_tree_search]").focus()})}else o.append("<div class='melis-search-overlay'>"+translations.tr_meliscms_form_search_not_found+"</div>").hide().fadeIn(600),setTimeout(function(){e(".melis-search-overlay").fadeOut(600,function(){e(this).remove()}),e("input[name=left_tree_search]").prop("disabled",!1),e("input[name=left_tree_search]").focus(),e(".meliscms-search-box.sidebar-treeview-search .melis-overlay-loading").remove()},1e3)}).error(function(){console.log("failed")})}}var a=e("body");a.on("click","#leftSearchTreeView",function(e){i()}),e(document).on("keyup","input[name=left_tree_search]",function(e){"13"==(e.keyCode?e.keyCode:e.which)&&i()}),a.on("click","#leftResetTreeView",function(t){e("input[name=left_tree_search]").val(""),e("#id-mod-menu-dynatree").fancytree("destroy"),mainTree()})}(jQuery,window);$(function(){var e=$("body");e.on("click",".pageLangCreate",function(){var e=$(this),t=$(this).data("pageid"),i=$(this).data("formid"),a=$("#"+i).serializeArray();e.attr("disabled",!0),$.ajax({type:"POST",url:"/melis/MelisCms/PageLanguages/createNewPageLangVersion",data:a,dataType:"json",encode:!0}).done(function(a){a.success?($.isEmptyObject(a.pageInfo)||(melisHelper.tabOpen(a.pageInfo.name,a.pageInfo.tabicon,a.pageInfo.id,a.pageInfo.meliskey,{idPage:a.pageInfo.pageid}),melisCms.refreshTreeview(a.pageInfo.pageid)),melisHelper.zoneReload(t+"_id_meliscms_page","meliscms_page",{idPage:t}),melisHelper.melisOkNotification(a.textTitle,a.textMessage)):(melisCoreTool.alertDanger("#cmsPlatformAlert","",a.textMessage),melisHelper.melisKoNotification(a.textTitle,a.textMessage,a.errors)),melisCore.flashMessenger(),melisCoreTool.highlightErrors(a.success,a.errors,i),e.attr("disabled",!1)}).error(function(t,i,a){e.attr("disabled",!1),alert(translations.tr_meliscore_error_message)})}),e.on("click",".open-page-from-lan-tab",function(){var e=$(this).data();$.isEmptyObject(e)||melisHelper.tabOpen(e.name,e.tabicon,e.id,e.meliskey,{idPage:e.pageid})})}),$(document).ready(function(){var e=$("body");e.on("click","#id_meliscms_tool_styles_header_add",function(){melisStyleTool.openToolModal(0)}),e.on("click",".btnEditStyles",function(){var e=$(this).closest("tr").attr("id");melisStyleTool.openToolModal(e)}),e.on("click","#saveStyleDetails",function(){var e=($(this).data("style-id"),$("#stylesForm").serializeArray());melisStyleTool.saveStyleDetails(e)}),e.on("click",".btnDelStyle",function(){var e=$(this).closest("tr").attr("id");melisStyleTool.deleteStyle(e)}),e.on("click","#styleInputFindPageTree span",function(){melisLinkTree.createInputTreeModal("#id_style_page_id")})});var melisStyleTool=function(e,t){function i(e){zoneId="id_meliscms_tool_styles_modal_form_handler",melisKey="meliscms_tool_styles_modal_form_handler",modalUrl="melis/MelisCms/ToolStyle/renderToolStyleModalContainer",melisHelper.createModal(zoneId,melisKey,!1,{styleId:e},modalUrl,function(){})}function a(t){melisCoreTool.pending("#saveStyleDetails"),e.ajax({type:"POST",url:"/melis/MelisCms/ToolStyle/saveStyleDetails",data:t,dataType:"json",encode:!0}).done(function(t){t.success?(e("#id_meliscms_tool_styles_modal_form_handler_container").modal("hide"),melisStyleTool.refreshTable(),melisHelper.melisOkNotification(t.textTitle,t.textMessage)):(melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors),melisCoreTool.highlightErrors(t.success,t.errors,"stylesForm")),melisCore.flashMessenger(),melisCoreTool.done("#saveStyleDetails")}).fail(function(){alert(translations.tr_meliscore_error_message)})}function s(t){var i={styleId:t};melisCoreTool.pending(".btnDelStyle"),console.log(i),melisCoreTool.confirm(translations.tr_meliscms_common_yes,translations.tr_meliscms_common_no,translations.tr_meliscms_tool_styles_delete_title,translations.tr_meliscms_tool_styles_delete_details,function(){e.ajax({type:"POST",url:"/melis/MelisCms/ToolStyle/deleteStyle",data:i,dataType:"json",encode:!0}).success(function(e){melisCoreTool.done(".btnDelStyle"),e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisStyleTool.refreshTable()):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger()}).error(function(){console.log("failed")})})}function o(){melisHelper.zoneReload("id_meliscms_tool_styles_content","meliscms_tool_styles_content")}return{openToolModal:i,saveStyleDetails:a,deleteStyle:s,refreshTable:o}}(jQuery,window);$(document).ready(function(){$body=$("body");$body.on("click","#btn-new-meliscms-tool-sites",function(){melisCoreTool.pending("#btn-new-meliscms-tool-sites"),melisHelper.createModal("id_meliscms_tool_sites_modal_container","meliscms_tool_sites_modal_add_content",!0,[],"/melis/MelisCms/Sites/renderToolSitesModalContainer",function(){melisCoreTool.done("#btn-new-meliscms-tool-sites")})}),$body.on("click",".btnEditSites",function(){melisHelper.tabOpen("Test","fa-user","id_meliscms_tool_sites_edit_site","meliscms_tool_sites_edit_site",null,null,function(){})}),window.createSitesModalCallback=function(){var e=$(".slide-group"),t=0,i=$(".slide"),a=i.length,s=function(e){t=e,o(t)},o=function(t){var i=500*t;e.animate({left:"-"+i+"px"})};$("#btn-prev-create-meliscms-tool-sites").on("click",function(){var e=t-1;s(t>0?e:t)}),$("#btn-next-create-meliscms-tool-sites").on("click",function(){var e=t+1;s(t<a-1?e:t)})}});