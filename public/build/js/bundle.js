var melisCms=function(){var e,t=$("body"),i=($("document"),[]);function a(e,t,i){0===e?($("#"+i+" .form-group label").css("color","#686868"),$.each(t,(function(e,t){$("#"+i+" .form-control[name='"+e+"']").prev("label").css("color","red")}))):$("#"+i+" .form-group label").css("color","#686868")}function s(e){var t="string"==typeof e?e:$(this).data("pagenumber"),i=$(this).data("fatherpageid"),s=$("#"+t+"_id_meliscms_page form").serializeArray();if($("#"+t+"_id_page_taxonomy").length){var n=$("#"+t+"_id_page_taxonomy").data("tags").toString();s.push({name:"page_taxonomy",value:n})}s=$.param(s),$.ajax({type:"POST",url:"/melis/MelisCms/Page/savePage?idPage="+t+"&fatherPageId="+i,data:s,dataType:"json",encode:!0}).done((function(e){if(1===e.success){o(e.datas.idPage),melisHelper.melisOkNotification(e.textTitle,e.textMessage,"#72af46"),a(e.success,e.errors,e.datas.item_zoneid);var i=e.datas.item_zoneid;if("0_id_meliscms_page"===i){melisHelper.tabClose(i);var s=e.datas.idPage+i.substring(1,i.length),n=""!==e.datas.item_icon?e.datas.item_icon:"fa-file-o",r=e.datas.idPage+" - "+e.datas.item_name;melisHelper.tabOpen(r,n,s,e.datas.item_melisKey,{idPage:e.datas.idPage})}else melisHelper.zoneReload(t+"_id_meliscms_page","meliscms_page",{idPage:t},(()=>{window.parent.loader.addActivePageEditionLoading(t+"_id_meliscms_page")}));melisCms.afterSavePageCallback()}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,"#000"),a(e.success,e.errors,e.datas.item_zoneid);melisCore.flashMessenger()})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))}function n(e){var t="string"==typeof e?e:$(this).data("pagenumber"),s=$("#"+t+"_id_meliscms_page form").serializeArray();if($("#"+t+"_id_page_taxonomy").length){var n=$("#"+t+"_id_page_taxonomy").data("tags").toString();s.push({name:"page_taxonomy",value:n})}s=$.param(s),$.ajax({type:"POST",url:"/melis/MelisCms/Page/publishPage?idPage="+t,data:s,dataType:"json",encode:!0}).done((function(e){1===e.success?(o(e.datas.idPage),$('.page-publishunpublish[data-pagenumber="'+t+'"]').bootstrapSwitch("setState",!0,!0),melisHelper.melisOkNotification(e.textTitle,e.textMessage,"#72af46"),a(e.success,e.errors,e.datas.item_zoneid),melisCore.flashMessenger(),$("#"+e.datas.item_zoneid+" .page-title h1:not('span')").text(e.datas.item_name),$(".tabsbar a[data-id='"+e.datas.item_zoneid+"'] .navtab-pagename").text(t+" - "+e.datas.item_name),$("#"+e.datas.item_zoneid+" .page-title .saved-version-notif").fadeOut(),melisHelper.zoneReload(t+"_id_meliscms_page","meliscms_page",{idPage:t},(()=>{window.parent.loader.addActivePageEditionLoading(t+"_id_meliscms_page")})),i.push(e.datas.idPage),melisCms.afterPublishCallback()):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,"#000"),a(e.success,e.errors,e.datas.item_zoneid)),melisCore.flashMessenger()})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))}function r(e){var t="string"==typeof e?e:$(this).data("pagenumber");$.ajax({type:"GET",url:"/melis/MelisCms/Page/unpublishPage?idPage="+t,dataType:"json",encode:!0}).done((function(e){1===e.success?(o(t),melisHelper.melisOkNotification(e.textTitle,e.textMessage,"#72af46"),melisCore.flashMessenger(),i.push(t),melisCms.afterUnPublishCallback()):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,"#000"),melisCore.flashMessenger(),melisHelper.zoneReload(t+"_id_meliscms_page","meliscms_page",{idPage:t},(()=>{window.parent.loader.addActivePageEditionLoading(t+"_id_meliscms_page")}))})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))}function o(e,t){optionalArg=void 0===t?0:t,$.ajax({url:"/melis/MelisCms/TreeSites/getPageIdBreadcrumb?idPage="+e+"&includeSelf="+optionalArg,encode:!0,dataType:"json"}).done((function(e){var t=[];$.each(e,(function(e,i){t.push("/"+i),0===e&&i})),t=(t=t.toString()).replace(/,/g,""),$.ui.fancytree.getTree("#id-mod-menu-dynatree").reload({url:"/melis/MelisCms/TreeSites/get-tree-pages-by-page-id"}).done((function(){!1===$("#id-mod-menu-dynatree .ui-fancytree > li:last-child").hasClass("fancytree-lastsib")&&$("#id-mod-menu-dynatree .ui-fancytree > li:last-child").remove()}))})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))}function l(e){var t=$(this).val().length,i=$(this).prev("label"),a=e.data.limit;i.find("span").length?0===t?(i.removeClass("limit"),i.find("span").remove()):(i.find("span").html('<i class="fa fa-text-width"></i>('+t+")"),t>a?(i.addClass("limit"),i.find("span").addClass("limit")):(i.removeClass("limit"),i.find("span").removeClass("limit"))):0!==t&&(i.find(".label-text").append("<span class='text-counter-indicator'><i class='fa fa-text-width'></i>("+t+")</span>"),t>a&&(i.addClass("limit"),i.find("span").addClass("limit")))}function d(){var e=$(this).parents(".melis-page-table-cont"),t=e.attr("id"),i=e.data("meliskey"),a=e.data("page-id");melisHelper.zoneReload(t,i,{idPage:a})}function c(e){$("#"+e+"_id_meliscms_page_action_tabs").removeClass("relative"),$("#"+e+"_id_meliscms_page_action_tabs li.btn-disabled").remove(),$("#"+e+"_id_meliscms_page .overlay-switch").remove()}return window.scrollToViewTinyMCE=function(t,i){if(e=$(window).scrollTop(),!t||!i)return e;var a=i/2-t;$("html, body").animate({scrollTop:a},300)},window.scrollOffsetTinyMCE=function(){return e},$(".sub-section").on("click",(function(){var e=$(this);e.next(".cms-next").is(":visible")?e.next(".cms-next").hide():e.next(".cms-next").show()})),t.on("click",".tox-tbtn",(function(){if($("#mce-modal-block").length)if($("iframe.melis-iframe").length){$("iframe.melis-iframe").position().top,$("iframe.melis-iframe").height();var e=screen.height;bodyOffsetTop=$(window)[0].scrollHeight;var t=$(".mce-window").outerHeight(),i=bodyOffsetTop+e-t;$(".mce-floatpanel.mce-window").css("top",i),$("html, body").animate({scrollTop:i},300)}else $("#mce-modal-block").css("z-index",1049),$(".mce-floatpanel.mce-window").css("z-index",1050)})),melisCore.screenSize>=768&&($(window).on("scroll",(function(){var e=0;$("body").hasClass("sidebar-mini")||(e=$("#id_meliscore_leftmenu").outerWidth());var i=$("#"+activeTabId+" div.page-title").outerHeight();$(window).scrollTop()>i&&melisCore.screenSize>1120?($("#"+activeTabId+" .page-head-container").css("padding-top","72px"),$("#"+activeTabId+" .page-head-container > .innerAll").addClass("sticky-pageactions"),$("#"+activeTabId+" .page-head-container > .innerAll").css({width:t.width()-e,left:e})):($("#"+activeTabId+" .page-head-container").prop("style",null),$("#"+activeTabId+" .page-head-container > .innerAll").removeClass("sticky-pageactions"),$("#"+activeTabId+" .page-head-container > .innerAll").prop("style",null))})),$("body.show-breadcrumb.show-nav-tabs").on("scroll",(function(){var e=0;$("body").hasClass("sidebar-mini")||(e=$("#id_meliscore_leftmenu").outerWidth());var i=$("#"+activeTabId+" div.page-title"),a=$("#"+activeTabId+" div[data-meliskey='meliscms_pagehead_title']");i.length&&(i=Math.abs(i.offset().top)),a.length&&(a=$("#"+activeTabId+" div[data-meliskey='meliscms_pagehead_title']").offset().top);$("#"+activeTabId+" div.page-title").outerHeight();a<=0&&melisCore.screenSize>1120?($("#"+activeTabId+" .page-head-container").css("padding-top","61px"),$("#"+activeTabId+" .page-head-container > .innerAll").addClass("sticky-pageactions"),$("#"+activeTabId+" .page-head-container > .innerAll").css({width:t.width()-e,left:e})):($("#"+activeTabId+" .page-head-container").prop("style",null),$("#"+activeTabId+" .page-head-container > .innerAll").removeClass("sticky-pageactions"),$("#"+activeTabId+" .page-head-container > .innerAll").prop("style",null))}))),t.on("click",".melis-newpage",(function(){var e=$(this).data("pagenumber");melisHelper.tabClose("0_id_meliscms_page"),melisHelper.tabOpen(translations.tr_meliscms_page_creation,"fa-file-o","0_id_meliscms_page","meliscms_page_creation",{idPage:0,idFatherPage:e})})),t.on("click",".melis-savepage",s),t.on("click",".melis-clearpage",(function(){var e=$(this).data(),t=e.pagenumber,i=(activeTabId,e.confirmmsg);melisCoreTool.confirm(translations.tr_meliscms_page_action_clear,translations.tr_meliscms_menu_cancel,translations.tr_meliscms_delete_saved_page_title,i,(function(){$.ajax({type:"GET",url:"/melis/MelisCms/Page/clearSavedPage?idPage="+t,encode:!0}).done((function(e){1===e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage,"#72af46"),melisCms.refreshTreeview(t),melisCore.flashMessenger(),melisHelper.zoneReload(t+"_id_meliscms_page","meliscms_page",{idPage:t},(()=>{window.parent.loader.addActivePageEditionLoading(t+"_id_meliscms_page")}))):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,"#000")})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))}))})),t.on("click",".melis-publishpage",n),t.on("click",".melis-unpublishpage",r),t.on("click",".melis-deletepage",(function(){var e=$(this).data().pagenumber,t=activeTabId,i=$(this).attr("disabled");void 0!==i&&!1!==i||melisCoreTool.confirm(translations.tr_meliscms_menu_delete,translations.tr_meliscms_menu_cancel,translations.tr_meliscms_delete_confirmation,translations.tr_meliscms_delete_confirmation_msg,(function(){melisCms.refreshTreeview(e),$.ajax({url:"/melis/MelisCms/Page/deletePage?idPage="+e,encode:!0}).done((function(e){1===e.success?(melisHelper.tabClose(t),melisHelper.melisOkNotification(e.textTitle,e.textMessage,"#72af46"),melisCore.flashMessenger()):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,"#000")})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))}))})),t.on("click",".melis-savepage",(function(e){e.preventDefault();var t=$(this);t.prop("disabled",!0),setTimeout((function(){t.prop("disabled",!1)}),3e3)})),t.on("click",".display-settings",(function(){var e=0,t=$(this).data("display");$(".displaysettingsicon span.fa").removeClass(),$(".displaysettingsicon span:first-child").addClass(t),e="fa fa-desktop"===t?"100%":"fa fa-tablet"===t?"980px":"480px",$(this).parents(".page-head-container").next(".page-content-container").find(".melis-iframe").animate({width:e},300,(function(){$("#"+activeTabId+" .melis-iframe").css("height","1000px");var e=$("#"+activeTabId+" .melis-iframe").contents().height()+50;$("#"+activeTabId+" .melis-iframe").css("height",e)}))})),t.on("switch-change",".page-publishunpublish",(function(e,t){var i=$(this).data("pagenumber").toString();!0===t.value?n(i):r(i)})),t.on("keyup keydown change","form[name='pageseo'] input[name='pseo_meta_title']",{limit:70},l),t.on("keyup keydown change","form[name='pageseo'] textarea[name='pseo_meta_description']",{limit:160},l),t.on("shown.bs.tab",".page-content-container .widget-head.nav ul li a",(function(){$("form[name='pageseo'] input[name='pseo_meta_title']").trigger("keyup"),$("form[name='pageseo'] input[textarea='pseo_meta_description']").trigger("keyup");var e=$("#"+activeTabId+" .melis-iframe").contents().height();$("#"+activeTabId+" .melis-iframe").css("height",e)})),t.on("shown.bs.tab",".melis-refreshPageTable",d),t.on("click",".melis-refreshPageTable",d),t.on("click",".page-content-container .widget-head.nav ul li a.history, .page-content-container .widget-head.nav ul li a.more_windows",(function(){var e=$(this).attr("href"),t=$(e);melisCore.screenSize<=767&&t.find(".melis-refreshPageTable").trigger("click")})),t.on("#melis-id-nav-bar-tabs [data-tool-meliskey='meliscms_page'] .tab-element",(function(){var e=$(this),t=$("#"+e.data("id")).find(".iframe-container .tab-content .melis-iframe"),i=t.contents()[0].body.scrollHeight;t.css("height",i)})),{savePage:s,publishPage:n,unpublishPage:r,afterPublishCallback:function(){},afterUnPublishCallback:function(){},afterSavePageCallback:function(){},refreshTreeview:o,disableCmsButtons:function(e){$("#"+e+"_id_meliscms_page .page-publishunpublish").append("<div class='overlay-switch' style='width: 100%;height: 100%;position: absolute;top: 0;left: 0;z-index: 99999999;cursor: wait; '></div>"),$("#"+e+"_id_meliscms_page_action_tabs").addClass("relative").prepend("<li class='btn-disabled'></li>")},enableCmsButtons:c,iframeLoad:function(e){var t=$("#"+e+"_id_meliscms_page").find(".melis-iframe"),a=t.contents().height();t.css("height",a),t.css("min-height","700px"),c(e),window.parent.loader.removeActivePageEditionLoading(e+"_id_meliscms_page"),i=[],$.ajax({url:"/melis/MelisCms/TreeSites/canEditPages",encode:!0}).done((function(e){var t=$.ui.fancytree.getTree("#id-mod-menu-dynatree");0===e.edit?($(".meliscms-search-box.sidebar-treeview-search").hide(),$("#id-mod-menu-dynatree").prepend("<div class='create-newpage'><span class='no-access'>"+translations.tr_meliscms_no_access+"</span></div>")):0===t?.count()?($(".meliscms-search-box.sidebar-treeview-search").hide(),$("#id-mod-menu-dynatree").prepend("<div class='create-newpage'><span class='btn btn-success'>"+translations.tr_meliscms_create_page+"</span></div>")):($(".meliscms-search-box.sidebar-treeview-search").show(),$("#id-mod-menu-dynatree .create-newpage").remove())})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)})),$.ajax({url:"/melis/MelisCms/Page/isActionActive?actionwanted=save",encode:!0}).done((function(e){0===e.active?$("body").addClass("disable-create"):$("body").removeClass("disable-create")})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)})),$.ajax({url:"/melis/MelisCms/Page/isActionActive?actionwanted=delete",encode:!0}).done((function(e){0===e.active?$("body").addClass("disable-delete"):$("body").removeClass("disable-delete")})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))},pageTabOpenCallback:function(e){i.push(e)}}}();$((function(){$("#pageIdRootMenu").parents(".form-group").find("label").addClass("d-flex flex-row justify-content-between")})),function(e,t,i){var a=e("body");t.mainTree=function(t){var i,a=e("#tab-arrow-top");i=melisCore.screenSize<=767?["contextMenu","filter","glyph"]:["contextMenu","dnd","filter","glyph","persist"],e("#id-mod-menu-dynatree").fancytree({extensions:i,glyph:{map:{loading:"fa fa-spinner fa-pulse"}},persist:{cookiePrefix:"fancytree-1-",expandLazy:!0,overrideSource:!0,store:"auto"},activeVisible:!1,debugLevel:0,autoScroll:!0,generateIds:!0,idPrefix:"mt_",tabindex:"",toggleEffect:{height:"toggle",duration:250},source:{url:"/melis/MelisCms/TreeSites/get-tree-pages-by-page-id",cache:!0},contextMenu:{menu:{new:{name:translations.tr_meliscms_menu_new,icon:"paste"},edit:{name:translations.tr_meliscms_menu_edit,icon:"edit"},delete:{name:translations.tr_meliscms_menu_delete,icon:"delete"},dupe:{name:translations.tr_meliscms_menu_dupe,icon:"copy"},export:{name:translations.tr_melis_cms_tree_export_page,icon:"export"},import:{name:translations.tr_melis_cms_page_tree_import,icon:"import"}},actions:function(t,i,a){if("new"===i){var s=t.data;melisHelper.tabClose("0_id_meliscms_page"),melisHelper.tabOpen(translations.tr_meliscms_page_creation,"fa-file-text-o","0_id_meliscms_page","meliscms_page_creation",{idPage:0,idFatherPage:s.melisData.page_id})}if("edit"===i){s=t.data;melisHelper.tabOpen(s.melisData.page_title,s.iconTab,s.melisData.item_zoneid,s.melisData.item_melisKey,{idPage:s.melisData.page_id})}if("delete"===i){var n=(s=t.data).melisData.item_zoneid,r=s.melisData.page_id,o="root_1"==t.getParent().key?-1:t.getParent().key,l=(e("#leftResetTreeView"),e(".tabsbar a[data-id='"+n+"']").parent("li"));melisCoreTool.confirm(translations.tr_meliscms_menu_delete,translations.tr_meliscms_menu_cancel,translations.tr_meliscms_delete_confirmation,translations.tr_meliscms_delete_confirmation_msg,(function(){melisCms.refreshTreeview(o,1),e.ajax({url:"/melis/MelisCms/Page/deletePage?idPage="+r,encode:!0}).done((function(e){1===e.success?(1===l.length&&melisHelper.tabClose(n),melisHelper.melisOkNotification(e.textTitle,e.textMessage,"#72af46"),melisCore.flashMessenger()):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,"#000")})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))}))}if("dupe"===i){s=t.data;n="id_meliscms_tools_tree_modal_form_handler",melisKey="meliscms_tools_tree_modal_form_handler",d="melis/MelisCms/TreeSites/renderTreeSitesModalContainer",melisHelper.createModal(n,melisKey,!1,{sourcePageId:s.melisData.page_id},d,(function(){}))}if("export"===i||"import"===i){var d="/melis/MelisCms/Page/renderPageExportImportModalHandler";s=t.data;"export"===i?melisHelper.createModal("id_meliscms_page_export_modal","meliscms_page_export_modal",!0,{pageId:s.melisData.page_id},d,(function(){})):melisHelper.createModal("id_meliscms_page_import_modal","meliscms_page_import_modal",!0,{pageId:s.melisData.page_id},d,(function(){}))}}},lazyLoad:function(e,t){var i=t.node.data.melisData.page_id;t.result={url:"/melis/MelisCms/TreeSites/get-tree-pages-by-page-id?nodeId="+i,data:{mode:"children",parent:t.node.key},cache:!1}},create:function(t,i){melisHelper.loadingZone(e("#treeview-container"))},init:function(t,i,a){melisHelper.removeLoadingZone(e("#treeview-container")),e("input[name=left_tree_search]").trigger("focus");var s=e.ui.fancytree.getTree("#id-mod-menu-dynatree");0===s?.count()?(e(".meliscms-search-box.sidebar-treeview-search").hide(),e.get("/melis/MelisCms/TreeSites/checkUserPageTreeAccress",{idPage:-1},(function(t){t.isAccessible&&e("#id-mod-menu-dynatree").prepend("<div class='create-newpage'><span class='btn btn-success'>"+translations.tr_meliscms_create_page+"</span></div>")}))):(e(".meliscms-search-box.sidebar-treeview-search").show(),e("#id-mod-menu-dynatree .create-newpage").remove())},click:function(t,i){var s=i.targetType,n=i.node;if("title"===s&&(t.preventDefault(),e(n.li).find(".fancytree-expander").trigger("click"),melisCore.screenSize<=1024)){var r=(i=i.node.data).melisData.page_id+" - "+i.melisData.page_title;melisHelper.tabOpen(r,i.iconTab,i.melisData.item_zoneid,i.melisData.item_melisKey,{idPage:i.melisData.page_id},null,(()=>{melisCms.pageTabOpenCallback(i.melisData.page_id),loader.addActivePageEditionLoading(i.melisData.item_zoneid)}))}e(".hasNiceScroll").getNiceScroll().resize(),a.length&&a.removeClass("hide-arrow")},dblclick:function(t,i){var a=(i=i.node.data).melisData.page_id+" - "+i.melisData.page_title;return melisHelper.tabOpen(a,i.iconTab,i.melisData.item_zoneid,i.melisData.item_melisKey,{idPage:i.melisData.page_id},null,(()=>{melisCms.pageTabOpenCallback(i.melisData.page_id),loader.addActivePageEditionLoading(i.melisData.item_zoneid)})),e(".hasNiceScroll").getNiceScroll().resize(),!1},renderNode:function(t,i){e(i.node.span).find(".fancytree-icon").addClass(i.node.data.iconTab).removeClass("fancytree-icon"),"loading"!==i.node.statusNodeType&&(0===i.node.data.melisData.page_is_online&&e(i.node.span).find(".fancytree-title, .fa").css("color","#686868"),1===i.node.data.melisData.page_has_saved_version&&0==e(i.node.span).children("span").hasClass("unpublish")&&e(i.node.span).find(".fancytree-title").before("<span class='unpublish'></span>"),setTimeout((function(){e(i.node.span).find(".fancytree-expander")&&e(i.node.span).find(".fancytree-expander").removeClass("fa fa-spinner fa-pulse")}),1e3))},dnd:{autoExpandMS:400,smartRevert:!0,refreshPositions:!0,draggable:{zIndex:1e3,scroll:!1,appendTo:"body"},dragStart:function(t,i){var a=e("#leftLockDragDropTreeView .fa-lock").length;return melisCore.screenSize>=1024&&0===a&&!!i.node.data.dragdrop},dragEnter:function(e,t){return!0},dragOver:function(e,t){},dragLeave:function(e,t){},dragStop:function(e,t){},dragDrop:function(t,i){t.setExpanded(!0).always((function(){var a=i.otherNode.getParent().key.toString().includes("root")?-1:i.otherNode.getParent().key;i.otherNode.moveTo(t,i.hitMode);e.ui.fancytree.getTree("#id-mod-menu-dynatree");var s=i.otherNode.key,n=t.getParent().key.toString().includes("root")?-1:t.getParent().key;"over"==i.hitMode&&(n=i.node.key);var r={idPage:s,oldFatherIdPage:a,newFatherIdPage:n,newPositionIdPage:i.otherNode.getIndex()+1};e.ajax({url:"/melis/MelisCms/Page/movePage",data:r,encode:!0}).done((function(e){})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))}))}}})},mainTree(),a.on("click","#id-mod-menu-dynatree .create-newpage .btn",(function(){melisHelper.tabOpen(translations.tr_meliscms_page_creation,"fa-file-text-o","0_id_meliscms_page","meliscms_page_creation",{idPage:0,idFatherPage:"-1"})})),a.on("click","#sourcePageIdFindPageTree .input-button-hover-pointer",(function(){melisLinkTree.createInputTreeModal("#sourcePageId")})),a.on("click","#destinationPageIdFindPageTree .input-button-hover-pointer",(function(){melisLinkTree.createInputTreeModal("#destinationPageId")})),a.on("click",'button[data-inputid="#destinationPageId"]',(function(){e('[name="use_root"]').each((function(){e(this).is(":checked")&&e(this).prop("checked",!1)})),e(".remember-me-cont .cbmask-inner").removeClass("cb-active"),e("#destinationPageId").prop("disabled",!1)})),a.on("change",'[name="use_root"]',(function(){e('[name="use_root"]:checked').length?(e("#destinationPageId").val(""),e("#destinationPageId").prop("disabled",!0)):e("#destinationPageId").prop("disabled",!1)})),t.treeCallBack=function(){0==e("#id-mod-menu-dynatree").children().length&&e.ui.fancytree.getTree("#id-mod-menu-dynatree").reload()},a.on("click","#duplicatePageTree",(function(){var t=e("#duplicatePageTreeForm").serializeArray(),i=e('#duplicatePageTreeForm input[name="destinationPageId"]').val();melisCoreTool.pending("#duplicatePageTree"),e("#duplicatePageTree").find("i").removeClass(),e("#duplicatePageTree").find("i").addClass("fa fa-spinner fa-spin"),e.ajax({type:"POST",url:"/melis/MelisCms/TreeSites/duplicateTreePage",data:t,dataType:"json",encode:!0}).done((function(t){t.success?(e("#id_meliscms_tools_tree_modal_form_handler_container").modal("hide"),melisCms.refreshTreeview(i,1),melisHelper.melisOkNotification(t.textTitle,t.textMessage)):(melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors),melisCoreTool.highlightErrors(t.success,t.errors,"duplicatePageTreeForm")),melisCore.flashMessenger(),melisCoreTool.done("#duplicatePageTree"),e("#duplicatePageTree").find("i").removeClass(),e("#duplicatePageTree").find("i").addClass("fa fa-save")})).fail((function(){alert(translations.tr_meliscore_error_message)}))}))}(jQuery,window),$(document).ready((function(){var e=$("body");e.on("click",".btnEditTemplates",(function(){var e=$(this).parents("tr").attr("id");melisCoreTool.hideAlert("#templateupdateformalert"),melisCoreTool.showOnlyTab("#modal-template-manager-actions","#id_modal_tool_template_edit"),toolTemplate.retrieveTemplateData(e)})),e.on("click",".btnDelTemplate",(function(){var e=$(this).parents("tr").attr("id");toolTemplate.deleteTemplate(e)})),e.on("click","#id_meliscms_tool_templates_header_add",(function(){melisCoreTool.hideAlert("#templateaddformalert"),melisCoreTool.resetLabels("#id_modal_tool_template_add #id_tool_template_generic_form")})),e.on("click","#btnTemplateUpdate",(function(){toolTemplate.updateTemplate()})),e.on("click",".btnMelisTemplatesExport",(function(){var e=$("input[type='search'][aria-controls='tableToolTemplateManager']").val(),t=$("#templatesSiteSelect").val();melisCoreTool.isTableEmpty("tableToolTemplateManager")||melisCoreTool.exportData("/melis/MelisCms/ToolTemplate/exportToCsv?filter="+e+"&site="+t)})),e.on("change","#templatesSiteSelect",(function(){var e=$(this).parents().eq(6).find("table").attr("id");$("#"+e).DataTable().ajax.reload()}))}));var toolTemplate={table:function(){return"#tableToolTemplate"},initTool:function(){melisCoreTool.initTable(toolTemplate.table())},refreshTable:function(){melisCoreTool.switchTab("#id_modal_tool_template_add"),melisHelper.zoneReload("id_meliscms_tool_templates","meliscms_tool_templates")},addNewTemplate:function(){var e=$("#id_modal_tool_template_add #id_tool_template_generic_form").serialize();melisCoreTool.pending("#btnTemplateAdd"),$.ajax({type:"POST",url:"/melis/MelisCms/ToolTemplate/newTemplateData",data:e,dataType:"json",encode:!0}).done((function(e){e.success?($("#modal-template-manager-actions").modal("hide"),toolTemplate.refreshTable(),melisCoreTool.clearForm("id_tool_template_generic_form"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisCoreTool.alertDanger("#templateaddformalert","",e.textMessage),melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_modal_tool_template_add #id_tool_template_generic_form")),melisCore.flashMessenger(),melisCoreTool.done("#btnTemplateAdd")})).fail((function(){alert(translations.tr_meliscore_error_message)}))},updateTemplate:function(){var e=$("#id_modal_tool_template_edit #id_tool_template_generic_form").serializeArray();e.push({name:"tpl_id",value:$("#tplid").html()}),e=$.param(e),melisCoreTool.resetLabels("#id_modal_tool_template_edit #id_tool_template_generic_form"),melisCoreTool.pending("#btnTemplateEdit"),$.ajax({type:"POST",url:"/melis/MelisCms/ToolTemplate/updateTemplateData",data:e,dataType:"json",encode:!0}).done((function(e){e.success?($("#modal-template-manager-actions").modal("hide"),toolTemplate.refreshTable(),melisCoreTool.clearForm("id_tool_template_generic_form"),melisCoreTool.resetLabels("#id_tool_template_generic_form"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisCoreTool.alertDanger("#templateupdateformalert","",e.textMessage),melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_tool_template_generic_form")),melisCore.flashMessenger(),melisCoreTool.done("#btnTemplateEdit")})).fail((function(){alert(translations.tr_meliscore_error_message)}))},retrieveTemplateData:function(e){var t="#id_modal_tool_template_edit form#id_tool_template_generic_form ";melisCoreTool.resetLabels(t),$.ajax({type:"POST",url:"/melis/MelisCms/ToolTemplate/getTemplateDataById",data:{templateId:e},dataType:"json",encode:!0}).done((function(e){$.each(e,(function(e,i){if($(t+" input, "+t+" select").each((function(e){var a=$(this).attr("name");$(t+" #"+$(this).attr("id")).val(i[a]),$("#tplid").html(i.tpl_id)})),i.tpl_type_KO){var a=$("#id_modal_tool_template_edit #tpl-type-error");a.show(),a.parent("label").css("color","rgb(255, 0, 0)")}}))})).fail((function(){alert(translations.tr_meliscore_error_message)}))},deleteTemplate:function(e){melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_tool_template_fm_delete_title,translations.tr_tool_template_fm_delete_confirm,(function(){$.ajax({type:"POST",url:"/melis/MelisCms/ToolTemplate/deleteTemplateData",data:{templateId:e},dataType:"json",encode:!0}).done((function(e){melisCoreTool.pending(".delTemplate"),e.success&&(toolTemplate.refreshTable(),melisCore.flashMessenger(),melisHelper.melisOkNotification(e.textTitle,e.textMessage)),melisCoreTool.done(".delTemplate")})).fail((function(){alert(translations.tr_meliscore_error_message)}))}))}};window.initTemplateList=function(e,t){var i=$("#templatesSiteSelect");i.length&&(e.tpl_site_id=i.val())},$((function(){var e="#formplatformedit form#idformlang";function t(e,t){$("body").on("click",e,t)}t("#btn_cms_new_lang",(function(){melisCoreTool.showOnlyTab("#modal-language-cms","#id_meliscms_tool_language_modal_content_new"),melisCoreTool.clearForm("idformlang")})),t("#btnLangCmsAdd",(function(){var e=$(this).parent().find("#idformlang").serialize();melisCoreTool.pending("#btnLangCmsAdd"),melisCoreTool.processing(),$.ajax({type:"POST",url:"/melis/MelisCms/Language/addLanguage",data:e,dataType:"json",encode:!0}).done((function(e){e.success?($("#modal-language-cms").modal("hide"),melisHelper.zoneReload("id_meliscms_tool_language","meliscms_tool_language"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisCoreTool.alertDanger("#languagealert","",e.textMessage),melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"idformlang")),melisCoreTool.done("#btnLangCmsAdd"),melisCore.flashMessenger(),melisCoreTool.processDone()})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))})),t("#btnLangCmsEdit",(function(){melisCoreTool.showOnlyTab("#modal-language-cms","#id_meliscms_tool_language_modal_content_edit");var t=$(this).parents("tr").attr("id");$.ajax({type:"POST",url:"/melis/MelisCms/Language/getLanguageById",data:{id:t},dataType:"json",encode:!0}).done((function(t){melisCoreTool.pending(".btn"),$(e+" input[type='text']").each((function(e){var i=$(this).attr("name");$("input#"+$(this).attr("id")).val(t.language[i]),$("span#platformupdateid").html(t.language.lang_cms_id)})),melisCoreTool.done(".btn")})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))})),t("#btnLangEdit",(function(){var t=$(e).serializeArray();t.push({name:"id",value:$("#platformupdateid").html()}),t=$.param(t),melisCoreTool.pending("#btnLangEdit"),melisCoreTool.processing(),$.ajax({type:"POST",url:"/melis/MelisCms/Language/editLanguage",data:t,dataType:"json",encode:!0}).done((function(e){e.success?($("#modal-language-cms").modal("hide"),melisHelper.zoneReload("id_meliscms_tool_language","meliscms_tool_language"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisCoreTool.alertDanger("#langeditalert","",e.textMessage),melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"formplatformedit form#idformlang")),melisCoreTool.done("#btnLangEdit"),melisCore.flashMessenger(),melisCoreTool.processDone()})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),t("#btnLangCmsDelete",(function(){var e=$(this).parents("tr").attr("id");melisCoreTool.confirm(translations.tr_meliscms_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscms_tool_language,translations.tr_meliscms_tool_language_delete_confirm,(function(){$.ajax({type:"POST",url:"/melis/MelisCms/Language/deleteLanguage",data:{id:e},dataType:"json",encode:!0}).done((function(e){melisCoreTool.pending(".btn-danger"),e.success?(melisHelper.zoneReload("id_meliscms_tool_language_content","meliscms_tool_language_content"),melisHelper.zoneReload("id_meliscms_header_language","meliscms_header_language"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger(),melisCoreTool.done(".btn-danger")})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))}))}))})),window.initLangJs=function(){$('#tableLanguages td:nth-child(3):contains("'+melisLangId+'")').siblings(":last").html("-")},$((function(){var e=$("body");e.on("click",".btnCmsPlatfomEdit",(function(){var e=$(this).parents("tr").attr("id");modalId="platform_tool_modal",platform_modal_content="meliscms_tool_platform_ids_modal_content",modalUrl="/melis/MelisCms/Platform/renderPlatformModal",melisHelper.createModal(modalId,platform_modal_content,!1,{id:e},modalUrl)})),e.on("click",".btnSavePlatfomrRange",(function(){var e=$(this).data("id"),t=$("#idformplatform").serializeArray();t.push({name:"pids_id",value:e}),t=$.param(t),$("#cmsPlatformAlert").addClass("hidden"),$.ajax({type:"POST",url:"/melis/MelisCms/Platform/savePlatformIdsRange",data:t,dataType:"json",encode:!0}).done((function(e){e.success?($("#platform_tool_modal_container").modal("hide"),melisHelper.zoneReload("id_meliscms_tool_platform_ids","meliscms_tool_platform_ids"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisCoreTool.alertDanger("#cmsPlatformAlert","",e.textMessage),melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors)),melisCore.flashMessenger(),melisCoreTool.highlightErrors(e.success,e.errors,"idformplatform")})).fail((function(e,t,i){alert("ERROR !! Status = "+t+"\n Error = "+i+"\n xhr = "+e.statusText)}))})),e.on("click","#id_meliscms_tool_platform_ids_add_button",(function(){modalId="platform_tool_modal",platform_modal_content="meliscms_tool_platform_ids_modal_content",modalUrl="/melis/MelisCms/Platform/renderPlatformModal",melisHelper.createModal(modalId,platform_modal_content,!1,null,modalUrl)})),e.on("click",".btnCmsPlatformIdsDelete",(function(){var e=$(this).parents("tr").attr("id"),t=new Array;t.push({name:"pid_id",value:e}),melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscms_tool_platform_ids,translations.tr_meliscms_tool_platform_ids_confirm_msg,(function(){$.ajax({type:"POST",url:"/melis/MelisCms/Platform/deletePlatformId",data:t,dataType:"json",encode:!0}).done((function(e){melisHelper.zoneReload("id_meliscms_tool_platform_ids","meliscms_tool_platform_ids"),melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisCore.flashMessenger()})).fail((function(){alert(translations.tr_meliscore_error_message)}))}))})),window.initPlatformIdTbl=function(){var e="#platformToolTable";$(e).find(".noPlatformIdDeleteBtn").each((function(){var t="#"+$(this).attr("id");$(e).find(t).find(".btnCmsPlatformIdsDelete").remove()}))}})),$((function(){var e=$("body");e.on("click",".addRedirectSite",(function(){var e=$(this).data("s301id");createSite301Modal(e)})),e.on("click",".editRedirectSite",(function(){var e=$(this).parents("tr").attr("id");createSite301Modal(e)})),e.on("click",".saveSiteRedirect",(function(){$(this).data("s301id");var e=new Array;e=$("#siteRedirectForm").serializeArray(),$.ajax({type:"POST",url:"/melis/MelisCms/SiteRedirect/saveSiteRedirect",data:e,dataType:"json",encode:!0}).done((function(e){e.success?($("#id_meliscms_tool_site_301_generic_form_container").modal("hide"),melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscms_tool_site_301_content","meliscms_tool_site_301_content")):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger(),melisCoreTool.highlightErrors(e.success,e.errors,"siteRedirectForm")})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),e.on("click",".deleteRedirectSite",(function(){var e=$(this).parents("tr").attr("id");melisCoreTool.confirm(translations.tr_meliscms_common_yes,translations.tr_meliscms_common_no,translations.tr_meliscms_tool_site_301_delete_site_redirect,translations.meliscms_tool_site_301_delete_confirm_msg,(function(){$.ajax({type:"POST",url:"/melis/MelisCms/SiteRedirect/deleteSiteRedirect",data:{s301Id:e},dataType:"json",encode:!0}).done((function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscms_tool_site_301_content","meliscms_tool_site_301_content")):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger()})).fail((function(){alert(translations.tr_meliscore_error_message)}))}))})),e.on("click",".testRedirectSite",(function(){var e=$(this).parents("tr").attr("id"),t=$("#tableToolSite301 tr#"+e+" td:nth-child(4)").text();""!==t?window.open(t,"_blank"):alert(translations.tr_meliscore_error_message)})),e.on("change","#redirectSiteSelect",(function(){var e=$(this).parents().eq(6).find("table").attr("id");$("#"+e).DataTable().ajax.reload()}))})),window.createSite301Modal=function(e){void 0===e&&(e=null),zoneId="id_meliscms_tool_site_301_generic_form",melisKey="meliscms_tool_site_301_generic_form",modalUrl="/melis/MelisCms/SiteRedirect/renderToolSiteRedirectModal",melisHelper.createModal(zoneId,melisKey,!1,{s301Id:e},modalUrl)},window.initRedirectTemplateList=function(e,t){$("#redirectSiteSelect").length&&(e.s301_site_id=$("#redirectSiteSelect").val())};var melisLinkTree=function(e,t){var i=e("body");function a(){var t=e("input[name=tree_search]").val().trim(),i=e.ui.fancytree.getTree("#find-page-dynatree"),a=i.filterNodes,s={};i.clearFilter(),i.getRootNode().visit((function(e){e.resetLazy()})),e("input[name=tree_search]").prop("disabled",!0);var n=e("input[name=tree_search]").closest(".meliscms-search-box");n.addClass("searching"),e.ajax({type:"POST",url:"melis/MelisCms/Page/searchTreePages",data:{name:"value",value:t},dataType:"json",encode:!0}).done((function(r){if(Array.isArray(r)){var o=e.map(r,(function(e){return e}));i.loadKeyPath(o,(function(e,n){if(!e.isVisible())switch(n){case"loaded":case"ok":e.makeVisible()}a.call(i,t,s)})).done((function(){e("input[name=tree_search]").prop("disabled",!1),n.removeClass("searching")}))}else n.append("<div class='melis-search-overlay'>Not Found</div>").hide().fadeIn(600),setTimeout((function(){e(".melis-search-overlay").fadeOut(600,(function(){e(this).remove()})),e("input[name=tree_search]").prop("disabled",!1),e("input[name=tree_search]").trigger("focus")}),1e3)})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))}function s(i){var a=e("body"),s=a.find(".tox-dialog"),n=a.find("#mce-link-tree"),r=t.parent.$(".melis-iframe"),o=r.contents().find(".tox-dialog"),l=r.contents().find("#mce-link-tree");o.length&&l.parent().find("input").val(i),s.length&&n.parent().find("input").val(i)}function n(){zoneId="id_meliscms_find_page_tree",melisKey="meliscms_find_page_tree",modalUrl="melis/MelisCms/Page/renderPageModal",e("#id_meliscms_find_page_tree_container").length&&e("#id_meliscms_find_page_tree_container").parent().remove(),t.parent.melisHelper.createModal(zoneId,melisKey,!1,{},modalUrl,(function(){})),e("#mce-link-tree").closest(".tox-dialog").css("z-index",1049),e(".tox-tinymce-aux").css("z-index",1048),e(".tox-tinymce-aux").find(".tox-dialog-wrap__backdrop").css("z-index",1047)}return i.on("click","#mce-link-tree",n),e(document).on("keyup","input[name=tree_search]",(function(e){"Enter"===(e.key?e.key:e.which)&&a()})).trigger("focus"),i.on("click","#searchTreeView",(function(e){a()})),i.on("click","#resetTreeView",(function(t){melisHelper.loadingZone(e(".page-evolution-content")),e("input[name=tree_search]").val("");var i=e.ui.fancytree.getTree("#find-page-dynatree");i.clearFilter(),i.getRootNode().visit((function(e){e.setExpanded(!1)})),setTimeout((function(){melisHelper.removeLoadingZone(e(".page-evolution-content"))}),2e3)})),i.on("click","#generateTreePageLink",(function(){melisCoreTool.pending("#generateTreePageLink");var t=e("#find-page-dynatree .fancytree-active").parent("li").attr("id");if(t?.split("_")){var i=t.split("_")[1];e.ajax({type:"GET",url:"melis/MelisCms/Page/getPageLink",data:{idPage:i},dataType:"json",encode:!0}).done((function(t){s(t.link),e("#id_meliscms_find_page_tree_container").modal("hide")})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))}else confirm("Need to select one of the pages.");melisCoreTool.done("#generateTreePageLink")})),i.on("click","#generateTreePageId",(function(){melisCoreTool.pending("#generateTreePageLink");var t=e("#find-page-dynatree .fancytree-active").parent("li").attr("id").split("_")[1],i=e("#generateTreePageId").data("inputid");e(i).val(t),e("#id_meliscms_input_page_tree_container").modal("hide"),melisCoreTool.done("#generateTreePageLink")})),{createTreeModal:n,createInputTreeModal:function(i){zoneId="id_meliscms_input_page_tree",melisKey="meliscms_input_page_tree",modalUrl="melis/MelisCms/Page/renderPageModal",e("#id_meliscms_input_page_tree_container").length&&e("#id_meliscms_input_page_tree_container").parent().remove(),t.parent.melisHelper.createModal(zoneId,melisKey,!1,{pageTreeInputId:i},modalUrl,(function(){}))},findPageMainTree:function(){e("#find-page-dynatree").fancytree({extensions:["filter"],keyboard:!0,generateIds:!0,idPrefix:"pageid_",source:{url:"/melis/MelisCms/TreeSites/get-tree-pages-by-page-id",cache:!0},lazyLoad:function(e,t){var i=t.node.data.melisData.page_id;t.result={url:"/melis/MelisCms/TreeSites/get-tree-pages-by-page-id?nodeId="+i,data:{mode:"children",parent:t.node.key},cache:!1}},renderNode:function(t,i){e(i.node.span).find(".fancytree-icon").addClass(i.node.data.iconTab).removeClass("fancytree-icon"),"loading"!==i.node.statusNodeType&&1===i.node.data.melisData.page_has_saved_version&&0==e(i.node.span).children("span").hasClass("unpublish")&&e(i.node.span).find(".fancytree-title").before("<span class='unpublish'></span>")},filter:{autoApply:!0,autoExpand:!1,counter:!0,fuzzy:!1,hideExpandedCounter:!0,hideExpanders:!1,highlight:!0,leavesOnly:!1,nodata:!0,mode:"dimm"}})},checkBtn:function(){i.find(".mce-has-open").prev().text(),i.find(".mce-has-open")[0],i.find(".mce-widget.mce-label").each((function(){if("Url"===e(this).text()){var t,a=i.find(".mce-btn.mce-open"),s=a.width()+1,n=e(this).next(),r=n.children(".mce-textbox");a.length?(t=r.width()-s,a.css({left:"0"}),r.css({width:t}),i.find(".mce-has-open").append('<div id="mce-link-tree" class="mce-btn mce-open" style="position: absolute; right: 0; width: 32px; height: 28px;"><button><i class="icon icon-sitemap fa fa-sitemap" style="font-family: FontAwesome; position: relative; top: 2px; font-size: 16px;"></i></button></div>')):(t=r.width()-32,r.css({width:t}),n.append('<div id="mce-link-tree" class="mce-btn mce-open" style="position: absolute; right: 0; width: 32px; height: 28px;"><button><i class="icon icon-sitemap fa fa-sitemap" style="font-family: FontAwesome; position: relative; top: 2px; font-size: 16px;"></i></button></div>'))}}))},showUrl:s}}(jQuery,window);$((function(){$("body").on("click","a.melis-pageduplicate",(function(){var e=$(this).data().pagenumber;$.ajax({type:"POST",url:"/melis/MelisCms/PageDuplication/duplicate-page",data:{id:e},dataType:"json",encode:!0}).done((function(e){if(e.success){if(melisCms.refreshTreeview(e.response.pageId),e.response.openPageAfterDuplicate){var t=e.response.pageId+" - "+e.response.name;melisHelper.tabOpen(t,e.response.icon,e.response.pageId+"_id_meliscms_page","meliscms_page",{idPage:e.response.pageId},null,(()=>{loader.addActivePageEditionLoading(e.response.pageId+"_id_meliscms_page")}))}melisHelper.melisOkNotification(e.textTitle,e.textMessage)}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,0);melisCore.flashMessenger()})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))}))}));var melisSearchPageTree=function(e,t){var i=e("body");function a(){var t=e("input[name=left_tree_search]").val().trim(),i=e.ui.fancytree.getTree("#id-mod-menu-dynatree"),a=i.filterNodes;if(t.length){var s={};e(".meliscms-search-box.sidebar-treeview-search").append("<div class='melis-overlay-loading'></div>"),i.clearFilter(),i.getRootNode().visit((function(e){e.isExpanded()&&e.resetLazy()})),e("input[name=left_tree_search]").prop("disabled",!0);var n=e("input[name=left_tree_search]").closest(".meliscms-search-box");e.ajax({type:"POST",url:"melis/MelisCms/Page/searchTreePages",data:{name:"value",value:t},dataType:"json",encode:!0}).done((function(r){if(r){var o=e.map(r,(function(e){return e}));i.loadKeyPath(o,(function(e,n){switch(n){case"loaded":case"ok":e.makeVisible()}a.call(i,t,s)})).done((function(){e("input[name=left_tree_search]").prop("disabled",!1),e(".meliscms-search-box.sidebar-treeview-search .melis-overlay-loading").remove(),e("input[name=left_tree_search]").trigger("focus")}))}else n.append("<div class='melis-search-overlay'>"+translations.tr_meliscms_form_search_not_found+"</div>").hide().fadeIn(600),setTimeout((function(){e(".melis-search-overlay").fadeOut(600,(function(){e(this).remove()})),e("input[name=left_tree_search]").prop("disabled",!1),e("input[name=left_tree_search]").trigger("focus"),e(".meliscms-search-box.sidebar-treeview-search .melis-overlay-loading").remove()}),1e3)})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))}}i.on("click","#leftSearchTreeView",(function(e){a()})),i.on("click","#leftLockDragDropTreeView",(function(){var t,i,a=e(this),s=e("#leftResetTreeView"),n=a.find(".fa.fa-lock"),r=a.find(".fa.fa-unlock");s.trigger("click"),n.length&&(n.removeClass("fa-lock").addClass("fa-unlock"),a.attr("title",translations.tr_meliscms_menu_treeview_page_unlock),t=3e5,i=setInterval((function(){var a=e("#leftLockDragDropTreeView"),s=a.find(".fa.fa-unlock");s.length&&(setTimeout((function(){s.removeClass("fa-unlock").addClass("fa-lock"),a.attr("title",translations.tr_meliscms_menu_treeview_page_lock)}),t),clearInterval(i))}),3e4)),r.length&&(r.removeClass("fa-unlock").addClass("fa-lock"),a.attr("title",translations.tr_meliscms_menu_treeview_page_lock))})),e(document).on("keyup","input[name=left_tree_search]",(function(e){"Enter"===(e.key?e.key:e.which)&&a()})),i.on("click","#leftResetTreeView",(function(t){e("input[name=left_tree_search]").val("");var i=e.ui.fancytree.getTree("#id-mod-menu-dynatree");i.clearFilter(),i.reload()})),e("#leftLockDragDropTreeView").attr("title",translations.tr_meliscms_menu_treeview_page_lock)}(jQuery,window);$((function(){var e=$("body");e.on("click",".pageLangCreate",(function(){var e=$(this),t=e.data("pageid"),i=e.data("formid"),a=$("#"+i).serializeArray();e.attr("disabled",!0),$.ajax({type:"POST",url:"/melis/MelisCms/PageLanguages/createNewPageLangVersion",data:a,dataType:"json",encode:!0}).done((function(a){a.success?($.isEmptyObject(a.pageInfo)||(melisHelper.tabOpen(a.pageInfo.pageid+" - "+a.pageInfo.name,a.pageInfo.tabicon,a.pageInfo.id,a.pageInfo.meliskey,{idPage:a.pageInfo.pageid}),melisCms.refreshTreeview(a.pageInfo.pageid)),melisHelper.zoneReload(t+"_id_meliscms_page","meliscms_page",{idPage:t}),melisHelper.melisOkNotification(a.textTitle,a.textMessage)):(melisCoreTool.alertDanger("#cmsPlatformAlert","",a.textMessage),melisHelper.melisKoNotification(a.textTitle,a.textMessage,a.errors)),melisCore.flashMessenger(),melisCoreTool.highlightErrors(a.success,a.errors,i),e.attr("disabled",!1)})).fail((function(t,i,a){e.attr("disabled",!1),alert(translations.tr_meliscore_error_message)}))})),e.on("click",".open-page-from-lan-tab",(function(){var e=$(this).data();$.isEmptyObject(e)||melisHelper.tabOpen(e.pageid+" - "+e.name,e.tabicon,e.id,e.meliskey,{idPage:e.pageid})}))})),$((function(){var e=$("body");e.on("click","#id_meliscms_tool_styles_header_add",(function(){melisStyleTool.openToolModal(0)})),e.on("click",".btnEditStyles",(function(){var e=$(this).closest("tr").attr("id");melisStyleTool.openToolModal(e)})),e.on("click","#saveStyleDetails",(function(){$(this).data("style-id");var e=$("#stylesForm").serializeArray();melisStyleTool.saveStyleDetails(e)})),e.on("click",".btnDelStyle",(function(){var e=$(this).closest("tr").attr("id");melisStyleTool.deleteStyle(e)})),e.on("click","#styleInputFindPageTree span",(function(){melisLinkTree.createInputTreeModal("#id_style_page_id")}))}));var melisStyleTool=function(e,t){return{openToolModal:function(e){zoneId="id_meliscms_tool_styles_modal_form_handler",melisKey="meliscms_tool_styles_modal_form_handler",modalUrl="melis/MelisCms/ToolStyle/renderToolStyleModalContainer",melisHelper.createModal(zoneId,melisKey,!1,{styleId:e},modalUrl,(function(){}))},saveStyleDetails:function(t){melisCoreTool.pending("#saveStyleDetails"),e.ajax({type:"POST",url:"/melis/MelisCms/ToolStyle/saveStyleDetails",data:t,dataType:"json",encode:!0}).done((function(t){t.success?(e("#id_meliscms_tool_styles_modal_form_handler_container").modal("hide"),melisStyleTool.refreshTable(),melisHelper.melisOkNotification(t.textTitle,t.textMessage)):(melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors),melisCoreTool.highlightErrors(t.success,t.errors,"stylesForm")),melisCore.flashMessenger(),melisCoreTool.done("#saveStyleDetails")})).fail((function(){alert(translations.tr_meliscore_error_message)}))},deleteStyle:function(t){var i={styleId:t};melisCoreTool.pending(".btnDelStyle"),melisCoreTool.confirm(translations.tr_meliscms_common_yes,translations.tr_meliscms_common_no,translations.tr_meliscms_tool_styles_delete_title,translations.tr_meliscms_tool_styles_delete_details,(function(){e.ajax({type:"POST",url:"/melis/MelisCms/ToolStyle/deleteStyle",data:i,dataType:"json",encode:!0}).done((function(e){melisCoreTool.done(".btnDelStyle"),e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisStyleTool.refreshTable()):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger()})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))}))},refreshTable:function(){melisHelper.zoneReload("id_meliscms_tool_styles_content","meliscms_tool_styles_content")}}}(jQuery,window);$((function(){var e=$("body");e.on("change","#id_mcgdprbanner_site_id",(function(){melisCoreTool.highlightErrors(1,null,"id_melis_cms_gdpr_banner_header"),melisHelper.zoneReload("id_melis_cms_gdpr_banner_details","melis_cms_gdpr_banner_details",{siteId:this.value}),this.value>0?e.find(".cms-gdpr-save").show():e.find(".cms-gdpr-save").hide()})),e.on("click",".cms-gdpr-save",(function(){if(void 0===e.find(this).attr("disabled")){melisCoreTool.pending(".cms-gdpr-save");var t={},i=[],a=e.find("#cms_gdpr_banner_site_filter_form");a.length>0&&(t.filters={siteId:a.serializeArray()}),e.find(".mcms-gdpr-banner-language").each((function(t,a){i.push(e.find(a).data("langId"))}));for(var s=[],n={},r=0;r<i.length;r++)(s=e.find("#id-cms-gdpr-banner-content-form-"+i[r])).length>0&&(n[i[r]]=s.serializeArray());t.bannerContent=n,$.ajax({type:"POST",url:"/melis/MelisCms/GdprBanner/saveBanner",data:t,dataType:"json",encode:!0}).done((function(t){t.success?(melisHelper.melisOkNotification(t.textTitle,t.textMessage),e.find("#id_mcgdprbanner_site_id").trigger("change")):(melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors),melisCoreTool.highlightErrors(0,t.errors,"id_melis_cms_gdpr_banner")),melisCore.flashMessenger(),melisCoreTool.done(".cms-gdpr-save")})).fail((function(e,t,i){melisCoreTool.done(".cms-gdpr-save")}))}}))})),$((function(){var e,t,i=$("body"),a="";function s(e){$(".page-export-progress prog_percent").text(e),$("div#exportImportProgressbar").attr("arial-valuenow",e).css("width",e+"%").parent().parent().removeClass("hidden")}i.on("click","#btn-export-pages",(function(){var e=!0;melisCoreTool.pending("#btn-export-pages"),s(0),$(".page-export-form").addClass("hidden");var t=$("#pageExportForm").serializeArray();$.ajax({url:"/melis/MelisCms/PageExport/exportPage",data:t,type:"POST",dataType:"text",mimeType:"text/plain; charset=x-user-defined",beforeSend:function(){setTimeout((function(){s(20)}),100)}}).done((function(t,a,n){var r;try{r=JSON.parse(t)}catch(i){e=!1,s(100);for(var o=n.getResponseHeader("fileName"),l=n.getResponseHeader("Content-Type"),d="",c=0;c<t.length;c++)d+=String.fromCharCode(255&t.charCodeAt(c));var m=new Uint8Array(d.length);for(c=0;c<d.length;c++)m[c]=d.charCodeAt(c);var _=new Blob([m],{type:l});saveAs(_,o),melisCore.flashMessenger(),melisHelper.melisOkNotification(translations.tr_melis_cms_tree_export_title,translations.tr_melis_cms_tree_export_notification_message,"#72af46")}e&&melisHelper.melisKoNotification(translations.tr_melis_cms_tree_export_page,"",[r.message]),i.find("#btn-export-pages").siblings("button.btn.btn-danger.pull-left").trigger("click"),melisCoreTool.done("#btn-export-pages")})).fail((function(e){melisCoreTool.done("#btn-export-pages")}))})),i.on("click","#page-tree-import-test",(function(){var t;melisCoreTool.pending("#page-tree-import-test"),a=i.find(".bootstrap-filestyle.input-group input").val(),(t=$("#id_meliscms_tree_sites_import_page_form")).off("submit"),t.on("submit",(function(t){t.preventDefault();var s=new FormData(this);$.ajax({type:"POST",url:"/melis/MelisCms/PageImport/checkImportForm",data:s,cache:!1,contentType:!1,processData:!1,beforeSend:function(){i.find("#pageImportConsole").text(""),i.find("#pageImportConsole").css("display",""),i.find("#pageImportConsole").append("<p>"+translations.tr_melis_cms_page_tree_import_name_of_file+": "+a+"</p>"),i.find("#pageImportConsole").append("<p>"+translations.tr_melis_cms_page_tree_import_validated+': <span style="color: red;">'+translations.tr_meliscms_common_no+"</span></p>"),i.find("#pageImportConsole").append('<div id="pageImportProcessing"><p>'+translations.tr_melis_cms_page_tree_import_modal_processing+' <i class="fa fa-spinner fa-spin"></i></p></div>')}}).done((function(t){t.success?(function(e){$.ajax({type:"POST",url:"/melis/MelisCms/PageImport/importTest",data:{formData:JSON.stringify(e)},beforeSend:function(){i.find("#pageImportConsole").animate({scrollTop:i.find("#pageImportConsole").get(0).scrollHeight},2e3)}}).done((function(t){if(t.success){i.find("#importPageForm").css("display","none"),i.find("#importPageValidated").css("display",""),i.find("#importPageValidated .tab-content .tab-pane").append("<p>"+translations.tr_melis_cms_page_tree_import_name_of_file+": "+e.page_tree_import.name+"</p>"),i.find("#importPageValidated .tab-content .tab-pane").append("<p>"+translations.tr_melis_cms_page_tree_import_validated+': <span style="color: green;">'+translations.tr_meliscms_common_yes+"</span></p>");var a='<button type="button" data-bs-dismiss="modal" class="btn btn-danger pull-left">'+translations.tr_meliscms_tool_sites_cancel+"</button>",s='<button type="button" class="btn btn-success" id="page-tree-import">'+translations.tr_melis_cms_page_tree_import_file+"</button>";i.find("#importPageValidated .btn-container").append(a),i.find("#importPageValidated .btn-container").append(s)}else i.find("#pageImportConsole #pageImportProcessing").text(""),i.find("#pageImportConsole #pageImportProcessing").append("<p>"+translations.tr_melis_cms_page_tree_import_modal_processing_done+' <i style="color: green;" class="fa fa-check-circle"></i></p>'),i.find("#pageImportConsole").append('<p style="color: red;">'+translations.tr_melis_cms_page_tree_import_modal_errors+":</p>"),$.each(t.errors,(function(e,t){i.find("#pageImportConsole").append('<p style="color: red;"> - '+t+"</p>")})),i.find("#pageImportConsole").animate({scrollTop:i.find("#pageImportConsole").get(0).scrollHeight},2e3);melisCoreTool.done("#page-tree-import-test")})).fail((function(e){melisCoreTool.done("#page-tree-import-test")}))}(t.result),e=t.result):(melisHelper.melisKoNotification(translations.tr_melis_cms_page_tree_import,"",t.errors),melisCoreTool.done("#page-tree-import-test"))})).fail((function(e){melisCoreTool.done("#page-tree-import-test")}))})),t.trigger("submit")})),i.on("change","input[name=page_tree_import]",(function(){var e=i.find("#page-import-max-file-size").val(),t=this.files[0].size;parseInt(t)>parseInt(e)?(melisCoreTool.pending("#page-tree-import-test"),melisHelper.melisKoNotification(translations.tr_melis_cms_page_tree_import,translations.tr_melis_cms_page_tree_error_file_size_exceeded+function(e,t){if(0===e)return"0 Bytes";const i=1024,a=t<0?0:t,s=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(e)/Math.log(i));return parseFloat((e/Math.pow(i,n)).toFixed(a))+" "+s[n]}(e,2),[])):melisCoreTool.done("#page-tree-import-test")})),i.on("click","#page-tree-import",(function(){var a=$(this).closest("#id_meliscms_page_import_modal").data("pageid");melisCoreTool.confirm(translations.tr_melis_cms_page_tree_import_continue_and_import,translations.tr_meliscms_tool_sites_cancel,translations.tr_melis_cms_page_tree_import_modal_are_you_sure,translations.tr_melis_cms_page_tree_import_modal_are_you_sure_content,(function(){melisCoreTool.pending("#page-tree-import"),$.ajax({type:"POST",url:"/melis/MelisCms/PageImport/importPage",data:{formData:JSON.stringify(e),pageid:a},beforeSend:function(){i.find("#pageImportConsole").css("display",""),i.find("#pageImportConsole").append("<p>"+translations.tr_melis_cms_page_tree_import_name_of_file+": "+e.page_tree_import.name+"</p>"),i.find("#pageImportConsole").append("<p>"+translations.tr_melis_cms_page_tree_import_validated+': <span style="color: red;">'+translations.tr_meliscms_common_no+"</span></p>"),i.find("#pageImportConsole").append('<div id="pageImportProcessing"><p>'+translations.tr_melis_cms_page_tree_import_modal_processing+' <i class="fa fa-spinner fa-spin"></i></p></div>')}}).done((function(a){var s,n,r='<button type="button" id="importPageDoneClose" data-bs-dismiss="modal" class="btn btn-danger pull-left" style="margin-top: -15px; margin-left: -15px;">'+translations.tr_melis_cms_page_tree_import_close+"</button>";if(i.find("#importPageValidated").css("display","none"),i.find("#importPageDone").css("display",""),a.success){t=a.idsMap,i.find("#importPageDone .tab-content .tab-pane .main-error").append("<p>"+translations.tr_melis_cms_page_tree_import_name_of_file+": "+e.page_tree_import.name+"</p>"),i.find("#importPageDone .tab-content .tab-pane .main-error").append("<p>"+translations.tr_melis_cms_page_tree_import_result+': <span style="color: green;">'+translations.tr_melis_cms_page_tree_import_success+"</span></p>"),i.find("#importPageDone .tab-content .tab-pane .main-error").append("</br>");var o=translations.tr_melis_cms_page_tree_import_modal_done+"<br/>"+a.pagesCount+translations.tr_melis_cms_page_tree_import_modal_done2_p+" "+i.find(".pageImportModal").data("pagename")+" ("+i.find(".pageImportModal").data("pageid")+")";1==a.pagesCount&&(o=translations.tr_melis_cms_page_tree_import_modal_done+"<br/>"+a.pagesCount+translations.tr_melis_cms_page_tree_import_modal_done2_s+" "+i.find(".pageImportModal").data("pagename")+" ("+i.find(".pageImportModal").data("pageid")+")"),i.find("#importPageDone .tab-content .tab-pane .main-error").append(o),i.find("#importPageDone .tab-content .tab-pane .main-error").append("</br>"),i.find("#importPageDone .tab-content .tab-pane .main-error").append("</br>"),a.keepIds?i.find("#importPageDone .tab-content .tab-pane .main-error").append('<p><i style="color:red;">NOTE : </i>'+translations.tr_melis_cms_page_tree_import_file_final_message_csv_keep_ids+"</p>"):i.find("#importPageDone .tab-content .tab-pane .main-error").append('<p><i style="color:red;">NOTE : </i>'+translations.tr_melis_cms_page_tree_import_file_final_message_csv+"</p>"),i.find("#importPageDone .btn-container").append(r),melisCore.flashMessenger(),melisHelper.melisOkNotification(translations.tr_melis_cms_page_tree_import_title,translations.tr_melis_cms_page_tree_import_notification_message,"#72af46"),s=a.firstPage,optionalArg=void 0===n?0:n,$.ajax({url:"/melis/MelisCms/TreeSites/getPageIdBreadcrumb?idPage="+s+"&includeSelf="+optionalArg,encode:!0,dataType:"json"}).done((function(e){var t=[];$.each(e,(function(e,i){t.push("/"+i)})),t=(t=t.toString()).replace(/,/g,"");var i=$.ui.fancytree.getTree("#id-mod-menu-dynatree");i.reload({url:"/melis/MelisCms/TreeSites/get-tree-pages-by-page-id"}).done((function(){i.loadKeyPath(t,(function(e,t){"ok"==t&&e.setActive(!0).done((function(){e.setExpanded(!0)}))})).done((function(){i.clearFilter(),!1===$("#id-mod-menu-dynatree .ui-fancytree > li:last-child").hasClass("fancytree-lastsib")&&$("#id-mod-menu-dynatree .ui-fancytree > li:last-child").remove()}))}))})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)})),0!=t&&$.ajax({type:"POST",url:"/melis/MelisCms/PageImport/exportCsv",data:{idsMap:t}}).done((function(e,t,i){if(e){var a=i.getResponseHeader("fileName"),s=i.getResponseHeader("Content-Type"),n=new Blob([i.responseText],{type:s});saveAs(n,a)}}))}else i.find("#importPageDone .tab-content .tab-pane .main-error").append("<p>"+translations.tr_melis_cms_page_tree_import_name_of_file+": "+e.page_tree_import.name+"</p>"),i.find("#importPageDone .tab-content .tab-pane .main-error").append("<p>"+translations.tr_melis_cms_page_tree_import_result+': <span style="color: red;">'+translations.tr_melis_cms_page_tree_import_failed+"</span></p>"),i.find("#importPageDone .tab-content .tab-pane .main-error").append("</br>"),i.find("#importPageDone .tab-content .tab-pane .main-error").append(translations.tr_melis_cms_page_tree_import_modal_unexpected_errors+translations.tr_melis_cms_page_tree_import_modal_unexpected_errors2+"</br>"+translations.tr_melis_cms_page_tree_import_modal_unexpected_error_detail+"</br>"),i.find("#pageImportDoneConsole").css("display",""),$.each(a.errors,(function(e,t){i.find("#importPageDone #pageImportDoneConsole").append('<p style="color: red;"> - '+t+"</p>")})),i.find("#importPageDone .btn-container").append(r);melisCoreTool.done("#page-tree-import")})).fail((function(){melisCoreTool.done("#page-tree-import")}))}))})),i.on("click",".page-import-cont input[type=checkbox]",(function(){var e=$(this);e.is(":checked")?(e.prop("checked",!0),e.prev("span").find(".cbmask-inner").addClass("cb-active")):(e.not(".requried-module").prop("checked",!1),e.parents(".page-import-cont").find(".cbmask-inner").removeClass("cb-active"))}))})),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}((function(e,t){"use strict";if(!e.jstree){var i=0,a=!1,s=!1,n=!1,r=[],o=e("script:last").attr("src"),l=window.document,d=window.setImmediate,c=window.Promise;!d&&c&&(d=function(e,t){c.resolve(t).then(e)}),e.jstree={version:"3.3.16",defaults:{plugins:[]},plugins:{},path:o&&-1!==o.indexOf("/")?o.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},e.jstree.create=function(t,a){var s=new e.jstree.core(++i),n=a;return a=e.extend(!0,{},e.jstree.defaults,a),n&&n.plugins&&(a.plugins=n.plugins),e.each(a.plugins,(function(e,t){"core"!==e&&(s=s.plugin(t,a[t]))})),e(t).data("jstree",s),s.init(t,a),s},e.jstree.destroy=function(){e(".jstree:jstree").jstree("destroy"),e(l).off(".jstree")},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1,ellipsis:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},e.jstree.reference=function(t){var i=null,a=null;if(!t||!t.id||t.tagName&&t.nodeType||(t=t.id),!a||!a.length)try{a=e(t)}catch(a){}if(!a||!a.length)try{a=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(a){}return a&&a.length&&(a=a.closest(".jstree")).length&&(a=a.data("jstree"))?i=a:e(".jstree").each((function(){var a=e(this).data("jstree");if(a&&a._model.data[t])return i=a,!1})),i},e.fn.jstree=function(i){var a="string"==typeof i,s=Array.prototype.slice.call(arguments,1),n=null;return!(!0===i&&!this.length)&&(this.each((function(){var r=e.jstree.reference(this),o=a&&r?r[i]:null;if(n=a&&o?o.apply(r,s):null,r||a||i!==t&&!e.isPlainObject(i)||e.jstree.create(this,i),null!==(n=r&&!a||!0===i?r||!1:n)&&n!==t)return!1})),null!==n&&n!==t?n:this)},e.expr.pseudos.jstree=e.expr.createPseudo((function(i){return function(i){return e(i).hasClass("jstree")&&e(i).data("jstree")!==t}})),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,ellipsis:!1,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0,loaded_state:!1,restore_focus:!0,compute_elements_positions:!1,keyboard:{"ctrl-space":function(t){t.type="click",e(t.currentTarget).trigger(t)},enter:function(t){t.type="click",e(t.currentTarget).trigger(t)},left:function(t){t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(t=this.get_parent(t.currentTarget))&&t.id!==e.jstree.root&&this.get_node(t,!0).children(".jstree-anchor").trigger("focus")},up:function(e){e.preventDefault(),(e=this.get_prev_dom(e.currentTarget))&&e.length&&e.children(".jstree-anchor").trigger("focus")},right:function(t){t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,(function(e){this.get_node(e,!0).children(".jstree-anchor").trigger("focus")})):!this.is_open(t.currentTarget)||(t=this.get_node(t.currentTarget,!0).children(".jstree-children")[0])&&e(this._firstChild(t)).children(".jstree-anchor").trigger("focus")},down:function(e){e.preventDefault(),(e=this.get_next_dom(e.currentTarget))&&e.length&&e.children(".jstree-anchor").trigger("focus")},"*":function(e){this.open_all()},home:function(t){t.preventDefault(),(t=this._firstChild(this.get_container_ul()[0]))&&e(t).children(".jstree-anchor").filter(":visible").trigger("focus")},end:function(e){e.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().trigger("focus")},f2:function(e){e.preventDefault(),this.edit(e.currentTarget)}},allow_reselect:!1},e.jstree.core.prototype={plugin:function(t,i){var a=e.jstree.plugins[t];return a?(this._data[t]={},a.prototype=this,new a(i,this)):this},init:function(t,i){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=i,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter((function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))})).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='none'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' role='treeitem' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().outerHeight()||24,this._data.core.node=this._create_prototype_node(),this.trigger("loading"),this.load_node(e.jstree.root)},destroy:function(e){if(this.trigger("destroy"),this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(e){}e||this.element.empty(),this.teardown()},_create_prototype_node:function(){var e,t,i=l.createElement("LI");return i.setAttribute("role","none"),(e=l.createElement("I")).className="jstree-icon jstree-ocl",e.setAttribute("role","presentation"),i.appendChild(e),(e=l.createElement("A")).className="jstree-anchor",e.setAttribute("href","#"),e.setAttribute("tabindex","-1"),e.setAttribute("role","treeitem"),(t=l.createElement("I")).className="jstree-icon jstree-themeicon",t.setAttribute("role","presentation"),e.appendChild(t),i.appendChild(e),e=t=null,i},_kbevent_to_func:function(e){var t={8:"Backspace",9:"Tab",13:"Enter",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"Print",45:"Insert",46:"Delete",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9","-13":"NumpadEnter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Numlock",145:"Scrolllock",16:"Shift",17:"Ctrl",18:"Alt",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",111:"/",106:"*",173:"-"},i=[];if(e.ctrlKey&&i.push("ctrl"),e.altKey&&i.push("alt"),e.shiftKey&&i.push("shift"),i.push(t[e.which]?t[e.which].toLowerCase():e.which),"shift-shift"===(i=i.sort().join("-").toLowerCase())||"ctrl-ctrl"===i||"alt-alt"===i)return null;var a,s,n=this.settings.core.keyboard;for(a in n)if(n.hasOwnProperty(a)&&(s="-"!==(s=a)&&"+"!==s?(s=s.replace("--","-MINUS").replace("+-","-MINUS").replace("++","-PLUS").replace("-+","-PLUS")).split(/-|\+/).sort().join("-").replace("MINUS","-").replace("PLUS","+").toLowerCase():s)===i)return n[a];return null},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",(function(){return this.className.replace(/jstree[^ ]*|$/gi,"")})),this.element=null},bind:function(){var t="",i=null,a=0;this.element.on("dblclick.jstree",(function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;if(l.selection&&l.selection.empty)l.selection.empty();else if(window.getSelection){e=window.getSelection();try{e.removeAllRanges(),e.collapse()}catch(e){}}})).on("mousedown.jstree",function(e){e.target===this.element[0]&&(e.preventDefault(),a=+new Date)}.bind(this)).on("mousedown.jstree",".jstree-ocl",(function(e){e.preventDefault()})).on("click.jstree",".jstree-ocl",function(e){this.toggle_node(e.target)}.bind(this)).on("dblclick.jstree",".jstree-anchor",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;this.settings.core.dblclick_toggle&&this.toggle_node(e.target)}.bind(this)).on("click.jstree",".jstree-anchor",function(t){t.preventDefault(),t.currentTarget!==l.activeElement&&e(t.currentTarget).trigger("focus"),this.activate_node(t.currentTarget,t)}.bind(this)).on("keydown.jstree",".jstree-anchor",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;this._data.core.rtl&&(37===e.which?e.which=39:39===e.which&&(e.which=37));var t=this._kbevent_to_func(e);if(t&&(!1===(e=t.call(this,e))||!0===e))return e}.bind(this)).on("load_node.jstree",function(t,i){i.status&&(i.node.id!==e.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){for(var t=[],i=0,a=this._data.core.selected.length;i<a;i++)t=t.concat(this._model.data[this._data.core.selected[i]].parents);for(i=0,a=(t=e.vakata.array_unique(t)).length;i<a;i++)this.open_node(t[i],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}}.bind(this),0))}.bind(this)).on("keypress.jstree",function(a){if(a.target.tagName&&"input"===a.target.tagName.toLowerCase())return!0;i&&clearTimeout(i),i=setTimeout((function(){t=""}),500);var s=String.fromCharCode(a.which).toLowerCase(),n=this.element.find(".jstree-anchor").filter(":visible"),r=(a=n.index(l.activeElement)||0,!1);if(1<(t+=s).length){if(n.slice(a).each(function(i,a){if(0===e(a).text().toLowerCase().indexOf(t))return e(a).trigger("focus"),!(r=!0)}.bind(this)),r)return;if(n.slice(0,a).each(function(i,a){if(0===e(a).text().toLowerCase().indexOf(t))return e(a).trigger("focus"),!(r=!0)}.bind(this)),r)return}new RegExp("^"+s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(t)&&(n.slice(a+1).each(function(t,i){if(e(i).text().toLowerCase().charAt(0)===s)return e(i).trigger("focus"),!(r=!0)}.bind(this)),r||n.slice(0,a+1).each(function(t,i){if(e(i).text().toLowerCase().charAt(0)===s)return e(i).trigger("focus"),!(r=!0)}.bind(this)))}.bind(this)).on("init.jstree",function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this._data.core.themes.ellipsis=e.ellipsis,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)}.bind(this)).on("loading.jstree",function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"](),this[this._data.core.themes.ellipsis?"show_ellipsis":"hide_ellipsis"]()}.bind(this)).on("blur.jstree",".jstree-anchor",function(t){this._data.core.focused=null,e(t.currentTarget).filter(".jstree-hovered").trigger("mouseleave"),this.element.attr("tabindex","0"),e(t.currentTarget).attr("tabindex","-1")}.bind(this)).on("focus.jstree",".jstree-anchor",function(t){var i=this.get_node(t.currentTarget);i&&(i.id||0===i.id)&&(this._data.core.focused=i.id),this.element.find(".jstree-hovered").not(t.currentTarget).trigger("mouseleave"),e(t.currentTarget).trigger("mouseenter"),this.element.attr("tabindex","-1"),e(t.currentTarget).attr("tabindex","0")}.bind(this)).on("focus.jstree",function(){var e;500<+new Date-a&&!this._data.core.focused&&this.settings.core.restore_focus&&(a=0,(e=this.get_node(this.element.attr("aria-activedescendant"),!0))&&e.find("> .jstree-anchor").trigger("focus"))}.bind(this)).on("mouseenter.jstree",".jstree-anchor",function(e){this.hover_node(e.currentTarget)}.bind(this)).on("mouseleave.jstree",".jstree-anchor",function(e){this.dehover_node(e.currentTarget)}.bind(this))},unbind:function(){this.element.off(".jstree"),e(l).off(".jstree-"+this._id)},trigger:function(e,t){((t=t||{}).instance=this).element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(t){var i=this.settings.core.strings;return e.vakata.is_function(i)?i.call(this,t):i&&i[t]?i[t]:t},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(t,i){var a;(t=t&&(t.id||0===t.id)?t.id:t)instanceof e&&t.length&&t[0].id&&(t=t[0].id);try{if(this._model.data[t])t=this._model.data[t];else if("string"==typeof t&&this._model.data[t.replace(/^#/,"")])t=this._model.data[t.replace(/^#/,"")];else if("string"==typeof t&&(a=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[a.closest(".jstree-node").attr("id")])t=this._model.data[a.closest(".jstree-node").attr("id")];else if((a=this.element.find(t)).length&&this._model.data[a.closest(".jstree-node").attr("id")])t=this._model.data[a.closest(".jstree-node").attr("id")];else{if(!(a=this.element.find(t)).length||!a.hasClass("jstree"))return!1;t=this._model.data[e.jstree.root]}return i?t.id===e.jstree.root?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element):t}catch(t){return!1}},get_path:function(t,i,a){if(!(t=t.parents?t:this.get_node(t))||t.id===e.jstree.root||!t.parents)return!1;var s,n,r=[];for(r.push(a?t.id:t.text),s=0,n=t.parents.length;s<n;s++)r.push(a?t.parents[s]:this.get_text(t.parents[s]));return r=r.reverse().slice(1),i?r.join(i):r},get_next_dom:function(t,i){var a;if((t=this.get_node(t,!0))[0]===this.element[0]){for(a=this._firstChild(this.get_container_ul()[0]);a&&0===a.offsetHeight;)a=this._nextSibling(a);return!!a&&e(a)}if(!t||!t.length)return!1;if(i){a=t[0];do{a=this._nextSibling(a)}while(a&&0===a.offsetHeight);return!!a&&e(a)}if(t.hasClass("jstree-open")){for(a=this._firstChild(t.children(".jstree-children")[0]);a&&0===a.offsetHeight;)a=this._nextSibling(a);if(null!==a)return e(a)}a=t[0];do{a=this._nextSibling(a)}while(a&&0===a.offsetHeight);return null!==a?e(a):t.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(t,i){var a;if((t=this.get_node(t,!0))[0]===this.element[0]){for(a=this.get_container_ul()[0].lastChild;a&&0===a.offsetHeight;)a=this._previousSibling(a);return!!a&&e(a)}if(!t||!t.length)return!1;if(i){a=t[0];do{a=this._previousSibling(a)}while(a&&0===a.offsetHeight);return!!a&&e(a)}a=t[0];do{a=this._previousSibling(a)}while(a&&0===a.offsetHeight);if(null===a)return!(!(a=t[0].parentNode.parentNode)||!a.className||-1===a.className.indexOf("jstree-node"))&&e(a);for(t=e(a);t.hasClass("jstree-open");)t=t.children(".jstree-children").first().children(".jstree-node:visible:last");return t},get_parent:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.parent},get_children_dom:function(e){return(e=this.get_node(e,!0))[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!e||!e.length)&&e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return(e=this.get_node(e))&&(!1===e.state.loaded||0<e.children.length)},is_loaded:function(e){return(e=this.get_node(e))&&e.state.loaded},is_loading:function(e){return(e=this.get_node(e))&&e.state&&e.state.loading},is_open:function(e){return(e=this.get_node(e))&&e.state.opened},is_closed:function(e){return(e=this.get_node(e))&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,i){var a,s,n,r,o,l=this.get_node(t,!0);if(e.vakata.is_array(t))return this._load_nodes(t.slice(),i),!0;if(!(t=this.get_node(t)))return i&&i.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,n=0,r=t.parents.length;n<r;n++)this._model.data[t.parents[n]].children_d=e.vakata.array_filter(this._model.data[t.parents[n]].children_d,(function(i){return-1===e.inArray(i,t.children_d)}));for(a=0,s=t.children_d.length;a<s;a++)this._model.data[t.children_d[a]].state.selected&&(o=!0),delete this._model.data[t.children_d[a]];o&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,(function(i){return-1===e.inArray(i,t.children_d)}))),t.children=[],t.children_d=[],o&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.failed=!1,t.state.loading=!0,(t.id!==e.jstree.root?l.children(".jstree-anchor"):l).attr("aria-busy",!0),l.addClass("jstree-loading"),this._load_node(t,function(a){(t=this._model.data[t.id]).state.loading=!1,t.state.loaded=a,t.state.failed=!t.state.loaded;for(var s=this.get_node(t,!0),n=0,r=this._model.data,o=!1,l=(n=0,t.children.length);n<l;n++)if(r[t.children[n]]&&!r[t.children[n]].state.hidden){o=!0;break}t.state.loaded&&s&&s.length&&(s.removeClass("jstree-closed jstree-open jstree-leaf"),o?"#"!==t.id&&s.addClass(t.state.opened?"jstree-open":"jstree-closed"):s.addClass("jstree-leaf")),(t.id!==e.jstree.root?s.children(".jstree-anchor"):s).attr("aria-busy",!1),s.removeClass("jstree-loading"),this.trigger("load_node",{node:t,status:a}),i&&i.call(this,t,a)}.bind(this)),!0},_load_nodes:function(e,t,i,a){for(var s=!0,n=function(){this._load_nodes(e,t,!0)},r=this._model.data,o=[],l=0,d=e.length;l<d;l++)r[e[l]]&&(!r[e[l]].state.loaded&&!r[e[l]].state.failed||!i&&a)&&(this.is_loading(e[l])||this.load_node(e[l],n),s=!1);if(s){for(l=0,d=e.length;l<d;l++)r[e[l]]&&r[e[l]].state.loaded&&o.push(e[l]);t&&!t.done&&(t.call(this,o),t.done=!0)}},load_all:function(t,i){if(t=t||e.jstree.root,!(t=this.get_node(t)))return!1;var a,s,n=[],r=this._model.data,o=r[t.id].children_d;for(t.state&&!t.state.loaded&&n.push(t.id),a=0,s=o.length;a<s;a++)r[o[a]]&&r[o[a]].state&&!r[o[a]].state.loaded&&n.push(o[a]);n.length?this._load_nodes(n,(function(){this.load_all(t,i)})):(i&&i.call(this,t),this.trigger("load_all",{node:t}))},_load_node:function(t,i){var a,s=this.settings.core.data,n=function(){return 3!==this.nodeType&&8!==this.nodeType};return s?e.vakata.is_function(s)?s.call(this,t,function(a){!1===a?i.call(this,!1):this["string"==typeof a?"_append_html_data":"_append_json_data"](t,"string"==typeof a?e(e.parseHTML(a)).filter(n):a,(function(e){i.call(this,e)}))}.bind(this)):"object"==typeof s?s.url?(s=e.extend(!0,{},s),e.vakata.is_function(s.url)&&(s.url=s.url.call(this,t)),e.vakata.is_function(s.data)&&(s.data=s.data.call(this,t)),e.ajax(s).done(function(a,s,r){var o=r.getResponseHeader("Content-Type");return o&&-1!==o.indexOf("json")||"object"==typeof a?this._append_json_data(t,a,(function(e){i.call(this,e)})):o&&-1!==o.indexOf("html")||"string"==typeof a?this._append_html_data(t,e(e.parseHTML(a)).filter(n),(function(e){i.call(this,e)})):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:r})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))}.bind(this)).fail(function(e){this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},i.call(this,!1),this.settings.core.error.call(this,this._data.core.last_error)}.bind(this))):(a=e.vakata.is_array(s)?e.extend(!0,[],s):e.isPlainObject(s)?e.extend(!0,{},s):s,t.id===e.jstree.root?this._append_json_data(t,a,(function(e){i.call(this,e)})):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))):"string"==typeof s?t.id===e.jstree.root?this._append_html_data(t,e(e.parseHTML(s)).filter(n),(function(e){i.call(this,e)})):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1)):i.call(this,!1):t.id===e.jstree.root?this._append_html_data(t,this._data.core.original_container_html.clone(!0),(function(e){i.call(this,e)})):i.call(this,!1)},_node_changed:function(t){(t=this.get_node(t))&&-1===e.inArray(t.id,this._model.changed)&&this._model.changed.push(t.id)},_append_html_data:function(t,i,a){(t=this.get_node(t)).children=[],t.children_d=[];i=i.is("ul")?i.children():i;var s,n,r,o=t.id,l=[],d=[],c=this._model.data,m=c[o];t=this._data.core.selected.length;for(i.each(function(t,i){(s=this._parse_model_from_html(e(i),o,m.parents.concat()))&&(l.push(s),d.push(s),c[s].children_d.length&&(d=d.concat(c[s].children_d)))}.bind(this)),m.children=l,m.children_d=d,n=0,r=m.parents.length;n<r;n++)c[m.parents[n]].children_d=c[m.parents[n]].children_d.concat(d);this.trigger("model",{nodes:d,parent:o}),o!==e.jstree.root?(this._node_changed(o),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==t&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),a.call(this,!0)},_append_json_data:function(t,i,a,s){if(null!==this.element){(t=this.get_node(t)).children=[],t.children_d=[],i.d&&"string"==typeof(i=i.d)&&(i=JSON.parse(i)),e.vakata.is_array(i)||(i=[i]);var n=null,r={df:this._model.default_state,dat:i,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=this,l=function(e,t){var i,a,s,n,r=(e=e.data?e.data:e).dat,l=e.par,d=[],c=[],m=[],_=e.df,h=e.t_id,p=e.t_cnt,u=e.m,g=u[l],f=(e=e.sel,function(e,i,a){a=a?a.concat():[],i&&a.unshift(i);var s,n,r,o,l=e.id.toString(),d={id:l,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:a,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in _)_.hasOwnProperty(s)&&(d.state[s]=_[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id||(d.li_attr.id=l),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);for(e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),s=0,n=(u[d.id]=d).children.length;s<n;s++)r=f(u[d.children[s]],d.id,a),o=u[r],d.children_d.push(r),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));return delete e.data,delete e.children,u[d.id].original=e,d.state.selected&&m.push(d.id),d.id}),v=function(e,i,a){a=a?a.concat():[],i&&a.unshift(i);var s,n,r,o,l,d=!1;do{d="j"+h+"_"+ ++p}while(u[d]);for(s in l={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:a,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},_)_.hasOwnProperty(s)&&(l.state[s]=_[s]);if(e&&(e.id||0===e.id)&&(l.id=e.id.toString()),e&&e.text&&(l.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),l.icon!==t&&null!==l.icon&&""!==l.icon||(l.icon=!0),e&&e.data&&(l.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(l.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(l.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(l.li_attr[s]=e.li_attr[s]);if(l.li_attr.id&&!l.id&&0!==l.id&&(l.id=l.li_attr.id.toString()),l.id||0===l.id||(l.id=d),l.li_attr.id||(l.li_attr.id=l.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(l.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;s<n;s++)r=v(e.children[s],l.id,a),o=u[r],l.children.push(r),o.children_d.length&&(l.children_d=l.children_d.concat(o.children_d));l.children_d=l.children_d.concat(l.children)}return e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete e.data,delete e.children,l.original=e,(u[l.id]=l).state.selected&&m.push(l.id),l.id};if(r.length&&r[0].id!==t&&r[0].parent!==t){for(a=0,s=r.length;a<s;a++)r[a].children||(r[a].children=[]),r[a].state||(r[a].state={}),u[r[a].id.toString()]=r[a];for(a=0,s=r.length;a<s;a++)u[r[a].parent.toString()]?(u[r[a].parent.toString()].children.push(r[a].id.toString()),g.children_d.push(r[a].id.toString())):void 0!==o&&(o._data.core.last_error={error:"parse",plugin:"core",id:"core_07",reason:"Node with invalid parent",data:JSON.stringify({id:r[a].id.toString(),parent:r[a].parent.toString()})},o.settings.core.error.call(o,o._data.core.last_error));for(a=0,s=g.children.length;a<s;a++)i=f(u[g.children[a]],l,g.parents.concat()),c.push(i),u[i].children_d.length&&(c=c.concat(u[i].children_d));for(a=0,s=g.parents.length;a<s;a++)u[g.parents[a]].children_d=u[g.parents[a]].children_d.concat(c);n={cnt:p,mod:u,sel:e,par:l,dpc:c,add:m}}else{for(a=0,s=r.length;a<s;a++)(i=v(r[a],l,g.parents.concat()))&&(d.push(i),c.push(i),u[i].children_d.length&&(c=c.concat(u[i].children_d)));for(g.children=d,g.children_d=c,a=0,s=g.parents.length;a<s;a++)u[g.parents[a]].children_d=u[g.parents[a]].children_d.concat(c);n={cnt:p,mod:u,sel:e,par:l,dpc:c,add:m}}if("undefined"!=typeof window&&void 0!==window.document)return n;postMessage(n)},c=function(t,i){if(null!==this.element){var s;for(s in this._cnt=t.cnt,m=this._model.data)m.hasOwnProperty(s)&&m[s].state&&m[s].state.loading&&t.mod[s]&&(t.mod[s].state.loading=!0);if(this._model.data=t.mod,i){var n,r=t.add,l=t.sel,c=this._data.core.selected.slice(),m=this._model.data;if(l.length!==c.length||e.vakata.array_unique(l.concat(c)).length!==l.length){for(s=0,n=l.length;s<n;s++)-1===e.inArray(l[s],r)&&-1===e.inArray(l[s],c)&&(m[l[s]].state.selected=!1);for(s=0,n=c.length;s<n;s++)-1===e.inArray(c[s],l)&&(m[c[s]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),t.par!==e.jstree.root?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),!i&&d?d((function(){a.call(o,!0)})):a.call(o,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+l.toString()],{type:"text/javascript"}))),!this._data.core.working||s?(this._data.core.working=!0,(n=new window.Worker(this._wrk)).onmessage=function(e){c.call(this,e.data,!0);try{n.terminate(),n=null}catch(e){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}.bind(this),n.onerror=function(e){c.call(this,l(r),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}.bind(this),r.par?n.postMessage(r):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([t,i,a,!0])}catch(t){c.call(this,l(r),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else c.call(this,l(r),!1)}},_parse_model_from_html:function(i,a,s){s=s?[].concat(s):[],a&&s.unshift(a);var n,r,o,l,d=this._model.data,c={id:!1,text:!1,icon:!0,parent:a,parents:s,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in this._model.default_state)this._model.default_state.hasOwnProperty(o)&&(c.state[o]=this._model.default_state[o]);if(a=e.vakata.attributes(i,!0),e.each(a,(function(t,i){return!(i=e.vakata.trim(i)).length||(c.li_attr[t]=i,void("id"===t&&(c.id=i.toString())))})),(a=i.children("a").first()).length&&(a=e.vakata.attributes(a,!0),e.each(a,(function(t,i){(i=e.vakata.trim(i)).length&&(c.a_attr[t]=i)}))),(a=(i.children("a").first().length?i.children("a").first():i).clone()).children("ins, i, ul").remove(),a=a.html(),a=e("<div></div>").html(a),c.text=this.settings.core.force_text?a.text():a.html(),a=i.data(),c.data=a?e.extend(!0,{},a):null,c.state.opened=i.hasClass("jstree-open"),c.state.selected=i.children("a").hasClass("jstree-clicked"),c.state.disabled=i.children("a").hasClass("jstree-disabled"),c.data&&c.data.jstree)for(o in c.data.jstree)c.data.jstree.hasOwnProperty(o)&&(c.state[o]=c.data.jstree[o]);(a=i.children("a").children(".jstree-themeicon")).length&&(c.icon=!a.hasClass("jstree-themeicon-hidden")&&a.attr("rel")),c.state.icon!==t&&(c.icon=c.state.icon),c.icon!==t&&null!==c.icon&&""!==c.icon||(c.icon=!0),a=i.children("ul").children("li");do{l="j"+this._id+"_"+ ++this._cnt}while(d[l]);return c.id=c.li_attr.id?c.li_attr.id.toString():l,a.length?(a.each(function(t,i){n=this._parse_model_from_html(e(i),c.id,s),r=this._model.data[n],c.children.push(n),r.children_d.length&&(c.children_d=c.children_d.concat(r.children_d))}.bind(this)),c.children_d=c.children_d.concat(c.children)):i.hasClass("jstree-closed")&&(c.state.loaded=!1),c.li_attr.class&&(c.li_attr.class=c.li_attr.class.replace("jstree-closed","").replace("jstree-open","")),c.a_attr.class&&(c.a_attr.class=c.a_attr.class.replace("jstree-clicked","").replace("jstree-disabled","")),(d[c.id]=c).state.selected&&this._data.core.selected.push(c.id),c.id},_parse_model_from_flat_json:function(e,i,a){a=a?a.concat():[],i&&a.unshift(i);var s,n,r,o,l=e.id.toString(),d=this._model.data,c=this._model.default_state,m={id:l,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:a,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in c)c.hasOwnProperty(s)&&(m.state[s]=c[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(m.icon=e.data.jstree.icon),m.icon!==t&&null!==m.icon&&""!==m.icon||(m.icon=!0),e&&e.data&&(m.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(m.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(m.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(m.li_attr[s]=e.li_attr[s]);if(m.li_attr.id||(m.li_attr.id=l),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(m.a_attr[s]=e.a_attr[s]);for(e&&e.children&&!0===e.children&&(m.state.loaded=!1,m.children=[],m.children_d=[]),s=0,n=(d[m.id]=m).children.length;s<n;s++)o=d[r=this._parse_model_from_flat_json(d[m.children[s]],m.id,a)],m.children_d.push(r),o.children_d.length&&(m.children_d=m.children_d.concat(o.children_d));return delete e.data,delete e.children,d[m.id].original=e,m.state.selected&&this._data.core.selected.push(m.id),m.id},_parse_model_from_json:function(e,i,a){a=a?a.concat():[],i&&a.unshift(i);var s,n,r,o,l,d=!1,c=this._model.data,m=this._model.default_state;do{d="j"+this._id+"_"+ ++this._cnt}while(c[d]);for(s in l={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:a,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},m)m.hasOwnProperty(s)&&(l.state[s]=m[s]);if(e&&(e.id||0===e.id)&&(l.id=e.id.toString()),e&&e.text&&(l.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),l.icon!==t&&null!==l.icon&&""!==l.icon||(l.icon=!0),e&&e.data&&(l.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(l.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(l.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(l.li_attr[s]=e.li_attr[s]);if(l.li_attr.id&&!l.id&&0!==l.id&&(l.id=l.li_attr.id.toString()),l.id||0===l.id||(l.id=d),l.li_attr.id||(l.li_attr.id=l.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(l.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;s<n;s++)o=c[r=this._parse_model_from_json(e.children[s],l.id,a)],l.children.push(r),o.children_d.length&&(l.children_d=l.children_d.concat(o.children_d));l.children_d=l.children.concat(l.children_d)}return e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete e.data,delete e.children,l.original=e,(c[l.id]=l).state.selected&&this._data.core.selected.push(l.id),l.id},_redraw:function(){for(var t,i=(this._model.force_full_redraw?this._model.data[e.jstree.root].children:this._model.changed).concat([]),a=l.createElement("UL"),s=this._data.core.focused,n=0,r=i.length;n<r;n++)(t=this.redraw_node(i[n],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&a.appendChild(t);this._model.force_full_redraw&&(a.className=this.get_container_ul()[0].className,a.setAttribute("role","presentation"),this.element.empty().append(a)),null!==s&&this.settings.core.restore_focus&&((t=this.get_node(s,!0))&&t.length&&t.children(".jstree-anchor")[0]!==l.activeElement?t.children(".jstree-anchor").trigger("focus"):this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:i})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(t){var i=this.get_node(t),a=!1,s=!1,n=!1,r=l;if(!i)return!1;if(i.id===e.jstree.root)return this.redraw(!0);if(!(t=this.get_node(t,!0))||!t.length)return!1;if(t.children(".jstree-children").remove(),t=t[0],i.children.length&&i.state.loaded){for((n=r.createElement("UL")).setAttribute("role","group"),n.className="jstree-children",a=0,s=i.children.length;a<s;a++)n.appendChild(this.redraw_node(i.children[a],!0,!0));t.appendChild(n)}},redraw_node:function(t,i,a,s){var n=this.get_node(t),r=!1,o=!1,d=!1,c=!1,m=!1,_=!1,h="",p=l,u=this._model.data,g=!1,f=null,v=0,b=0,y=!1,k=!1;if(!n)return!1;if(n.id===e.jstree.root)return this.redraw(!0);if(i=i||0===n.children.length,t=l.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(n.id[0])?"\\3"+n.id[0]+" "+n.id.substr(1).replace(e.jstree.idregex,"\\$&"):n.id.replace(e.jstree.idregex,"\\$&"))):l.getElementById(n.id))t=e(t),a||((r=t.parent().parent()[0])===this.element[0]&&(r=null),o=t.index()),(i=!(i||!n.children.length||t.children(".jstree-children").length)||i)||(d=t.children(".jstree-children")[0]),g=t.children(".jstree-anchor")[0]===l.activeElement,t.remove();else if(i=!0,!a){if(!(null===(r=n.parent!==e.jstree.root?e("#"+n.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null)||r&&u[n.parent].state.opened))return!1;o=e.inArray(n.id,(null===r?u[e.jstree.root]:u[n.parent]).children)}for(c in t=this._data.core.node.cloneNode(!0),h="jstree-node ",n.li_attr)n.li_attr.hasOwnProperty(c)&&"id"!==c&&("class"!==c?t.setAttribute(c,n.li_attr[c]):h+=n.li_attr[c]);for(n.a_attr.id||(n.a_attr.id=n.id+"_anchor"),t.childNodes[1].setAttribute("aria-selected",!!n.state.selected),t.childNodes[1].setAttribute("aria-level",n.parents.length),this.settings.core.compute_elements_positions&&(t.childNodes[1].setAttribute("aria-setsize",u[n.parent].children.length),t.childNodes[1].setAttribute("aria-posinset",u[n.parent].children.indexOf(n.id)+1)),n.state.disabled&&t.childNodes[1].setAttribute("aria-disabled",!0),c=0,m=n.children.length;c<m;c++)if(!u[n.children[c]].state.hidden){y=!0;break}if(null!==n.parent&&u[n.parent]&&!n.state.hidden&&(c=e.inArray(n.id,u[n.parent].children),k=n.id,-1!==c))for(c++,m=u[n.parent].children.length;c<m&&(k=u[u[n.parent].children[c]].state.hidden?k:u[n.parent].children[c])===n.id;c++);for(m in n.state.hidden&&(h+=" jstree-hidden"),n.state.loading&&(h+=" jstree-loading"),n.state.loaded&&!y?h+=" jstree-leaf":(h+=n.state.opened&&n.state.loaded?" jstree-open":" jstree-closed",t.childNodes[1].setAttribute("aria-expanded",n.state.opened&&n.state.loaded)),k===n.id&&(h+=" jstree-last"),t.id=n.id,t.className=h,h=(n.state.selected?" jstree-clicked":"")+(n.state.disabled?" jstree-disabled":""),n.a_attr)n.a_attr.hasOwnProperty(m)&&("href"===m&&"#"===n.a_attr[m]||("class"!==m?t.childNodes[1].setAttribute(m,n.a_attr[m]):h+=" "+n.a_attr[m]));if(h.length&&(t.childNodes[1].className="jstree-anchor "+h),(n.icon&&!0!==n.icon||!1===n.icon)&&(!1===n.icon?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===n.icon.indexOf("/")&&-1===n.icon.indexOf(".")?t.childNodes[1].childNodes[0].className+=" "+n.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage='url("'+n.icon+'")',t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(p.createTextNode(n.text)):t.childNodes[1].innerHTML+=n.text,i&&n.children.length&&(n.state.opened||s)&&n.state.loaded){for((_=p.createElement("UL")).setAttribute("role","group"),_.className="jstree-children",c=0,m=n.children.length;c<m;c++)_.appendChild(this.redraw_node(n.children[c],i,!0));t.appendChild(_)}if(d&&t.appendChild(d),!a){for(c=0,m=(r=r||this.element[0]).childNodes.length;c<m;c++)if(r.childNodes[c]&&r.childNodes[c].className&&-1!==r.childNodes[c].className.indexOf("jstree-children")){f=r.childNodes[c];break}f||((f=p.createElement("UL")).setAttribute("role","group"),f.className="jstree-children",r.appendChild(f)),o<(r=f).childNodes.length?r.insertBefore(t,r.childNodes[o]):r.appendChild(t),g&&(v=this.element[0].scrollTop,b=this.element[0].scrollLeft,t.childNodes[1].focus(),this.element[0].scrollTop=v,this.element[0].scrollLeft=b)}return n.state.opened&&!n.state.loaded&&(n.state.opened=!1,setTimeout(function(){this.open_node(n.id,!1,0)}.bind(this),0)),t},open_node:function(i,a,s){var n,r,o,l;if(e.vakata.is_array(i)){for(n=0,r=(i=i.slice()).length;n<r;n++)this.open_node(i[n],a,s);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(s=s===t?this.settings.core.animation:s,this.is_closed(i)?this.is_loaded(i)?(o=this.get_node(i,!0),l=this,o.length&&(s&&o.children(".jstree-children").length&&o.children(".jstree-children").stop(!0,!0),i.children.length&&!this._firstChild(o.children(".jstree-children")[0])&&this.draw_children(i),s?(this.trigger("before_open",{node:i}),o.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").children(".jstree-anchor").attr("aria-expanded",!0).end().children(".jstree-children").stop(!0,!0).slideDown(s,(function(){this.style.display="",l.element&&l.trigger("after_open",{node:i})}))):(this.trigger("before_open",{node:i}),o[0].className=o[0].className.replace("jstree-closed","jstree-open"),o[0].childNodes[1].setAttribute("aria-expanded",!0))),i.state.opened=!0,a&&a.call(this,i,!0),o.length||this.trigger("before_open",{node:i}),this.trigger("open_node",{node:i}),s&&o.length||this.trigger("after_open",{node:i}),!0):this.is_loading(i)?setTimeout(function(){this.open_node(i,a,s)}.bind(this),500):void this.load_node(i,(function(e,t){return t?this.open_node(e,a,s):!!a&&a.call(this,e,!1)})):(a&&a.call(this,i,!1),!1))},_open_to:function(t){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;for(var i=t.parents,a=0,s=i.length;a<s;a+=1)a!==e.jstree.root&&this.open_node(i[a],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(i,a){var s,n,r,o;if(e.vakata.is_array(i)){for(s=0,n=(i=i.slice()).length;s<n;s++)this.close_node(i[s],a);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&!this.is_closed(i)&&(a=a===t?this.settings.core.animation:a,o=(r=this).get_node(i,!0),i.state.opened=!1,this.trigger("close_node",{node:i}),void(o.length?a?o.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").children(".jstree-anchor").attr("aria-expanded",!1).end().children(".jstree-children").stop(!0,!0).slideUp(a,(function(){this.style.display="",o.children(".jstree-children").remove(),r.element&&r.trigger("after_close",{node:i})})):(o[0].className=o[0].className.replace("jstree-open","jstree-closed"),o.children(".jstree-anchor").attr("aria-expanded",!1),o.children(".jstree-children").remove(),this.trigger("after_close",{node:i})):this.trigger("after_close",{node:i})))},toggle_node:function(t){var i,a;if(e.vakata.is_array(t)){for(i=0,a=(t=t.slice()).length;i<a;i++)this.toggle_node(t[i]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(t,i,a){if(t=t||e.jstree.root,!(t=this.get_node(t)))return!1;var s,n,r,o=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0);if(!o.length){for(s=0,n=t.children_d.length;s<n;s++)this.is_closed(this._model.data[t.children_d[s]])&&(this._model.data[t.children_d[s]].state.opened=!0);return this.trigger("open_all",{node:t})}a=a||o,(o=(r=this).is_closed(t)?o.find(".jstree-closed").addBack():o.find(".jstree-closed")).each((function(){r.open_node(this,(function(e,t){t&&this.is_parent(e)&&this.open_all(e,i,a)}),i||0)})),0===a.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(a)})},close_all:function(t,i){if(t=t||e.jstree.root,!(t=this.get_node(t)))return!1;var a,s,n=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0),r=this;for(n.length&&(n=this.is_open(t)?n.find(".jstree-open").addBack():n.find(".jstree-open"),e(n.get().reverse()).each((function(){r.close_node(this,i||0)}))),a=0,s=t.children_d.length;a<s;a++)this._model.data[t.children_d[a]].state.opened=!1;this.trigger("close_all",{node:t})},is_disabled:function(e){return(e=this.get_node(e))&&e.state&&e.state.disabled},enable_node:function(t){var i,a;if(e.vakata.is_array(t)){for(i=0,a=(t=t.slice()).length;i<a;i++)this.enable_node(t[i]);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),this.trigger("enable_node",{node:t})},disable_node:function(t){var i,a;if(e.vakata.is_array(t)){for(i=0,a=(t=t.slice()).length;i<a;i++)this.disable_node(t[i]);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),this.trigger("disable_node",{node:t})},is_hidden:function(e){return!0===(e=this.get_node(e)).state.hidden},hide_node:function(t,i){var a,s;if(e.vakata.is_array(t)){for(a=0,s=(t=t.slice()).length;a<s;a++)this.hide_node(t[a],!0);return i||this.redraw(),!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;t.state.hidden||(t.state.hidden=!0,this._node_changed(t.parent),i||this.redraw(),this.trigger("hide_node",{node:t}))},show_node:function(t,i){var a,s;if(e.vakata.is_array(t)){for(a=0,s=(t=t.slice()).length;a<s;a++)this.show_node(t[a],!0);return i||this.redraw(),!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;t.state.hidden&&(t.state.hidden=!1,this._node_changed(t.parent),i||this.redraw(),this.trigger("show_node",{node:t}))},hide_all:function(t){var i,a=this._model.data,s=[];for(i in a)a.hasOwnProperty(i)&&i!==e.jstree.root&&!a[i].state.hidden&&(a[i].state.hidden=!0,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("hide_all",{nodes:s}),s},show_all:function(t){var i,a=this._model.data,s=[];for(i in a)a.hasOwnProperty(i)&&i!==e.jstree.root&&a[i].state.hidden&&(a[i].state.hidden=!1,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("show_all",{nodes:s}),s},activate_node:function(e,i){if(this.is_disabled(e))return!1;if(i&&"object"==typeof i||(i={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&(!i.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(i.shiftKey){for(var a=this.get_node(e).id,s=this._data.core.last_clicked.id,n=this.get_node(this._data.core.last_clicked.parent).children,r=!1,o=0,l=n.length;o<l;o+=1)n[o]===a&&(r=!r),n[o]===s&&(r=!r),this.is_disabled(n[o])||!r&&n[o]!==a&&n[o]!==s?i.ctrlKey||this.deselect_node(n[o],!0,i):this.is_hidden(n[o])||this.select_node(n[o],!0,!1,i);this.trigger("changed",{action:"select_node",node:this.get_node(e),selected:this._data.core.selected,event:i})}else this.is_selected(e)?this.deselect_node(e,!1,i):(i.ctrlKey&&(this._data.core.last_clicked=this.get_node(e)),this.select_node(e,!1,!1,i));else!this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,i):(!this.settings.core.allow_reselect&&this.is_selected(e)&&1===this._data.core.selected.length||(this.deselect_all(!0),this.select_node(e,!1,!1,i)),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e),event:i})},hover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout((function(){i.attr("aria-activedescendant",e[0].id)}),0)},dehover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||!e.children(".jstree-hovered").length)return!1;e.children(".jstree-anchor").removeClass("jstree-hovered"),this.trigger("dehover_node",{node:this.get_node(e)})},select_node:function(t,i,a,s){var n,r,o;if(e.vakata.is_array(t)){for(r=0,o=(t=t.slice()).length;r<o;r++)this.select_node(t[r],i,a,s);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;n=this.get_node(t,!0),t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),(n=a?n:this._open_to(t))&&n.length&&n.children(".jstree-anchor").addClass("jstree-clicked").attr("aria-selected",!0),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:s}),i||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:s}))},deselect_node:function(t,i,a){var s,n,r;if(e.vakata.is_array(t)){for(s=0,n=(t=t.slice()).length;s<n;s++)this.deselect_node(t[s],i,a);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;r=this.get_node(t,!0),t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),r.length&&r.children(".jstree-anchor").removeClass("jstree-clicked").attr("aria-selected",!1),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:a}),i||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:a}))},select_all:function(t){var i,a,s=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data[e.jstree.root].children_d.concat(),i=0,a=this._data.core.selected.length;i<a;i++)this._model.data[this._data.core.selected[i]]&&(this._model.data[this._data.core.selected[i]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),t||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:s})},deselect_all:function(e){for(var t=this._data.core.selected.concat([]),i=0,a=this._data.core.selected.length;i<a;i++)this._model.data[this._data.core.selected[i]]&&(this._model.data[this._data.core.selected[i]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:t}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:t})},is_selected:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.state.selected},get_selected:function(t){return t?e.map(this._data.core.selected,function(e){return this.get_node(e)}.bind(this)):this._data.core.selected.slice()},get_top_selected:function(t){for(var i,a,s=this.get_selected(!0),n={},r=0,o=s.length;r<o;r++)n[s[r].id]=s[r];for(r=0,o=s.length;r<o;r++)for(i=0,a=s[r].children_d.length;i<a;i++)n[s[r].children_d[i]]&&delete n[s[r].children_d[i]];for(r in s=[],n)n.hasOwnProperty(r)&&s.push(r);return t?e.map(s,function(e){return this.get_node(e)}.bind(this)):s},get_bottom_selected:function(t){for(var i=this.get_selected(!0),a=[],s=0,n=i.length;s<n;s++)i[s].children.length||a.push(i[s].id);return t?e.map(a,function(e){return this.get_node(e)}.bind(this)):a},get_state:function(){var t,i={core:{open:[],loaded:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(t in this._model.data)this._model.data.hasOwnProperty(t)&&t!==e.jstree.root&&(this._model.data[t].state.loaded&&this.settings.core.loaded_state&&i.core.loaded.push(t),this._model.data[t].state.opened&&i.core.open.push(t),this._model.data[t].state.selected&&i.core.selected.push(t));return i},set_state:function(i,a){if(i){if(i.core&&i.core.selected&&i.core.initial_selection===t&&(i.core.initial_selection=this._data.core.selected.concat([]).sort().join(",")),i.core){var s,n;if(i.core.loaded)return this.settings.core.loaded_state&&e.vakata.is_array(i.core.loaded)&&i.core.loaded.length?this._load_nodes(i.core.loaded,(function(e){delete i.core.loaded,this.set_state(i,a)})):(delete i.core.loaded,this.set_state(i,a)),!1;if(i.core.open)return e.vakata.is_array(i.core.open)&&i.core.open.length?this._load_nodes(i.core.open,(function(e){this.open_node(e,!1,0),delete i.core.open,this.set_state(i,a)})):(delete i.core.open,this.set_state(i,a)),!1;if(i.core.scroll)return i.core.scroll&&i.core.scroll.left!==t&&this.element.scrollLeft(i.core.scroll.left),i.core.scroll&&i.core.scroll.top!==t&&this.element.scrollTop(i.core.scroll.top),delete i.core.scroll,this.set_state(i,a),!1;if(i.core.selected)return s=this,i.core.initial_selection!==t&&i.core.initial_selection!==this._data.core.selected.concat([]).sort().join(",")||(this.deselect_all(),e.each(i.core.selected,(function(e,t){s.select_node(t,!1,!0)}))),delete i.core.initial_selection,delete i.core.selected,this.set_state(i,a),!1;for(n in i)i.hasOwnProperty(n)&&"core"!==n&&-1===e.inArray(n,this.settings.plugins)&&delete i[n];if(e.isEmptyObject(i.core))return delete i.core,this.set_state(i,a),!1}return!e.isEmptyObject(i)||(i=null,a&&a.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(t,i){this._data.core.state=!0===i?{}:this.get_state(),i&&e.vakata.is_function(i)&&(this._data.core.state=i.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var a=this.get_container_ul()[0].className;t||(this.element.html("<ul class='"+a+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='none' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' role='treeitem' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node(e.jstree.root,(function(t,i){i&&(this.get_container_ul()[0].className=a,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(e.extend(!0,{},this._data.core.state),(function(){this.trigger("refresh")}))),this._data.core.state=null}))},refresh_node:function(t){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var i=[],a=[],s=this._data.core.selected.concat([]);a.push(t.id),!0===t.state.opened&&i.push(t.id),this.get_node(t,!0).find(".jstree-open").each((function(){a.push(this.id),i.push(this.id)})),this._load_nodes(a,function(e){this.open_node(i,!1,0),this.select_node(s),this.trigger("refresh_node",{node:t,nodes:e})}.bind(this),!1,!0)},set_id:function(t,i){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var a,s,n=this._model.data,r=t.id;for(i=i.toString(),n[t.parent].children[e.inArray(t.id,n[t.parent].children)]=i,a=0,s=t.parents.length;a<s;a++)n[t.parents[a]].children_d[e.inArray(t.id,n[t.parents[a]].children_d)]=i;for(a=0,s=t.children.length;a<s;a++)n[t.children[a]].parent=i;for(a=0,s=t.children_d.length;a<s;a++)n[t.children_d[a]].parents[e.inArray(t.id,n[t.children_d[a]].parents)]=i;return-1!==(a=e.inArray(t.id,this._data.core.selected))&&(this._data.core.selected[a]=i),(a=this.get_node(t.id,!0))&&(a.attr("id",i),this.element.attr("aria-activedescendant")===t.id&&this.element.attr("aria-activedescendant",i)),delete n[t.id],t.id=i,n[t.li_attr.id=i]=t,this.trigger("set_id",{node:t,new:t.id,old:r}),!0},get_text:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.text},set_text:function(t,i){var a,s;if(e.vakata.is_array(t)){for(a=0,s=(t=t.slice()).length;a<s;a++)this.set_text(t[a],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root||(t.text=i,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:i}),0))},get_json:function(t,i,a){if(!(t=this.get_node(t||e.jstree.root)))return!1;i&&i.flat&&!a&&(a=[]);var s,n,r={id:t.id,text:t.text,icon:this.get_icon(t),li_attr:e.extend(!0,{},t.li_attr),a_attr:e.extend(!0,{},t.a_attr),state:{},data:(!i||!i.no_data)&&e.extend(!0,e.vakata.is_array(t.data)?[]:{},t.data)};if(i&&i.flat?r.parent=t.parent:r.children=[],i&&i.no_state)delete r.state;else for(s in t.state)t.state.hasOwnProperty(s)&&(r.state[s]=t.state[s]);if(i&&i.no_li_attr&&delete r.li_attr,i&&i.no_a_attr&&delete r.a_attr,i&&i.no_id&&(delete r.id,r.li_attr&&r.li_attr.id&&delete r.li_attr.id,r.a_attr&&r.a_attr.id&&delete r.a_attr.id),i&&i.flat&&t.id!==e.jstree.root&&a.push(r),!i||!i.no_children)for(s=0,n=t.children.length;s<n;s++)i&&i.flat?this.get_json(t.children[s],i,a):r.children.push(this.get_json(t.children[s],i));return i&&i.flat?a:t.id===e.jstree.root?r.children:r},create_node:function(i,a,s,n,r){if(null===i&&(i=e.jstree.root),!(i=this.get_node(i)))return!1;if(!(s=s===t?"last":s).toString().match(/^(before|after)$/)&&!r&&!this.is_loaded(i))return this.load_node(i,(function(){this.create_node(i,a,s,n,!0)}));var o,l,d,c;switch((a="string"==typeof(a=a||{text:this.get_string("New node")})?{text:a}:e.extend(!0,{},a)).text===t&&(a.text=this.get_string("New node")),s=i.id===e.jstree.root&&"after"===(s="before"===s?"first":s)?"last":s){case"before":o=this.get_node(i.parent),s=e.inArray(i.id,o.children),i=o;break;case"after":o=this.get_node(i.parent),s=e.inArray(i.id,o.children)+1,i=o;break;case"inside":case"first":s=0;break;case"last":s=i.children.length;break;default:s=s||0}if(s>i.children.length&&(s=i.children.length),a.id===t&&(a.id=!0),!this.check("create_node",a,i,s))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===a.id&&delete a.id,!(a=this._parse_model_from_json(a,i.id,i.parents.concat())))return!1;for(o=this.get_node(a),(l=[]).push(a),l=l.concat(o.children_d),this.trigger("model",{nodes:l,parent:i.id}),i.children_d=i.children_d.concat(l),d=0,c=i.parents.length;d<c;d++)this._model.data[i.parents[d]].children_d=this._model.data[i.parents[d]].children_d.concat(l);for(a=o,o=[],d=0,c=i.children.length;d<c;d++)o[s<=d?d+1:d]=i.children[d];return o[s]=a.id,i.children=o,this.redraw_node(i,!0),this.trigger("create_node",{node:this.get_node(a),parent:i.id,position:s}),n&&n.call(this,this.get_node(a)),a.id},rename_node:function(t,i){var a,s,n;if(e.vakata.is_array(t)){for(a=0,s=(t=t.slice()).length;a<s;a++)this.rename_node(t[a],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root||(n=t.text,this.check("rename_node",t,this.get_parent(t),i)?(this.set_text(t,i),this.trigger("rename_node",{node:t,text:i,old:n}),0):(this.settings.core.error.call(this,this._data.core.last_error),1)))},delete_node:function(t){var i,a,s,n,r,o,l,d,c,m,_;if(e.vakata.is_array(t)){for(i=0,a=(t=t.slice()).length;i<a;i++)this.delete_node(t[i]);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;if(s=this.get_node(t.parent),_=e.inArray(t.id,s.children),c=!1,!this.check("delete_node",t,s,_))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==_&&(s.children=e.vakata.array_remove(s.children,_)),(n=t.children_d.concat([])).push(t.id),r=0,o=t.parents.length;r<o;r++)this._model.data[t.parents[r]].children_d=e.vakata.array_filter(this._model.data[t.parents[r]].children_d,(function(t){return-1===e.inArray(t,n)}));for(l=0,d=n.length;l<d;l++)if(this._model.data[n[l]].state.selected){c=!0;break}for(c&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,(function(t){return-1===e.inArray(t,n)}))),this.trigger("delete_node",{node:t,parent:s.id}),c&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:s.id}),l=0,d=n.length;l<d;l++)delete this._model.data[n[l]];return-1!==e.inArray(this._data.core.focused,n)&&(this._data.core.focused=null,m=this.element[0].scrollTop,_=this.element[0].scrollLeft,s.id===e.jstree.root?this._model.data[e.jstree.root].children[0]&&this.get_node(this._model.data[e.jstree.root].children[0],!0).children(".jstree-anchor").trigger("focus"):this.get_node(s,!0).children(".jstree-anchor").trigger("focus"),this.element[0].scrollTop=m,this.element[0].scrollLeft=_),this.redraw_node(s,!0),!0},check:function(t,i,a,s,n){i=i&&i.id?i:this.get_node(i),a=a&&a.id?a:this.get_node(a);var r=t.match(/^(move_node|copy_node|create_node)$/i)?a:i,o=this.settings.core.check_callback;if("move_node"===t||"copy_node"===t){if(!(n&&n.is_multi||"move_node"!==t||e.inArray(i.id,a.children)!==s))return!(this._data.core.last_error={error:"check",plugin:"core",id:"core_08",reason:"Moving node to its current position",data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!a||!a.id)&&a.id})});if(!(n&&n.is_multi||i.id!==a.id&&("move_node"!==t||e.inArray(i.id,a.children)!==s)&&-1===e.inArray(a.id,i.children_d)))return!(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!a||!a.id)&&a.id})})}return(r=r&&r.data?r.data:r)&&r.functions&&(!1===r.functions[t]||!0===r.functions[t])?(!1===r.functions[t]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!a||!a.id)&&a.id})}),r.functions[t]):!(!1===o||e.vakata.is_function(o)&&!1===o.call(this,t,i,a,s,n)||o&&!1===o[t])||!(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!a||!a.id)&&a.id})})},last_error:function(){return this._data.core.last_error},move_node:function(i,a,s,n,r,o,l){var d,c,m,_,h,p,u,g,f,v,b,y,k,w;if(a=this.get_node(a),s=s===t?0:s,!a)return!1;if(!s.toString().match(/^(before|after)$/)&&!r&&!this.is_loaded(a))return this.load_node(a,(function(){this.move_node(i,a,s,n,!0,!1,l)}));if(e.vakata.is_array(i)){if(1!==i.length){for(d=0,c=i.length;d<c;d++)(f=this.move_node(i[d],a,s,n,r,!1,l))&&(a=f,s="after");return this.redraw(),!0}i=i[0]}if(!(i=i&&i.id!==t?i:this.get_node(i))||i.id===e.jstree.root)return!1;if(m=(i.parent||e.jstree.root).toString(),h=s.toString().match(/^(before|after)$/)&&a.id!==e.jstree.root?this.get_node(a.parent):a,u=!(p=l||(this._model.data[i.id]?this:e.jstree.reference(i.id)))||!p._id||this._id!==p._id,_=p&&p._id&&m&&p._model.data[m]&&p._model.data[m].children?e.inArray(i.id,p._model.data[m].children):-1,p&&p._id&&(i=p._model.data[i.id]),u)return!!(f=this.copy_node(i,a,s,n,r,!1,l))&&(p&&p.delete_node(i),f);switch(s=a.id===e.jstree.root&&"after"===(s="before"===s?"first":s)?"last":s){case"before":s=e.inArray(a.id,h.children);break;case"after":s=e.inArray(a.id,h.children)+1;break;case"inside":case"first":s=0;break;case"last":s=h.children.length;break;default:s=s||0}if(s>h.children.length&&(s=h.children.length),!this.check("move_node",i,h,s,{core:!0,origin:l,is_multi:p&&p._id&&p._id!==this._id,is_foreign:!p||!p._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(i.parent===h.id){for(g=h.children.concat(),-1!==(f=e.inArray(i.id,g))&&(g=e.vakata.array_remove(g,f),f<s&&s--),f=[],v=0,b=g.length;v<b;v++)f[s<=v?v+1:v]=g[v];f[s]=i.id,h.children=f,this._node_changed(h.id),this.redraw(h.id===e.jstree.root)}else{for((f=i.children_d.concat()).push(i.id),v=0,b=i.parents.length;v<b;v++){for(g=[],y=0,k=(w=p._model.data[i.parents[v]].children_d).length;y<k;y++)-1===e.inArray(w[y],f)&&g.push(w[y]);p._model.data[i.parents[v]].children_d=g}for(p._model.data[m].children=e.vakata.array_remove_item(p._model.data[m].children,i.id),v=0,b=h.parents.length;v<b;v++)this._model.data[h.parents[v]].children_d=this._model.data[h.parents[v]].children_d.concat(f);for(g=[],v=0,b=h.children.length;v<b;v++)g[s<=v?v+1:v]=h.children[v];for(g[s]=i.id,h.children=g,h.children_d.push(i.id),h.children_d=h.children_d.concat(i.children_d),i.parent=h.id,(f=h.parents.concat()).unshift(h.id),w=i.parents.length,f=(i.parents=f).concat(),v=0,b=i.children_d.length;v<b;v++)this._model.data[i.children_d[v]].parents=this._model.data[i.children_d[v]].parents.slice(0,-1*w),Array.prototype.push.apply(this._model.data[i.children_d[v]].parents,f);m!==e.jstree.root&&h.id!==e.jstree.root||(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(m),this._node_changed(h.id)),o||this.redraw()}return n&&n.call(this,i,h,s),this.trigger("move_node",{node:i,parent:h.id,position:s,old_parent:m,old_position:_,is_multi:p&&p._id&&p._id!==this._id,is_foreign:!p||!p._id,old_instance:p,new_instance:this}),i.id},copy_node:function(i,a,s,n,r,o,l){var d,c,m,_,h,p,u,g,f,v;if(a=this.get_node(a),s=s===t?0:s,!a)return!1;if(!s.toString().match(/^(before|after)$/)&&!r&&!this.is_loaded(a))return this.load_node(a,(function(){this.copy_node(i,a,s,n,!0,!1,l)}));if(e.vakata.is_array(i)){if(1!==i.length){for(d=0,c=i.length;d<c;d++)(_=this.copy_node(i[d],a,s,n,r,!0,l))&&(a=_,s="after");return this.redraw(),!0}i=i[0]}if(!(i=i&&i.id!==t?i:this.get_node(i))||i.id===e.jstree.root)return!1;switch(g=(i.parent||e.jstree.root).toString(),f=s.toString().match(/^(before|after)$/)&&a.id!==e.jstree.root?this.get_node(a.parent):a,!(v=l||(this._model.data[i.id]?this:e.jstree.reference(i.id)))||!v._id||this._id!==v._id,v&&v._id&&(i=v._model.data[i.id]),s=a.id===e.jstree.root&&"after"===(s="before"===s?"first":s)?"last":s){case"before":s=e.inArray(a.id,f.children);break;case"after":s=e.inArray(a.id,f.children)+1;break;case"inside":case"first":s=0;break;case"last":s=f.children.length;break;default:s=s||0}if(s>f.children.length&&(s=f.children.length),!this.check("copy_node",i,f,s,{core:!0,origin:l,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(u=v?v.get_json(i,{no_id:!0,no_data:!0,no_state:!0}):i))return!1;if(!0===u.id&&delete u.id,!(u=this._parse_model_from_json(u,f.id,f.parents.concat())))return!1;for(_=this.get_node(u),i&&i.state&&!1===i.state.loaded&&(_.state.loaded=!1),(m=[]).push(u),m=m.concat(_.children_d),this.trigger("model",{nodes:m,parent:f.id}),h=0,p=f.parents.length;h<p;h++)this._model.data[f.parents[h]].children_d=this._model.data[f.parents[h]].children_d.concat(m);for(m=[],h=0,p=f.children.length;h<p;h++)m[s<=h?h+1:h]=f.children[h];return m[s]=_.id,f.children=m,f.children_d.push(_.id),f.children_d=f.children_d.concat(_.children_d),f.id===e.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(f.id),o||this.redraw(f.id===e.jstree.root),n&&n.call(this,_,f,s),this.trigger("copy_node",{node:_,original:i,parent:f.id,position:s,old_parent:g,old_position:v&&v._id&&g&&v._model.data[g]&&v._model.data[g].children?e.inArray(i.id,v._model.data[g].children):-1,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id,old_instance:v,new_instance:this}),_.id},cut:function(t){if(t=t||this._data.core.selected.concat(),!(t=e.vakata.is_array(t)?t:[t]).length)return!1;for(var i,r=[],o=0,l=t.length;o<l;o++)(i=this.get_node(t[o]))&&(i.id||0===i.id)&&i.id!==e.jstree.root&&r.push(i);if(!r.length)return!1;a=r,s="move_node",(n=this).trigger("cut",{node:t})},copy:function(i){if(i=i||this._data.core.selected.concat(),!(i=e.vakata.is_array(i)?i:[i]).length)return!1;for(var r,o=[],l=0,d=i.length;l<d;l++)(r=this.get_node(i[l]))&&r.id!==t&&r.id!==e.jstree.root&&o.push(r);if(!o.length)return!1;a=o,s="copy_node",(n=this).trigger("copy",{node:i})},get_buffer:function(){return{mode:s,node:a,inst:n}},can_paste:function(){return!1!==s&&!1!==a},paste:function(e,t){if(!((e=this.get_node(e))&&s&&s.match(/^(copy_node|move_node)$/)&&a))return!1;this[s](a,e,t,!1,!1,!1,n)&&this.trigger("paste",{parent:e.id,node:a,mode:s}),n=s=a=!1},clear_buffer:function(){n=s=a=!1,this.trigger("clear_buffer")},edit:function(t,i,a){var s,n,r,o,d,c,m,_,h=!1;return!!(t=this.get_node(t))&&(this.check("edit",t,this.get_parent(t))?(_=t,i="string"==typeof i?i:t.text,this.set_text(t,""),t=this._open_to(t),_.text=i,m=this._data.core.rtl,s=this.element.width(),this._data.core.focused=_.id,n=t.children(".jstree-anchor").trigger("focus"),r=e("<span></span>"),o=i,d=e("<div></div>",{css:{position:"absolute",top:"-200px",left:m?"0px":"-1000px",visibility:"hidden"}}).appendTo(l.body),c=e("<input />",{value:o,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:function(i){i.stopImmediatePropagation(),i.preventDefault();var s=r.children(".jstree-rename-input").val();i=this.settings.core.force_text;""===s&&(s=o),d.remove(),r.replaceWith(n),r.remove(),o=i?o:e("<div></div>").append(e.parseHTML(o)).html(),t=this.get_node(t),this.set_text(t,o),(i=!!this.rename_node(t,i?e("<div></div>").text(s).text():e("<div></div>").append(e.parseHTML(s)).html()))||this.set_text(t,o),this._data.core.focused=_.id,setTimeout(function(){var e=this.get_node(_.id,!0);e.length&&(this._data.core.focused=_.id,e.children(".jstree-anchor").trigger("focus"))}.bind(this),0),a&&a.call(this,_,i,h,s),c=null}.bind(this),keydown:function(e){var t=e.which;27===t&&(h=!0,this.value=o),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){c.width(Math.min(d.text("pW"+this.value).width(),s))},keypress:function(e){if(13===e.which)return!1}}),m={fontFamily:n.css("fontFamily")||"",fontSize:n.css("fontSize")||"",fontWeight:n.css("fontWeight")||"",fontStyle:n.css("fontStyle")||"",fontStretch:n.css("fontStretch")||"",fontVariant:n.css("fontVariant")||"",letterSpacing:n.css("letterSpacing")||"",wordSpacing:n.css("wordSpacing")||""},r.attr("class",n.attr("class")).append(n.contents().clone()).append(c),n.replaceWith(r),d.css(m),c.css(m).width(Math.min(d.text("pW"+c[0].value).width(),s))[0].select(),void e(l).one("mousedown.jstree touchstart.jstree dnd_start.vakata",(function(t){c&&t.target!==c&&e(c).trigger("blur")}))):(this.settings.core.error.call(this,this._data.core.last_error),!1))},set_theme:function(t,i){if(!t)return!1;(i=!0===i?(this.settings.core.themes.dir||e.jstree.path+"/themes")+"/"+t+"/style.css":i)&&-1===e.inArray(i,r)&&(e("head").append('<link rel="stylesheet" href="'+i+'" type="text/css" />'),r.push(i)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),(this._data.core.themes.variant=e)&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped"),this.trigger("show_stripes")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped"),this.trigger("hide_stripes")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots"),this.trigger("show_dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots"),this.trigger("hide_dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons"),this.trigger("show_icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons"),this.trigger("hide_icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},show_ellipsis:function(){this._data.core.themes.ellipsis=!0,this.get_container_ul().addClass("jstree-ellipsis"),this.trigger("show_ellipsis")},hide_ellipsis:function(){this._data.core.themes.ellipsis=!1,this.get_container_ul().removeClass("jstree-ellipsis"),this.trigger("hide_ellipsis")},toggle_ellipsis:function(){this._data.core.themes.ellipsis?this.hide_ellipsis():this.show_ellipsis()},set_icon:function(i,a){var s,n,r,o;if(e.vakata.is_array(i)){for(s=0,n=(i=i.slice()).length;s<n;s++)this.set_icon(i[s],a);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root||(o=i.icon,i.icon=!0===a||null===a||a===t||""===a||a,r=this.get_node(i,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===a?(r.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"),this.hide_icon(i)):(!0===a||null===a||a===t||""===a?r.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"):-1===a.indexOf("/")&&-1===a.indexOf(".")?(r.removeClass(o).css("background",""),r.addClass(a+" jstree-themeicon-custom").attr("rel",a)):(r.removeClass(o).css("background",""),r.addClass("jstree-themeicon-custom").css("background","url('"+a+"') center center no-repeat").attr("rel",a)),!1===o&&this.show_icon(i)),0))},get_icon:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.icon},hide_icon:function(t){var i,a;if(e.vakata.is_array(t)){for(i=0,a=(t=t.slice()).length;i<a;i++)this.hide_icon(t[i]);return!0}return!(!(t=this.get_node(t))||t===e.jstree.root||(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),0))},show_icon:function(t){var i,a,s;if(e.vakata.is_array(t)){for(i=0,a=(t=t.slice()).length;i<a;i++)this.show_icon(t[i]);return!0}return!(!(t=this.get_node(t))||t===e.jstree.root||(s=this.get_node(t,!0),t.icon=!s.length||s.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),t.icon||(t.icon=!0),s.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),0))}},e.vakata={},e.vakata.attributes=function(t,i){t=e(t)[0];var a=i?{}:[];return t&&t.attributes&&e.each(t.attributes,(function(t,s){-1===e.inArray(s.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==s.value&&""!==e.vakata.trim(s.value)&&(i?a[s.name]=s.value:a.push(s.name))})),a},e.vakata.array_unique=function(e){for(var i=[],a={},s=0,n=e.length;s<n;s++)a[e[s]]===t&&(i.push(e[s]),a[e[s]]=!0);return i},e.vakata.array_remove=function(e,t){return e.splice(t,1),e},e.vakata.array_remove_item=function(t,i){return-1!==(i=e.inArray(i,t))?e.vakata.array_remove(t,i):t},e.vakata.array_filter=function(e,t,i,a,s){if(e.filter)return e.filter(t,i);for(s in a=[],e)~~s+""==s+""&&0<=s&&t.call(i,e[s],+s,e)&&a.push(e[s]);return a},e.vakata.trim=function(e){return String.prototype.trim?String.prototype.trim.call(e.toString()):e.toString().replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},e.vakata.is_function=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},e.vakata.is_array=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Function.prototype.bind||(Function.prototype.bind=function(){var e=this,t=arguments[0],i=Array.prototype.slice.call(arguments,1);if("function"!=typeof e)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");return function(){var a=i.concat(Array.prototype.slice.call(arguments));return e.apply(t,a)}}),e.jstree.plugins.changed=function(e,t){var i=[];this.trigger=function(e,a){if(a=a||{},"changed"===e.replace(".jstree","")){a.changed={selected:[],deselected:[]};for(var s={},n=0,r=i.length;n<r;n++)s[i[n]]=1;for(n=0,r=a.selected.length;n<r;n++)s[a.selected[n]]?s[a.selected[n]]=2:a.changed.selected.push(a.selected[n]);for(n=0,r=i.length;n<r;n++)1===s[i[n]]&&a.changed.deselected.push(i[n]);i=a.selected.slice()}t.trigger.call(this,e,a)},this.refresh=function(e,a){return i=[],t.refresh.apply(this,arguments)}};var m,_,h,p,u,g,f,v,b=l.createElement("I");b.className="jstree-icon jstree-checkbox",b.setAttribute("role","presentation"),e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0,cascade_to_disabled:!0,cascade_to_hidden:!0},e.jstree.plugins.checkbox=function(i,a){this.bind=function(){a.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")}.bind(this)).on("loading.jstree",function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()}.bind(this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(this._undetermined.bind(this),50)}.bind(this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",function(e,t){for(var i=this._model.data,a=(i[t.parent],t.nodes),s=0,n=a.length;s<n;s++)i[a[s]].state.checked=i[a[s]].state.checked||i[a[s]].original&&i[a[s]].original.state&&i[a[s]].original.state.checked,i[a[s]].state.checked&&this._data.checkbox.selected.push(a[s])}.bind(this)),-1===this.settings.checkbox.cascade.indexOf("up")&&-1===this.settings.checkbox.cascade.indexOf("down")||this.element.on("model.jstree",function(t,i){var a,s,n,r,o,l,d=this._model.data,c=d[i.parent],m=i.nodes,_=[],h=(i=this.settings.checkbox.cascade,this.settings.checkbox.tie_selection);if(-1!==i.indexOf("down"))if(c.state[h?"selected":"checked"]){for(s=0,n=m.length;s<n;s++)d[m[s]].state[h?"selected":"checked"]=!0;this._data[h?"core":"checkbox"].selected=this._data[h?"core":"checkbox"].selected.concat(m)}else for(s=0,n=m.length;s<n;s++)if(d[m[s]].state[h?"selected":"checked"]){for(r=0,o=d[m[s]].children_d.length;r<o;r++)d[d[m[s]].children_d[r]].state[h?"selected":"checked"]=!0;this._data[h?"core":"checkbox"].selected=this._data[h?"core":"checkbox"].selected.concat(d[m[s]].children_d)}if(-1!==i.indexOf("up")){for(s=0,n=c.children_d.length;s<n;s++)d[c.children_d[s]].children.length||_.push(d[c.children_d[s]].parent);for(r=0,o=(_=e.vakata.array_unique(_)).length;r<o;r++)for(c=d[_[r]];c&&c.id!==e.jstree.root;){for(s=a=0,n=c.children.length;s<n;s++)a+=d[c.children[s]].state[h?"selected":"checked"];if(a!==n)break;c.state[h?"selected":"checked"]=!0,this._data[h?"core":"checkbox"].selected.push(c.id),(l=this.get_node(c,!0))&&l.length&&l.children(".jstree-anchor").attr("aria-selected",!0).addClass(h?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}}this._data[h?"core":"checkbox"].selected=e.vakata.array_unique(this._data[h?"core":"checkbox"].selected)}.bind(this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",function(t,i){var a,s,n=i.node,r=this._model.data,o=this.get_node(n.parent),l=(i=this.settings.checkbox.cascade,this.settings.checkbox.tie_selection),d={},c=this._data[l?"core":"checkbox"].selected;for(h=0,p=c.length;h<p;h++)d[c[h]]=!0;if(-1!==i.indexOf("down"))for(var m=this._cascade_new_checked_state(n.id,!0),_=n.children_d.concat(n.id),h=0,p=_.length;h<p;h++)-1<m.indexOf(_[h])?d[_[h]]=!0:delete d[_[h]];if(-1!==i.indexOf("up"))for(;o&&o.id!==e.jstree.root;){for(h=a=0,p=o.children.length;h<p;h++)a+=r[o.children[h]].state[l?"selected":"checked"];if(a!==p)break;o.state[l?"selected":"checked"]=!0,d[o.id]=!0,(s=this.get_node(o,!0))&&s.length&&s.children(".jstree-anchor").attr("aria-selected",!0).addClass(l?"jstree-clicked":"jstree-checked"),o=this.get_node(o.parent)}for(h in c=[],d)d.hasOwnProperty(h)&&c.push(h);this._data[l?"core":"checkbox"].selected=c}.bind(this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",function(t,i){for(var a,s=this.get_node(e.jstree.root),n=this._model.data,r=0,o=s.children_d.length;r<o;r++)(a=n[s.children_d[r]])&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1)}.bind(this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",function(t,i){var a,s,n,r,o=i.node,l=(this.get_node(o,!0),this.settings.checkbox.cascade),d=this.settings.checkbox.tie_selection,c=(i=this._data[d?"core":"checkbox"].selected,o.children_d.concat(o.id));if(-1!==l.indexOf("down")&&(r=this._cascade_new_checked_state(o.id,!1),i=e.vakata.array_filter(i,(function(e){return-1===c.indexOf(e)||-1<r.indexOf(e)}))),-1!==l.indexOf("up")&&-1===i.indexOf(o.id)){for(a=0,s=o.parents.length;a<s;a++)(n=this._model.data[o.parents[a]]).state[d?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1),(n=this.get_node(o.parents[a],!0))&&n.length&&n.children(".jstree-anchor").attr("aria-selected",!1).removeClass(d?"jstree-clicked":"jstree-checked");i=e.vakata.array_filter(i,(function(e){return-1===o.parents.indexOf(e)}))}this._data[d?"core":"checkbox"].selected=i}.bind(this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",function(t,i){for(var a,s,n,r,o=this.get_node(i.parent),l=this._model.data,d=this.settings.checkbox.tie_selection;o&&o.id!==e.jstree.root&&!o.state[d?"selected":"checked"];){for(a=n=0,s=o.children.length;a<s;a++)n+=l[o.children[a]].state[d?"selected":"checked"];if(!(0<s&&n===s))break;o.state[d?"selected":"checked"]=!0,this._data[d?"core":"checkbox"].selected.push(o.id),(r=this.get_node(o,!0))&&r.length&&r.children(".jstree-anchor").attr("aria-selected",!0).addClass(d?"jstree-clicked":"jstree-checked"),o=this.get_node(o.parent)}}.bind(this)).on("move_node.jstree",function(t,i){var a,s,n,r,o,l=i.is_multi,d=i.old_parent,c=(i=this.get_node(i.parent),this._model.data),m=this.settings.checkbox.tie_selection;if(!l)for(a=this.get_node(d);a&&a.id!==e.jstree.root&&!a.state[m?"selected":"checked"];){for(n=s=0,r=a.children.length;n<r;n++)s+=c[a.children[n]].state[m?"selected":"checked"];if(!(0<r&&s===r))break;a.state[m?"selected":"checked"]=!0,this._data[m?"core":"checkbox"].selected.push(a.id),(o=this.get_node(a,!0))&&o.length&&o.children(".jstree-anchor").attr("aria-selected",!0).addClass(m?"jstree-clicked":"jstree-checked"),a=this.get_node(a.parent)}for(a=i;a&&a.id!==e.jstree.root;){for(n=s=0,r=a.children.length;n<r;n++)s+=c[a.children[n]].state[m?"selected":"checked"];if(s===r)a.state[m?"selected":"checked"]||(a.state[m?"selected":"checked"]=!0,this._data[m?"core":"checkbox"].selected.push(a.id),(o=this.get_node(a,!0))&&o.length&&o.children(".jstree-anchor").attr("aria-selected",!0).addClass(m?"jstree-clicked":"jstree-checked"));else{if(!a.state[m?"selected":"checked"])break;a.state[m?"selected":"checked"]=!1,this._data[m?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[m?"core":"checkbox"].selected,a.id),(o=this.get_node(a,!0))&&o.length&&o.children(".jstree-anchor").attr("aria-selected",!1).removeClass(m?"jstree-clicked":"jstree-checked")}a=this.get_node(a.parent)}}.bind(this))},this.get_undetermined=function(i){if(-1===this.settings.checkbox.cascade.indexOf("undetermined"))return[];for(var a,s,n={},r=this._model.data,o=this.settings.checkbox.tie_selection,l=this._data[o?"core":"checkbox"].selected,d=[],c=this,m=[],_=0,h=l.length;_<h;_++)if(r[l[_]]&&r[l[_]].parents)for(a=0,s=r[l[_]].parents.length;a<s&&n[r[l[_]].parents[a]]===t;a++)r[l[_]].parents[a]!==e.jstree.root&&(n[r[l[_]].parents[a]]=!0,d.push(r[l[_]].parents[a]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each((function(){var i,o=c.get_node(this);if(o)if(o.state.loaded){for(_=0,h=o.children_d.length;_<h;_++)if(!(i=r[o.children_d[_]]).state.loaded&&i.original&&i.original.state&&i.original.state.undetermined&&!0===i.original.state.undetermined)for(n[i.id]===t&&i.id!==e.jstree.root&&(n[i.id]=!0,d.push(i.id)),a=0,s=i.parents.length;a<s;a++)n[i.parents[a]]===t&&i.parents[a]!==e.jstree.root&&(n[i.parents[a]]=!0,d.push(i.parents[a]))}else if(o.original&&o.original.state&&o.original.state.undetermined&&!0===o.original.state.undetermined)for(n[o.id]===t&&o.id!==e.jstree.root&&(n[o.id]=!0,d.push(o.id)),a=0,s=o.parents.length;a<s;a++)n[o.parents[a]]===t&&o.parents[a]!==e.jstree.root&&(n[o.parents[a]]=!0,d.push(o.parents[a]))})),_=0,h=d.length;_<h;_++)r[d[_]].state[o?"selected":"checked"]||m.push(i?r[d[_]]:d[_]);return m},this._undetermined=function(){if(null!==this.element){var e,t,i,a=this.get_undetermined(!1);for(this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),e=0,t=a.length;e<t;e++)(i=this.get_node(a[e],!0))&&i.length&&i.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}},this.redraw_node=function(e,t,i,s){if(e=a.redraw_node.apply(this,arguments)){for(var n=null,r=null,o=0,l=e.childNodes.length;o<l;o++)if(e.childNodes[o]&&e.childNodes[o].className&&-1!==e.childNodes[o].className.indexOf("jstree-anchor")){n=e.childNodes[o];break}n&&(!this.settings.checkbox.tie_selection&&this._model.data[e.id].state.checked&&(n.className+=" jstree-checked"),r=b.cloneNode(!1),this._model.data[e.id].state.checkbox_disabled&&(r.className+=" jstree-checkbox-disabled"),n.insertBefore(r,n.childNodes[0]))}return i||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(this._undetermined.bind(this),50)),e},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var i,a,s=this.settings.checkbox.cascade,n=this.settings.checkbox.tie_selection,r=this._data[n?"core":"checkbox"].selected,o=this._model.data;if(!t||!0===t.state[n?"selected":"checked"]||-1===s.indexOf("undetermined")||-1===s.indexOf("down")&&-1===s.indexOf("up"))return!1;if(!t.state.loaded&&!0===t.original.state.undetermined)return!0;for(i=0,a=t.children_d.length;i<a;i++)if(-1!==e.inArray(t.children_d[i],r)||!o[t.children_d[i]].state.loaded&&o[t.children_d[i]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(t){var i,a,s;if(e.vakata.is_array(t)){for(i=0,a=(t=t.slice()).length;i<a;i++)this.disable_checkbox(t[i]);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;s=this.get_node(t,!0),t.state.checkbox_disabled||(t.state.checkbox_disabled=!0,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:t}))},this.enable_checkbox=function(t){var i,a,s;if(e.vakata.is_array(t)){for(i=0,a=(t=t.slice()).length;i<a;i++)this.enable_checkbox(t[i]);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;s=this.get_node(t,!0),t.state.checkbox_disabled&&(t.state.checkbox_disabled=!1,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:t}))},this.activate_node=function(t,i){return!e(i.target).hasClass("jstree-checkbox-disabled")&&(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(i.target).hasClass("jstree-checkbox"))&&(i.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(i.target).hasClass("jstree-checkbox")?a.activate_node.call(this,t,i):!this.is_disabled(t)&&(this.is_checked(t)?this.uncheck_node(t,i):this.check_node(t,i),void this.trigger("activate_node",{node:this.get_node(t)})))},this.delete_node=function(t){if(this.settings.checkbox.tie_selection||e.vakata.is_array(t))return a.delete_node.call(this,t);var i,s,n,r=!1;if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;for((i=t.children_d.concat([])).push(t.id),s=0,n=i.length;s<n;s++)if(this._model.data[i[s]].state.checked){r=!0;break}return r&&(this._data.checkbox.selected=e.vakata.array_filter(this._data.checkbox.selected,(function(t){return-1===e.inArray(t,i)}))),a.delete_node.call(this,t)},this._cascade_new_checked_state=function(e,t){var i,a,s=this.settings.checkbox.tie_selection,n=this._model.data[e],r=[],o=[];if(!this.settings.checkbox.cascade_to_disabled&&n.state.disabled||!this.settings.checkbox.cascade_to_hidden&&n.state.hidden)d=this.get_checked_descendants(e),n.state[s?"selected":"checked"]&&d.push(n.id),r=r.concat(d);else{if(n.children)for(i=0,a=n.children.length;i<a;i++){var l=n.children[i],d=this._cascade_new_checked_state(l,t);r=r.concat(d);-1<d.indexOf(l)&&o.push(l)}var c=this.get_node(n,!0);e=0<o.length&&o.length<n.children.length;n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=e),!e&&t&&o.length===n.children.length?(n.state[s?"selected":"checked"]=t,r.push(n.id),c.children(".jstree-anchor").attr("aria-selected",!0).addClass(s?"jstree-clicked":"jstree-checked")):(n.state[s?"selected":"checked"]=!1,c.children(".jstree-anchor").attr("aria-selected",!1).removeClass(s?"jstree-clicked":"jstree-checked"))}return r},this.get_checked_descendants=function(t){var i=this,a=i.settings.checkbox.tie_selection;t=i._model.data[t];return e.vakata.array_filter(t.children_d,(function(e){return i._model.data[e].state[a?"selected":"checked"]}))},this.check_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,i);var a,s,n;if(e.vakata.is_array(t)){for(s=0,n=(t=t.slice()).length;s<n;s++)this.check_node(t[s],i);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;a=this.get_node(t,!0),t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),a&&a.length&&a.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:i}))},this.uncheck_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,i);var a,s,n;if(e.vakata.is_array(t)){for(a=0,s=(t=t.slice()).length;a<s;a++)this.uncheck_node(t[a],i);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;n=this.get_node(t,!0),t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),n.length&&n.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:i}))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var t,i;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data[e.jstree.root].children_d.concat(),t=0,i=this._data.checkbox.selected.length;t<i;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();for(var e=this._data.checkbox.selected.concat([]),t=0,i=this._data.checkbox.selected.length;t<i;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:e})},this.is_checked=function(t){return this.settings.checkbox.tie_selection?this.is_selected(t):!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.state.checked},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,function(e){return this.get_node(e)}.bind(this)):this._data.checkbox.selected.slice()},this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);for(var i,a,s=this.get_checked(!0),n={},r=0,o=s.length;r<o;r++)n[s[r].id]=s[r];for(r=0,o=s.length;r<o;r++)for(i=0,a=s[r].children_d.length;i<a;i++)n[s[r].children_d[i]]&&delete n[s[r].children_d[i]];for(r in s=[],n)n.hasOwnProperty(r)&&s.push(r);return t?e.map(s,function(e){return this.get_node(e)}.bind(this)):s},this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);for(var i=this.get_checked(!0),a=[],s=0,n=i.length;s<n;s++)i[s].children.length||a.push(i[s].id);return t?e.map(a,function(e){return this.get_node(e)}.bind(this)):a},this.load_node=function(t,i){var s,n,r;if(!e.vakata.is_array(t)&&!this.settings.checkbox.tie_selection&&(r=this.get_node(t))&&r.state.loaded)for(s=0,n=r.children_d.length;s<n;s++)this._model.data[r.children_d[s]].state.checked&&(this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,r.children_d[s]));return a.load_node.apply(this,arguments)},this.get_state=function(){var e=a.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection||(e.checkbox=this._data.checkbox.selected.slice()),e},this.set_state=function(t,i){var s,n=a.set_state.apply(this,arguments);return n&&t.checkbox?(this.settings.checkbox.tie_selection||(this.uncheck_all(),s=this,e.each(t.checkbox,(function(e,t){s.check_node(t)}))),delete t.checkbox,this.set_state(t,i),!1):n},this.refresh=function(e,t){return this.settings.checkbox.tie_selection&&(this._data.checkbox.selected=[]),a.refresh.apply(this,arguments)}},e.jstree.defaults.conditionalselect=function(){return!0},e.jstree.plugins.conditionalselect=function(e,t){this.activate_node=function(e,i){if(this.settings.conditionalselect.call(this,this.get_node(e),i))return t.activate_node.call(this,e,i)}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(t,i){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var i=e.jstree.reference(t.reference);t=i.get_node(t.reference);i.create_node(t,{},"last",(function(e){try{i.edit(e)}catch(t){setTimeout((function(){i.edit(e)}),0)}}))}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var i=e.jstree.reference(t.reference);t=i.get_node(t.reference);i.edit(t)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var i=e.jstree.reference(t.reference);t=i.get_node(t.reference);i.is_selected(t)?i.delete_node(i.get_selected()):i.delete_node(t)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var i=e.jstree.reference(t.reference);t=i.get_node(t.reference);i.is_selected(t)?i.cut(i.get_top_selected()):i.cut(t)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var i=e.jstree.reference(t.reference);t=i.get_node(t.reference);i.is_selected(t)?i.copy(i.get_top_selected()):i.copy(t)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var i=e.jstree.reference(t.reference);t=i.get_node(t.reference);i.paste(t)}}}}}}},e.jstree.plugins.contextmenu=function(i,a){this.bind=function(){a.bind.call(this);var t,i,s=0,n=null;this.element.on("init.jstree loading.jstree ready.jstree",function(){this.get_container_ul().addClass("jstree-contextmenu")}.bind(this)).on("contextmenu.jstree",".jstree-anchor",function(e,t){"input"!==e.target.tagName.toLowerCase()&&(e.preventDefault(),s=e.ctrlKey?+new Date:0,(t||n)&&(s=+new Date+1e4),n&&clearTimeout(n),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e))}.bind(this)).on("click.jstree",".jstree-anchor",function(t){this._data.contextmenu.visible&&(!s||250<+new Date-s)&&e.vakata.context.hide(),s=0}.bind(this)).on("touchstart.jstree",".jstree-anchor",(function(a){a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]&&(t=a.originalEvent.changedTouches[0].clientX,i=a.originalEvent.changedTouches[0].clientY,n=setTimeout((function(){e(a.currentTarget).trigger("contextmenu",!0)}),750))})).on("touchmove.vakata.jstree",(function(a){n&&a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]&&(10<Math.abs(t-a.originalEvent.changedTouches[0].clientX)||10<Math.abs(i-a.originalEvent.changedTouches[0].clientY))&&(clearTimeout(n),e.vakata.context.hide())})).on("touchend.vakata.jstree",(function(e){n&&clearTimeout(n)})),e(l).on("context_hide.vakata.jstree",function(t,i){this._data.contextmenu.visible=!1,e(i.reference).removeClass("jstree-context")}.bind(this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),e(l).off("context_hide.vakata.jstree"),a.teardown.call(this)},this.show_contextmenu=function(i,a,s,n){if(!(i=this.get_node(i))||i.id===e.jstree.root)return!1;var r=this.settings.contextmenu,o=this.get_node(i,!0).children(".jstree-anchor"),l=!1,d=!1;!r.show_at_node&&a!==t&&s!==t||(l=o.offset(),a=l.left,s=l.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(i)&&this.activate_node(i,n),d=r.items,e.vakata.is_function(d)&&(d=d.call(this,i,function(e){this._show_contextmenu(i,a,s,e)}.bind(this))),e.isPlainObject(d)&&this._show_contextmenu(i,a,s,d)},this._show_contextmenu=function(t,i,a,s){var n=this.get_node(t,!0).children(".jstree-anchor");e(l).one("context_show.vakata.jstree",function(t,i){var a="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(i.element).addClass(a),n.addClass("jstree-context")}.bind(this)),this._data.contextmenu.visible=!0,e.vakata.context.show(n,{x:i,y:a},s),this.trigger("show_contextmenu",{node:t,x:i,y:a})}},h={element:_=!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1},(m=e).vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(e){m(l).triggerHandler("context_"+e+".vakata",{reference:h.reference,element:h.element,position:{x:h.position_x,y:h.position_y}})},_execute:function(e){return!(!(e=h.items[e])||e._disabled&&(!m.vakata.is_function(e._disabled)||e._disabled({item:e,reference:h.reference,element:h.element}))||!e.action)&&e.action.call(null,{item:e,reference:h.reference,element:h.element,position:{x:h.position_x,y:h.position_y}})},_parse:function(e,t){if(!e)return!1;t||(h.html="",h.items=[]);var i,a="",s=!1;return t&&(a+="<ul>"),m.each(e,(function(e,t){return!t||(h.items.push(t),!s&&t.separator_before&&(a+="<li class='vakata-context-separator'><a href='#' "+(m.vakata.context.settings.icons?"":'class="vakata-context-no-icons"')+">&#160;</a></li>"),s=!1,a+="<li class='"+(t._class||"")+(!0===t._disabled||m.vakata.is_function(t._disabled)&&t._disabled({item:t,reference:h.reference,element:h.element})?" vakata-contextmenu-disabled ":"")+"' "+(t.shortcut?" data-shortcut='"+t.shortcut+"' ":"")+">",a+="<a href='#' rel='"+(h.items.length-1)+"' "+(t.title?"title='"+t.title+"'":"")+">",m.vakata.context.settings.icons&&(a+="<i ",t.icon&&(-1!==t.icon.indexOf("/")||-1!==t.icon.indexOf(".")?a+=" style='background:url(\""+t.icon+"\") center center no-repeat' ":a+=" class='"+t.icon+"' "),a+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),a+=(m.vakata.is_function(t.label)?t.label({item:e,reference:h.reference,element:h.element}):t.label)+(t.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+t.shortcut+'">'+(t.shortcut_label||"")+"</span>":"")+"</a>",t.submenu&&(i=m.vakata.context._parse(t.submenu,!0))&&(a+=i),a+="</li>",void(t.separator_after&&(a+="<li class='vakata-context-separator'><a href='#' "+(m.vakata.context.settings.icons?"":'class="vakata-context-no-icons"')+">&#160;</a></li>",s=!0)))})),a=a.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),t&&(a+="</ul>"),t||(h.html=a,m.vakata.context._trigger("parse")),10<a.length&&a},_show_submenu:function(e){var t,i,a,s,n,r,o,l;(e=m(e)).length&&e.children("ul").length&&(t=e.children("ul"),a=(i=e.offset().left)+e.outerWidth(),s=e.offset().top,n=t.width(),r=t.height(),o=m(window).width()+m(window).scrollLeft(),l=m(window).height()+m(window).scrollTop(),_?e[a-(n+10+e.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):e[o<a+n&&o-a<i?"addClass":"removeClass"]("vakata-context-right"),l<s+r+10&&t.css("bottom","-1px"),e.hasClass("vakata-context-right")?i<n&&t.css("margin-right",i-n):o-a<n&&t.css("margin-left",o-a-n),t.show())},show:function(e,t,i){var a,s,n,r,o,d,c;switch(h.element&&h.element.length&&h.element.width(""),!0){case!t&&!e:return!1;case!!t&&!!e:h.reference=e,h.position_x=t.x,h.position_y=t.y;break;case!t&&!!e:a=(h.reference=e).offset(),h.position_x=a.left+e.outerHeight(),h.position_y=a.top;break;case!!t&&!e:h.position_x=t.x,h.position_y=t.y}e&&!i&&m(e).data("vakata_contextmenu")&&(i=m(e).data("vakata_contextmenu")),m.vakata.context._parse(i)&&h.element.html(h.html),h.items.length&&(h.element.appendTo(l.body),s=h.element,n=h.position_x,r=h.position_y,o=s.width(),d=s.height(),c=m(window).width()+m(window).scrollLeft(),i=m(window).height()+m(window).scrollTop(),_&&(n-=s.outerWidth()-m(e).outerWidth())<m(window).scrollLeft()+20&&(n=m(window).scrollLeft()+20),h.element.css({left:n=c<n+o+20?c-(o+20):n,top:r=i<r+d+20?i-(d+20):r}).show().find("a").first().trigger("focus").parent().addClass("vakata-context-hover"),h.is_visible=!0,m.vakata.context._trigger("show"))},hide:function(){h.is_visible&&(h.element.hide().find("ul").hide().end().find(":focus").trigger("blur").end().detach(),h.is_visible=!1,m.vakata.context._trigger("hide"))}},m((function(){_="rtl"===m(l.body).css("direction");var e=!1;h.element=m("<ul class='vakata-context'></ul>"),h.element.on("mouseenter","li",(function(t){t.stopImmediatePropagation(),m.contains(this,t.relatedTarget)||(e&&clearTimeout(e),h.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),m(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),m.vakata.context._show_submenu(this))})).on("mouseleave","li",(function(e){m.contains(this,e.relatedTarget)||m(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")})).on("mouseleave",(function(t){m(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),m.vakata.context.settings.hide_onmouseleave&&(e=setTimeout((this,function(){m.vakata.context.hide()}),m.vakata.context.settings.hide_onmouseleave))})).on("click","a",(function(e){e.preventDefault(),m(this).trigger("blur").parent().hasClass("vakata-context-disabled")||!1===m.vakata.context._execute(m(this).attr("rel"))||m.vakata.context.hide()})).on("keydown","a",(function(e){var t=null;switch(e.which){case 13:case 32:e.type="click",e.preventDefault(),m(e.currentTarget).trigger(e);break;case 37:h.is_visible&&(h.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").trigger("focus"),e.stopImmediatePropagation(),e.preventDefault());break;case 38:h.is_visible&&((t=(t=h.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first()).length?t:h.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()).addClass("vakata-context-hover").children("a").trigger("focus"),e.stopImmediatePropagation(),e.preventDefault());break;case 39:h.is_visible&&(h.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").trigger("focus"),e.stopImmediatePropagation(),e.preventDefault());break;case 40:h.is_visible&&((t=(t=h.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first()).length?t:h.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()).addClass("vakata-context-hover").children("a").trigger("focus"),e.stopImmediatePropagation(),e.preventDefault());break;case 27:m.vakata.context.hide(),e.preventDefault()}})).on("keydown",(function(e){e.preventDefault(),(e=h.element.find(".vakata-contextmenu-shortcut-"+e.which).parent()).parent().not(".vakata-context-disabled")&&e.trigger("click")})),m(l).on("mousedown.vakata.jstree",(function(e){h.is_visible&&h.element[0]!==e.target&&!m.contains(h.element[0],e.target)&&m.vakata.context.hide()})).on("context_show.vakata.jstree",(function(e,t){h.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),_&&h.element.addClass("vakata-context-rtl").css("direction","rtl"),h.element.find("ul").hide().end()}))})),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1,blank_space_drop:!1},e.jstree.plugins.dnd=function(t,i){this.init=function(e,t){i.init.call(this,e,t),this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in l.createElement("span")},this.bind=function(){i.bind.call(this),this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",function(t){if(this.settings.dnd.large_drag_target&&e(t.target).closest(".jstree-node")[0]!==t.currentTarget)return!0;if("touchstart"===t.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var i=this.get_node(t.target),a=this.is_selected(i)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,s=1<a?a+" "+this.get_string("nodes"):this.get_text(t.currentTarget);if(this.settings.core.force_text&&(s=e.vakata.html.escape(s)),i&&(i.id||0===i.id)&&i.id!==e.jstree.root&&(1===t.which||"touchstart"===t.type||"dragstart"===t.type)&&(!0===this.settings.dnd.is_draggable||e.vakata.is_function(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,1<a?this.get_top_selected(!0):[i],t))){if(p={jstree:!0,origin:this,obj:this.get_node(i,!0),nodes:1<a?this.get_top_selected():[i.id]},u=t.currentTarget,!this.settings.dnd.use_html5)return this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,p,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+s+'<ins class="jstree-copy">+</ins></div>');e.vakata.dnd._trigger("start",t,{helper:e(),element:u,data:p})}}.bind(this)),this.settings.dnd.use_html5&&this.element.on("dragover.jstree",(function(t){return t.preventDefault(),e.vakata.dnd._trigger("move",t,{helper:e(),element:u,data:p}),!1})).on("drop.jstree",function(t){return t.preventDefault(),e.vakata.dnd._trigger("stop",t,{helper:e(),element:u,data:p}),!1}.bind(this))},this.redraw_node=function(e,t,a,s){if((e=i.redraw_node.apply(this,arguments))&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)e.setAttribute("draggable",!0);else{for(var n=null,r=0,o=e.childNodes.length;r<o;r++)if(e.childNodes[r]&&e.childNodes[r].className&&-1!==e.childNodes[r].className.indexOf("jstree-anchor")){n=e.childNodes[r];break}n&&n.setAttribute("draggable",!0)}return e}},e((function(){var i=!1,a=!1,s=!1,n=!1,r=e('<div id="jstree-marker">&#160;</div>').hide();e(l).on("dragover.vakata.jstree",(function(t){u&&e.vakata.dnd._trigger("move",t,{helper:e(),element:u,data:p})})).on("drop.vakata.jstree",(function(t){u&&(e.vakata.dnd._trigger("stop",t,{helper:e(),element:u,data:p}),p=u=null)})).on("dnd_start.vakata.jstree",(function(e,t){s=i=!1,t&&t.data&&t.data.jstree&&r.appendTo(l.body)})).on("dnd_move.vakata.jstree",(function(o,l){var d=l.event.target!==s.target;if(n&&(l.event&&"dragover"===l.event.type&&!d||clearTimeout(n)),l&&l.data&&l.data.jstree&&(!l.event.target.id||"jstree-marker"!==l.event.target.id)){s=l.event;var c,m,_,h,p,u,g,f,v,b,y,k,w,j,x,T,C,$=e.jstree.reference(l.event.target),S=!1,P=!1,M=!1;if($&&$._data&&$._data.dnd)if(r.attr("class","jstree-"+$.get_theme()+($.settings.core.themes.responsive?" jstree-dnd-responsive":"")),x=l.data.origin&&(l.data.origin.settings.dnd.always_copy||l.data.origin.settings.dnd.copy&&(l.event.metaKey||l.event.ctrlKey)),l.helper.children().attr("class","jstree-"+$.get_theme()+" jstree-"+$.get_theme()+"-"+$.get_theme_variant()+" "+($.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[x?"show":"hide"](),l.event.target!==$.element[0]&&l.event.target!==$.get_container_ul()[0]||0!==$.get_container_ul().children().length&&!$.settings.dnd.blank_space_drop){if((S=$.settings.dnd.large_drop_target?e(l.event.target).closest(".jstree-node").children(".jstree-anchor"):e(l.event.target).closest(".jstree-anchor"))&&S.length&&S.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(P=S.offset(),M=(l.event.pageY!==t?l.event:l.event.originalEvent).pageY-P.top,_=S.outerHeight(),u=M<_/3?["b","i","a"]:_-_/3<M?["a","i","b"]:_/2<M?["i","a","b"]:["i","b","a"],e.each(u,(function(t,s){switch(s){case"b":c=P.left-6,m=P.top,h=$.get_parent(S),p=S.parent().index(),C="jstree-below";break;case"i":w=$.settings.dnd.inside_pos,j=$.get_node(S.parent()),c=P.left-2,m=P.top+_/2+1,h=j.id,p="first"===w?0:"last"===w?j.children.length:Math.min(w,j.children.length),C="jstree-inside";break;case"a":c=P.left-6,m=P.top+_,h=$.get_parent(S),p=S.parent().index()+1,C="jstree-above"}for(g=!0,f=0,v=l.data.nodes.length;f<v;f++)if(b=l.data.origin&&(l.data.origin.settings.dnd.always_copy||l.data.origin.settings.dnd.copy&&(l.event.metaKey||l.event.ctrlKey))?"copy_node":"move_node",y=p,"move_node"==b&&"a"===s&&l.data.origin&&l.data.origin===$&&h===$.get_parent(l.data.nodes[f])&&(k=$.get_node(h),y>e.inArray(l.data.nodes[f],k.children)&&--y),!(g=g&&($&&$.settings&&$.settings.dnd&&!1===$.settings.dnd.check_while_dragging||$.check(b,l.data.origin&&l.data.origin!==$?l.data.origin.get_node(l.data.nodes[f]):l.data.nodes[f],h,y,{dnd:!0,ref:$.get_node(S.parent()),pos:s,origin:l.data.origin,is_multi:l.data.origin&&l.data.origin!==$,is_foreign:!l.data.origin})))){$&&$.last_error&&(a=$.last_error());break}var o,M;if("i"===s&&S.parent().is(".jstree-closed")&&$.settings.dnd.open_timeout&&(l.event&&"dragover"===l.event.type&&!d||(n&&clearTimeout(n),n=setTimeout((M=S,function(){o.open_node(M)}),(o=$).settings.dnd.open_timeout))),g)return(T=$.get_node(h,!0)).hasClass(".jstree-dnd-parent")||(e(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),T.addClass("jstree-dnd-parent")),i={ins:$,par:h,pos:"i"!==s||"last"!==w||0!==p||$.is_loaded(j)?p:"last"},r.css({left:c+"px",top:m+"px"}).show(),r.removeClass("jstree-above jstree-inside jstree-below").addClass(C),l.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),l.event.originalEvent&&l.event.originalEvent.dataTransfer&&(l.event.originalEvent.dataTransfer.dropEffect=x?"copy":"move"),a={},!(u=!0)})),!0===u))return}else{for(g=!0,f=0,v=l.data.nodes.length;f<v&&(g=g&&$.check(l.data.origin&&(l.data.origin.settings.dnd.always_copy||l.data.origin.settings.dnd.copy&&(l.event.metaKey||l.event.ctrlKey))?"copy_node":"move_node",l.data.origin&&l.data.origin!==$?l.data.origin.get_node(l.data.nodes[f]):l.data.nodes[f],e.jstree.root,"last",{dnd:!0,ref:$.get_node(e.jstree.root),pos:"i",origin:l.data.origin,is_multi:l.data.origin&&l.data.origin!==$,is_foreign:!l.data.origin}));f++);if(g)return i={ins:$,par:e.jstree.root,pos:"last"},r.hide(),l.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),void(l.event.originalEvent&&l.event.originalEvent.dataTransfer&&(l.event.originalEvent.dataTransfer.dropEffect=x?"copy":"move"))}e(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),i=!1,l.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),l.event.originalEvent&&l.event.originalEvent.dataTransfer,r.hide()}})).on("dnd_scroll.vakata.jstree",(function(e,t){t&&t.data&&t.data.jstree&&(r.hide(),s=i=!1,t.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))})).on("dnd_stop.vakata.jstree",(function(t,o){if(e(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),n&&clearTimeout(n),o&&o.data&&o.data.jstree){r.hide().detach();var l,d,c=[];if(i){for(l=0,d=o.data.nodes.length;l<d;l++)c[l]=o.data.origin?o.data.origin.get_node(o.data.nodes[l]):o.data.nodes[l];i.ins[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node"](c,i.par,i.pos,!1,!1,!1,o.data.origin)}else(l=e(o.event.target).closest(".jstree")).length&&a&&a.error&&"check"===a.error&&(l=l.jstree(!0))&&l.settings.core.error.call(this,a);i=s=!1}})).on("keyup.jstree keydown.jstree",(function(t,o){(o=e.vakata.dnd._get())&&o.data&&o.data.jstree&&("keyup"===t.type&&27===t.which?(n&&clearTimeout(n),n=s=a=i=!1,r.hide().detach(),e.vakata.dnd._clean()):(o.helper.find(".jstree-copy").first()[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"](),s&&(s.metaKey=t.metaKey,s.ctrlKey=t.ctrlKey,e.vakata.dnd._trigger("move",s))))}))})),f={element:!((g=e).vakata.html={div:g("<div></div>"),escape:function(e){return g.vakata.html.div.text(e).html()},strip:function(e){return g.vakata.html.div.empty().append(g.parseHTML(e)).text()}}),target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},g.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:10},_trigger:function(e,i,a){(a=a===t?g.vakata.dnd._get():a).event=i,g(l).triggerHandler("dnd_"+e+".vakata",a)},_get:function(){return{data:f.data,element:f.element,helper:f.helper}},_clean:function(){f.helper&&f.helper.remove(),f.scroll_i&&(clearInterval(f.scroll_i),f.scroll_i=!1),f={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},u=null,g(l).off("mousemove.vakata.jstree touchmove.vakata.jstree",g.vakata.dnd.drag),g(l).off("mouseup.vakata.jstree touchend.vakata.jstree",g.vakata.dnd.stop)},_scroll:function(e){if(!f.scroll_e||!f.scroll_l&&!f.scroll_t)return f.scroll_i&&(clearInterval(f.scroll_i),f.scroll_i=!1),!1;if(!f.scroll_i)return f.scroll_i=setInterval(g.vakata.dnd._scroll,100),!1;if(!0===e)return!1;var t=f.scroll_e.scrollTop();e=f.scroll_e.scrollLeft();f.scroll_e.scrollTop(t+f.scroll_t*g.vakata.dnd.settings.scroll_speed),f.scroll_e.scrollLeft(e+f.scroll_l*g.vakata.dnd.settings.scroll_speed),t===f.scroll_e.scrollTop()&&e===f.scroll_e.scrollLeft()||g.vakata.dnd._trigger("scroll",f.scroll_e)},start:function(e,t,i){"touchstart"===e.type&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e.target=l.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset)),f.is_drag&&g.vakata.dnd.stop({});try{e.currentTarget.unselectable="on",e.currentTarget.onselectstart=function(){return!1},e.currentTarget.style&&(e.currentTarget.style.touchAction="none",e.currentTarget.style.msTouchAction="none",e.currentTarget.style.MozUserSelect="none")}catch(e){}return f.init_x=e.pageX,f.init_y=e.pageY,f.data=t,f.is_down=!0,f.element=e.currentTarget,f.target=e.target,f.is_touch="touchstart"===e.type,!1!==i&&(f.helper=g("<div id='vakata-dnd'></div>").html(i).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),g(l).on("mousemove.vakata.jstree touchmove.vakata.jstree",g.vakata.dnd.drag),g(l).on("mouseup.vakata.jstree touchend.vakata.jstree",g.vakata.dnd.stop),!1},drag:function(e){if("touchmove"===e.type&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e.target=l.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset)),f.is_down){if(!f.is_drag){if(!(Math.abs(e.pageX-f.init_x)>(f.is_touch?g.vakata.dnd.settings.threshold_touch:g.vakata.dnd.settings.threshold)||Math.abs(e.pageY-f.init_y)>(f.is_touch?g.vakata.dnd.settings.threshold_touch:g.vakata.dnd.settings.threshold)))return;f.helper&&(f.helper.appendTo(l.body),f.helper_w=f.helper.outerWidth()),f.is_drag=!0,g(f.target).one("click.vakata",!1),g.vakata.dnd._trigger("start",e)}var t=!1,i=!1,a=!1,s=!1,n=!1,r=!1,o=!1,d=!1,c=!1,m=!1;return f.scroll_t=0,f.scroll_l=0,f.scroll_e=!1,g(g(e.target).parentsUntil("body").addBack().get().reverse()).filter((function(){return this.ownerDocument&&/^auto|scroll$/.test(g(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)})).each((function(){var t=g(this),i=t.offset();if(this.scrollHeight>this.offsetHeight&&(i.top+t.height()-e.pageY<g.vakata.dnd.settings.scroll_proximity&&(f.scroll_t=1),e.pageY-i.top<g.vakata.dnd.settings.scroll_proximity&&(f.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(i.left+t.width()-e.pageX<g.vakata.dnd.settings.scroll_proximity&&(f.scroll_l=1),e.pageX-i.left<g.vakata.dnd.settings.scroll_proximity&&(f.scroll_l=-1)),f.scroll_t||f.scroll_l)return f.scroll_e=g(this),!1})),f.scroll_e||(t=g(l),i=g(window),a=t.height(),s=i.height(),n=t.width(),r=i.width(),o=t.scrollTop(),d=t.scrollLeft(),s<a&&e.pageY-o<g.vakata.dnd.settings.scroll_proximity&&(f.scroll_t=-1),s<a&&s-(e.pageY-o)<g.vakata.dnd.settings.scroll_proximity&&(f.scroll_t=1),r<n&&e.pageX-d<g.vakata.dnd.settings.scroll_proximity&&(f.scroll_l=-1),r<n&&r-(e.pageX-d)<g.vakata.dnd.settings.scroll_proximity&&(f.scroll_l=1),(f.scroll_t||f.scroll_l)&&(f.scroll_e=t)),f.scroll_e&&g.vakata.dnd._scroll(!0),f.helper&&(c=parseInt(e.pageY+g.vakata.dnd.settings.helper_top,10),m=parseInt(e.pageX+g.vakata.dnd.settings.helper_left,10),n&&m+f.helper_w>n&&(m=n-(f.helper_w+2)),f.helper.css({left:m+"px",top:(c=a&&a<c+25?a-50:c)+"px"})),g.vakata.dnd._trigger("move",e),!1}},stop:function(e){var t;return"touchend"===e.type&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e.target=l.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset)),f.is_drag?(e.target!==f.target&&g(f.target).off("click.vakata"),g.vakata.dnd._trigger("stop",e)):"touchend"===e.type&&e.target===f.target&&(t=setTimeout((function(){g(e.target).trigger("click")}),100),g(e.target).one("click",(function(){t&&clearTimeout(t)}))),g.vakata.dnd._clean(),!1}},e.jstree.defaults.massload=null,e.jstree.plugins.massload=function(t,i){this.init=function(e,t){this._data.massload={},i.init.call(this,e,t)},this._load_nodes=function(t,a,s,n){var r,o,l,d=this.settings.massload,c=[],m=this._model.data;if(!s){for(r=0,o=t.length;r<o;r++)m[t[r]]&&(m[t[r]].state.loaded||m[t[r]].state.failed)&&!n||(c.push(t[r]),(l=this.get_node(t[r],!0))&&l.length&&l.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},c.length){if(e.vakata.is_function(d))return d.call(this,c,function(e){var r,o;if(e)for(r in e)e.hasOwnProperty(r)&&(this._data.massload[r]=e[r]);for(r=0,o=t.length;r<o;r++)(l=this.get_node(t[r],!0))&&l.length&&l.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,a,s,n)}.bind(this));if("object"==typeof d&&d&&d.url)return d=e.extend(!0,{},d),e.vakata.is_function(d.url)&&(d.url=d.url.call(this,c)),e.vakata.is_function(d.data)&&(d.data=d.data.call(this,c)),e.ajax(d).done(function(e,r,o){var d,c;if(e)for(d in e)e.hasOwnProperty(d)&&(this._data.massload[d]=e[d]);for(d=0,c=t.length;d<c;d++)(l=this.get_node(t[d],!0))&&l.length&&l.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,a,s,n)}.bind(this)).fail(function(e){i._load_nodes.call(this,t,a,s,n)}.bind(this))}}return i._load_nodes.call(this,t,a,s,n)},this._load_node=function(t,a){var s,n=null;return(s=this._data.massload[t.id])?(n=this["string"==typeof s?"_append_html_data":"_append_json_data"](t,"string"==typeof s?e(e.parseHTML(s)).filter((function(){return 3!==this.nodeType})):s,(function(e){a.call(this,e)})),(s=this.get_node(t.id,!0))&&s.length&&s.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[t.id],n):i._load_node.call(this,t,a)}},e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(i,a){this.bind=function(){a.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",function(t,i){if(this._data.search.som&&i.res.length){for(var a,s,n=this._model.data,r=[],o=0,l=i.res.length;o<l;o++)if(n[i.res[o]]&&!n[i.res[o]].state.hidden&&(r.push(i.res[o]),r=r.concat(n[i.res[o]].parents),this._data.search.smc))for(a=0,s=n[i.res[o]].children_d.length;a<s;a++)n[n[i.res[o]].children_d[a]]&&!n[n[i.res[o]].children_d[a]].state.hidden&&r.push(n[i.res[o]].children_d[a]);r=e.vakata.array_remove_item(e.vakata.array_unique(r),e.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(r,!0),this.redraw(!0)}}.bind(this)).on("clear_search.jstree",function(e,t){this._data.search.som&&t.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))}.bind(this))},this.search=function(i,a,s,n,r,o){if(!1===i||""===e.vakata.trim(i.toString()))return this.clear_search();n=(n=this.get_node(n))&&(n.id||0===n.id)?n.id:null,i=i.toString();var l,d,c=this.settings.search,m=c.ajax||!1,_=this._model.data,h=null,p=[],u=[];if(this._data.search.res.length&&!r&&this.clear_search(),s===t&&(s=c.show_only_matches),o===t&&(o=c.show_only_matches_children),!a&&!1!==m)return e.vakata.is_function(m)?m.call(this,i,function(t){t&&t.d&&(t=t.d),this._load_nodes(e.vakata.is_array(t)?e.vakata.array_unique(t):[],(function(){this.search(i,!0,s,n,r,o)}))}.bind(this),n):((m=e.extend({},m)).data||(m.data={}),m.data.str=i,n&&(m.data.inside=n),this._data.search.lastRequest&&this._data.search.lastRequest.abort(),this._data.search.lastRequest=e.ajax(m).fail(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(m)},this.settings.core.error.call(this,this._data.core.last_error)}.bind(this)).done(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.vakata.is_array(t)?e.vakata.array_unique(t):[],(function(){this.search(i,!0,s,n,r,o)}))}.bind(this)),this._data.search.lastRequest);if(r||(this._data.search.str=i,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=s,this._data.search.smc=o),h=new e.vakata.search(i,!0,{caseSensitive:c.case_sensitive,fuzzy:c.fuzzy}),e.each(_[n||e.jstree.root].children_d,(function(e,t){var a=_[t];a.text&&!a.state.hidden&&(!c.search_leaves_only||a.state.loaded&&0===a.children.length)&&(c.search_callback&&c.search_callback.call(this,i,a)||!c.search_callback&&h.search(a.text).isMatch)&&(p.push(t),u=u.concat(a.parents))})),p.length){for(l=0,d=(u=e.vakata.array_unique(u)).length;l<d;l++)u[l]!==e.jstree.root&&_[u[l]]&&!0===this.open_node(u[l],null,0)&&this._data.search.opn.push(u[l]);r?(this._data.search.dom=this._data.search.dom.add(e(this.element[0].querySelectorAll("#"+e.map(p,(function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")})).join(", #")))),this._data.search.res=e.vakata.array_unique(this._data.search.res.concat(p))):(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(p,(function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")})).join(", #"))),this._data.search.res=p),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:i,res:this._data.search.res,show_only_matches:s})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(this._data.search.res,(function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")})).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this.redraw_node=function(t,i,s,n){if((t=a.redraw_node.apply(this,arguments))&&-1!==e.inArray(t.id,this._data.search.res)){for(var r=null,o=0,l=t.childNodes.length;o<l;o++)if(t.childNodes[o]&&t.childNodes[o].className&&-1!==t.childNodes[o].className.indexOf("jstree-anchor")){r=t.childNodes[o];break}r&&(r.className+=" jstree-search")}return t}},(v=e).vakata.search=function(e,t,i){i=i||{},!1!==(i=v.extend({},v.vakata.search.defaults,i)).fuzzy&&(i.fuzzy=!0),e=i.caseSensitive?e:e.toLowerCase();var a,s,n,r,o=i.location,l=i.distance,d=i.threshold,c=e.length;return 32<c&&(i.fuzzy=!1),i.fuzzy&&(a=1<<c-1,s=function(){var t={},i=0;for(i=0;i<c;i++)t[e.charAt(i)]=0;for(i=0;i<c;i++)t[e.charAt(i)]|=1<<c-i-1;return t}(),n=function(e,t){e/=c,t=Math.abs(o-t);return l?e+t/l:t?1:e}),r=function(t){if(t=i.caseSensitive?t.toString():t.toString().toLowerCase(),e===t||-1!==t.indexOf(e))return{isMatch:!0,score:0};if(!i.fuzzy)return{isMatch:!1,score:1};var r,l,m,_,h,p,u,g,f,v=t.length,b=d,y=t.indexOf(e,o),k=c+v,w=1,j=[];for(-1!==y&&(b=Math.min(n(0,y),b),-1!==(y=t.lastIndexOf(e,o+c))&&(b=Math.min(n(0,y),b))),y=-1,r=0;r<c;r++){for(m=0,_=k;m<_;)n(r,o+_)<=b?m=_:k=_,_=Math.floor((k-m)/2+m);for(k=_,p=Math.max(1,o-_+1),u=Math.min(o+_,v)+c,(g=new Array(u+2))[u+1]=(1<<r)-1,l=u;p<=l;l--)if(f=s[t.charAt(l-1)],g[l]=0===r?(g[l+1]<<1|1)&f:(g[l+1]<<1|1)&f|(h[l+1]|h[l])<<1|1|h[l+1],g[l]&a&&(w=n(r,l-1))<=b){if(b=w,j.push(y=l-1),!(o<y))break;p=Math.max(1,2*o-y)}if(n(r+1,o)>b)break;h=g}return{isMatch:0<=y,score:w}},!0===t?{search:r}:r(t)},v.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1},e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1};var y=!(e.jstree.plugins.sort=function(e,t){this.bind=function(){t.bind.call(this),this.element.on("model.jstree",function(e,t){this.sort(t.parent,!0)}.bind(this)).on("rename_node.jstree create_node.jstree",function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)}.bind(this)).on("move_node.jstree copy_node.jstree",function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)}.bind(this))},this.sort=function(e,t){var i,a;if((e=this.get_node(e))&&e.children&&e.children.length&&(e.children.sort(this.settings.sort.bind(this)),t))for(i=0,a=e.children_d.length;i<a;i++)this.sort(e.children_d[i],!1)}});e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1,preserve_loaded:!1},e.jstree.plugins.state=function(t,i){this.bind=function(){i.bind.call(this);var e=function(){this.element.on(this.settings.state.events,function(){y&&clearTimeout(y),y=setTimeout(function(){this.save_state()}.bind(this),100)}.bind(this)),this.trigger("state_ready")}.bind(this);this.element.on("ready.jstree",function(t,i){this.element.one("restore_state.jstree",e),this.restore_state()||e()}.bind(this))},this.save_state=function(){var t=this.get_state();this.settings.state.preserve_loaded||delete t.core.loaded;t={state:t,ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(e){return!1}return!(t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl||!(t=(t=t&&t.state?t.state:t)&&e.vakata.is_function(this.settings.state.filter)?this.settings.state.filter.call(this,t):t)||(this.settings.state.preserve_loaded||delete t.core.loaded,this.element.one("set_state.jstree",(function(i,a){a.instance.trigger("restore_state",{state:e.extend(!0,{},t)})})),this.set_state(t),0))},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}},e.jstree.defaults.types={default:{}},e.jstree.defaults.types[e.jstree.root]={},e.jstree.plugins.types=function(i,a){this.init=function(i,s){var n,r;if(s&&s.types&&s.types.default)for(n in s.types)if("default"!==n&&n!==e.jstree.root&&s.types.hasOwnProperty(n))for(r in s.types.default)s.types.default.hasOwnProperty(r)&&s.types[n][r]===t&&(s.types[n][r]=s.types.default[r]);a.init.call(this,i,s),this._model.data[e.jstree.root].type=e.jstree.root},this.refresh=function(t,i){a.refresh.call(this,t,i),this._model.data[e.jstree.root].type=e.jstree.root},this.bind=function(){this.element.on("model.jstree",function(i,a){for(var s,n=this._model.data,r=a.nodes,o=this.settings.types,l="default",d=0,c=r.length;d<c;d++){if(l="default",n[r[d]].original&&n[r[d]].original.type&&o[n[r[d]].original.type]&&(l=n[r[d]].original.type),n[r[d]].data&&n[r[d]].data.jstree&&n[r[d]].data.jstree.type&&o[n[r[d]].data.jstree.type]&&(l=n[r[d]].data.jstree.type),n[r[d]].type=l,!0===n[r[d]].icon&&o[l].icon!==t&&(n[r[d]].icon=o[l].icon),o[l].li_attr!==t&&"object"==typeof o[l].li_attr)for(s in o[l].li_attr)o[l].li_attr.hasOwnProperty(s)&&"id"!==s&&(n[r[d]].li_attr[s]===t?n[r[d]].li_attr[s]=o[l].li_attr[s]:"class"===s&&(n[r[d]].li_attr.class=o[l].li_attr.class+" "+n[r[d]].li_attr.class));if(o[l].a_attr!==t&&"object"==typeof o[l].a_attr)for(s in o[l].a_attr)o[l].a_attr.hasOwnProperty(s)&&"id"!==s&&(n[r[d]].a_attr[s]===t?n[r[d]].a_attr[s]=o[l].a_attr[s]:"href"===s&&"#"===n[r[d]].a_attr[s]?n[r[d]].a_attr.href=o[l].a_attr.href:"class"===s&&(n[r[d]].a_attr.class=o[l].a_attr.class+" "+n[r[d]].a_attr.class))}n[e.jstree.root].type=e.jstree.root}.bind(this)),a.bind.call(this)},this.get_json=function(t,i,s){var n,r,o=this._model.data,l=i?e.extend(!0,{},i,{no_id:!1}):{},d=a.get_json.call(this,t,l,s);if(!1===d)return!1;if(e.vakata.is_array(d))for(n=0,r=d.length;n<r;n++)d[n].type=(d[n].id||0===d[n].id)&&o[d[n].id]&&o[d[n].id].type?o[d[n].id].type:"default",i&&i.no_id&&(delete d[n].id,d[n].li_attr&&d[n].li_attr.id&&delete d[n].li_attr.id,d[n].a_attr&&d[n].a_attr.id&&delete d[n].a_attr.id);else d.type=(d.id||0===d.id)&&o[d.id]&&o[d.id].type?o[d.id].type:"default",i&&i.no_id&&(d=this._delete_ids(d));return d},this._delete_ids=function(t){if(e.vakata.is_array(t)){for(var i=0,a=t.length;i<a;i++)t[i]=this._delete_ids(t[i]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.a_attr&&t.a_attr.id&&delete t.a_attr.id,t.children&&e.vakata.is_array(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(i,s,n,r,o){if(!1===a.check.call(this,i,s,n,r,o))return!1;s=s&&(s.id||0===s.id)?s:this.get_node(s),n=n&&(n.id||0===n.id)?n:this.get_node(n);var l,d,c,m,_=(_=s&&(s.id||0===s.id)?o&&o.origin?o.origin:e.jstree.reference(s.id):null)&&_._model&&_._model.data?_._model.data:null;switch(i){case"create_node":case"move_node":case"copy_node":if("move_node"!==i||-1===e.inArray(s.id,n.children)){if((l=this.get_rules(n)).max_children!==t&&-1!==l.max_children&&l.max_children===n.children.length)return!(this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+i,data:JSON.stringify({chk:i,pos:r,obj:!(!s||!s.id&&0!==s.id)&&s.id,par:!(!n||!n.id&&0!==n.id)&&n.id})});if(l.valid_children!==t&&-1!==l.valid_children&&-1===e.inArray(s.type||"default",l.valid_children))return!(this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+i,data:JSON.stringify({chk:i,pos:r,obj:!(!s||!s.id&&0!==s.id)&&s.id,par:!(!n||!n.id&&0!==n.id)&&n.id})});if(_&&s.children_d&&s.parents){for(c=d=0,m=s.children_d.length;c<m;c++)d=Math.max(d,_[s.children_d[c]].parents.length);d=d-s.parents.length+1}(d<=0||d===t)&&(d=1);do{if(l.max_depth!==t&&-1!==l.max_depth&&l.max_depth<d)return!(this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+i,data:JSON.stringify({chk:i,pos:r,obj:!(!s||!s.id&&0!==s.id)&&s.id,par:!(!n||!n.id&&0!==n.id)&&n.id})});n=this.get_node(n.parent),l=this.get_rules(n),d++}while(n)}}return!0},this.get_rules=function(e){return!!(e=this.get_node(e))&&((e=this.get_type(e,!0)).max_depth===t&&(e.max_depth=-1),e.max_children===t&&(e.max_children=-1),e.valid_children===t&&(e.valid_children=-1),e)},this.get_type=function(t,i){return!!(t=this.get_node(t))&&(i?e.extend({type:t.type},this.settings.types[t.type]):t.type)},this.set_type=function(i,a){var s,n,r,o,l,d,c,m,_=this._model.data;if(e.vakata.is_array(i)){for(n=0,r=(i=i.slice()).length;n<r;n++)this.set_type(i[n],a);return!0}if(s=this.settings.types,i=this.get_node(i),!s[a]||!i)return!1;if((c=this.get_node(i,!0))&&c.length&&(m=c.children(".jstree-anchor")),o=i.type,l=this.get_icon(i),i.type=a,!0!==l&&s[o]&&(s[o].icon===t||l!==s[o].icon)||this.set_icon(i,s[a].icon===t||s[a].icon),s[o]&&s[o].li_attr!==t&&"object"==typeof s[o].li_attr)for(d in s[o].li_attr)s[o].li_attr.hasOwnProperty(d)&&"id"!==d&&("class"===d?(_[i.id].li_attr.class=(_[i.id].li_attr.class||"").replace(s[o].li_attr[d],""),c&&c.removeClass(s[o].li_attr[d])):_[i.id].li_attr[d]===s[o].li_attr[d]&&(_[i.id].li_attr[d]=null,c&&c.removeAttr(d)));if(s[o]&&s[o].a_attr!==t&&"object"==typeof s[o].a_attr)for(d in s[o].a_attr)s[o].a_attr.hasOwnProperty(d)&&"id"!==d&&("class"===d?(_[i.id].a_attr.class=(_[i.id].a_attr.class||"").replace(s[o].a_attr[d],""),m&&m.removeClass(s[o].a_attr[d])):_[i.id].a_attr[d]===s[o].a_attr[d]&&("href"===d?(_[i.id].a_attr[d]="#",m&&m.attr("href","#")):(delete _[i.id].a_attr[d],m&&m.removeAttr(d))));if(s[a].li_attr!==t&&"object"==typeof s[a].li_attr)for(d in s[a].li_attr)s[a].li_attr.hasOwnProperty(d)&&"id"!==d&&(_[i.id].li_attr[d]===t?(_[i.id].li_attr[d]=s[a].li_attr[d],c&&("class"===d?c.addClass(s[a].li_attr[d]):c.attr(d,s[a].li_attr[d]))):"class"===d&&(_[i.id].li_attr.class=s[a].li_attr[d]+" "+_[i.id].li_attr.class,c&&c.addClass(s[a].li_attr[d])));if(s[a].a_attr!==t&&"object"==typeof s[a].a_attr)for(d in s[a].a_attr)s[a].a_attr.hasOwnProperty(d)&&"id"!==d&&(_[i.id].a_attr[d]===t?(_[i.id].a_attr[d]=s[a].a_attr[d],m&&("class"===d?m.addClass(s[a].a_attr[d]):m.attr(d,s[a].a_attr[d]))):"href"===d&&"#"===_[i.id].a_attr[d]?(_[i.id].a_attr.href=s[a].a_attr.href,m&&m.attr("href",s[a].a_attr.href)):"class"===d&&(_[i.id].a_attr.class=s[a].a_attr.class+" "+_[i.id].a_attr.class,m&&m.addClass(s[a].a_attr[d])));return!0}},e.jstree.defaults.unique={case_sensitive:!1,trim_whitespace:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(i,a){this.check=function(t,i,s,n,r){if(!1===a.check.call(this,t,i,s,n,r))return!1;if(i=i&&(i.id||0===i.id)?i:this.get_node(i),!(s=s&&(s.id||0===s.id)?s:this.get_node(s))||!s.children)return!0;for(var o,l="rename_node"===t?n:i.text,d=[],c=this.settings.unique.case_sensitive,m=this.settings.unique.trim_whitespace,_=this._model.data,h=0,p=s.children.length;h<p;h++)o=_[s.children[h]].text,c||(o=o.toLowerCase()),m&&(o=o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),d.push(o);switch(c||(l=l.toLowerCase()),m&&(l=l.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),t){case"delete_node":return!0;case"rename_node":return o=i.text||"",c||(o=o.toLowerCase()),m&&(o=o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),(h=-1===e.inArray(l,d)||i.text&&o===l)||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id&&0!==i.id)&&i.id,par:!(!s||!s.id&&0!==s.id)&&s.id})}),h;case"create_node":return(h=-1===e.inArray(l,d))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id&&0!==i.id)&&i.id,par:!(!s||!s.id&&0!==s.id)&&s.id})}),h;case"copy_node":return(h=-1===e.inArray(l,d))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id&&0!==i.id)&&i.id,par:!(!s||!s.id&&0!==s.id)&&s.id})}),h;case"move_node":return(h=i.parent===s.id&&(!r||!r.is_multi)||-1===e.inArray(l,d))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id&&0!==i.id)&&i.id,par:!(!s||!s.id&&0!==s.id)&&s.id})}),h}return!0},this.create_node=function(i,s,n,r,o){if(!s||"object"==typeof s&&s.text===t){if(null===i&&(i=e.jstree.root),!(i=this.get_node(i)))return a.create_node.call(this,i,s,n,r,o);if(!(n=n===t?"last":n).toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return a.create_node.call(this,i,s,n,r,o);s=s||{};for(var l,d,c=this._model.data,m=this.settings.unique.case_sensitive,_=this.settings.unique.trim_whitespace,h=this.settings.unique.duplicate,p=l=this.get_string("New node"),u=[],g=0,f=i.children.length;g<f;g++)d=c[i.children[g]].text,m||(d=d.toLowerCase()),_&&(d=d.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),u.push(d);for(g=1,d=p,m||(d=d.toLowerCase()),_&&(d=d.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));-1!==e.inArray(d,u);)d=p=h.call(this,l,++g).toString(),m||(d=d.toLowerCase()),_&&(d=d.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));s.text=p}return a.create_node.call(this,i,s,n,r,o)}};var k=l.createElement("DIV");if(k.setAttribute("unselectable","on"),k.setAttribute("role","presentation"),k.className="jstree-wholerow",k.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("ready.jstree set_state.jstree",function(){this.hide_dots()}.bind(this)).on("init.jstree loading.jstree ready.jstree",function(){this.get_container_ul().addClass("jstree-wholerow-ul")}.bind(this)).on("deselect_all.jstree",function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")}.bind(this)).on("changed.jstree",function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");for(var i=!1,a=0,s=t.selected.length;a<s;a++)(i=this.get_node(t.selected[a],!0))&&i.length&&i.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}.bind(this)).on("open_node.jstree",function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}.bind(this)).on("hover_node.jstree dehover_node.jstree",function(e,t){"hover_node"===e.type&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")}.bind(this)).on("contextmenu.jstree",".jstree-wholerow",function(t){var i;this._data.contextmenu&&(t.preventDefault(),i=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY}),e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i))}.bind(this)).on("click.jstree",".jstree-wholerow",(function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).trigger("focus")})).on("dblclick.jstree",".jstree-wholerow",(function(t){t.stopImmediatePropagation();var i=e.Event("dblclick",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).trigger("focus")})).on("click.jstree",".jstree-leaf > .jstree-ocl",function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).trigger("focus")}.bind(this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1}.bind(this)).on("mouseleave.jstree",".jstree-node",function(e){this.dehover_node(e.currentTarget)}.bind(this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),i.teardown.call(this)},this.redraw_node=function(t,a,s,n){var r;return(t=i.redraw_node.apply(this,arguments))&&(r=k.cloneNode(!0),-1!==e.inArray(t.id,this._data.core.selected)&&(r.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===t.id&&(r.className+=" jstree-wholerow-hovered"),t.insertBefore(r,t.childNodes[0])),t}},window.customElements&&Object&&Object.create){(o=Object.create(HTMLElement.prototype)).createdCallback=function(){var t,i={core:{},plugins:[]};for(t in e.jstree.plugins)e.jstree.plugins.hasOwnProperty(t)&&this.attributes[t]&&(i.plugins.push(t),this.getAttribute(t)&&JSON.parse(this.getAttribute(t))&&(i[t]=JSON.parse(this.getAttribute(t))));for(t in e.jstree.defaults.core)e.jstree.defaults.core.hasOwnProperty(t)&&this.attributes[t]&&(i.core[t]=JSON.parse(this.getAttribute(t))||this.getAttribute(t));e(this).jstree(i)};try{window.customElements.define("vakata-jstree",(function(){}),{prototype:o})}catch(o){}}}}));var formData={},currentStepForm="",configFormPath="";$((function(){var $body=$("body");function saveSite(e,t,i){$.ajax({type:"POST",url:"/melis/MelisCms/Sites/saveSite?siteId="+t,data:e,dataType:"json",encode:!0,beforeSend:function(){melisCoreTool.pending("#btn-save-meliscms-tool-sites")}}).done((function(e){if(1===e.success){melisHelper.melisOkNotification(e.textTitle,e.textMessage,"#72af46"),melisCore.flashMessenger(),melisCoreTool.done("#btn-save-meliscms-tool-sites"),melisHelper.zoneReload(t+"_id_meliscms_tool_sites_edit_site","meliscms_tool_sites_edit_site",{siteId:t,moduleName:i,cpath:"meliscms_tool_sites_edit_site"}),$("#tableToolSites").DataTable().ajax.reload(),$("input[name=left_tree_search]").val(""),$.ui.fancytree.getTree("#id-mod-menu-dynatree").reload()}else{var a=t+"_id_meliscms_tool_sites_edit_site",s=prepareErrs(e.errors,a);highlightErrs(e.success,e.errors,a),melisHelper.melisKoNotification(e.textTitle,e.textMessage,s),melisCoreTool.done("#btn-save-meliscms-tool-sites")}melisCore.flashMessenger(),melisCoreTool.done("#btn-save-meliscms-tool-sites"),cmsSiteHelper.siteSaveCallback()})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))}function arrayDiff(e,t){var i=[];if(null!=e&&e.length>0){for(var a=0;a<e.length;a++)t[a]!==e[a]&&i.push(e[a]);if(i.length<1)for(a=0;a<t.length;a++)t[a]!==e[a]&&i.push(e[a])}return i}function highlightErrs(e,t,i){0===e||!1===e?($("#"+i+" .form-group label").css("color","#686868"),$.each(t,(function(e,t){$("#"+i+" .form-control[name='"+e+"']").parents(".form-group").children("label").css("color","red")}))):$("#"+i+" .form-group label").css("color","#686868")}function prepareErrs(e,t){var i={};return $.each(e,(function(e,a){var s=$("#"+t+" #"+e),n=s.data("lang"),r=s.siblings("label").text(),o=r.substring(r.length-1),l=e.split("_");null!=n?(r=s.closest("div").siblings("label").text().slice(0,-1),i[n+" "+r]=a):""===r?(r=s.closest("div").siblings("label").text().slice(0,-2),i[r]=a):("*"===o&&(r=s.siblings("label").text().slice(0,-2)),"sdom"===l[1]&&(r="*"===o?s.siblings("label").text().slice(0,-2)+"("+l[0]+")":s.siblings("label").text()+"("+l[0]+")"),i[r]=a)})),i}$body.on("click","#btn-save-meliscms-tool-sites",(function(){var e=activeTabId.split("_")[0],t=$("#"+e+"_id_meliscms_tool_sites_edit_site form").serializeArray(),i=[];$.each(t,(function(e,t){str1=t.name,str2="moduleLoad",-1!=str1.indexOf(str2)&&i.push(str1.replace("moduleLoad",""))}));var a=$("#"+e+"_currentEnabledModule").val(),s=$("#"+e+"_sitesUsingModules").val();a=JSON.parse(a),s=JSON.parse(s);var n="";$.each(s,(function(e,t){n+="<br>- "+t}));var r=arrayDiff(a,i),o=$("#"+e+"_siteModuleName").val(),l=$("#not-admin-notice").length<1;r.length>0&&l?melisCoreTool.confirm(translations.tr_meliscms_common_save,translations.tr_meliscms_tool_sites_cancel,translations.tr_meliscms_tool_site_module_load_update_title,translations.tr_meliscms_tool_site_module_load_update_confirm.replace(/%s/g,n),(function(){saveSite(t=$.param(t),e,o)})):saveSite(t=$.param(t),e,o)})),$body.on("click",".btnEditSites",(function(){var e=$(this),t=e.closest("tr").attr("id"),i=e.closest("tr").find("td:nth-child(3)").text(),a=e.closest("tr").find("td:nth-child(5)").text(),s=e.closest("tr").find("td:nth-child(4)").text();openSiteEditTab(updateSiteTitle(e.closest("tr").attr("id"),i,s,a),t,s)}));var selectedLanguages="",domainType="",createFile=!0,newSite=!0,owlStep=null,siteName="",siteLabel="",selectedDomainValue=[],isUserSelectModuleOption=!1,domainSingleOpt="";$body.on("click","#tableToolSites .btnDeleteSite",(function(e){var t=$(this).parents("tr").attr("id");melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscms_tool_site_delete_confirm_title,translations.tr_meliscms_tool_site_delete_confirm,(function(){$.ajax({type:"POST",url:"/melis/MelisCms/Sites/deleteSite",data:{siteId:t},dataType:"json",encode:!0}).done((function(e){melisCoreTool.pending(".btnDeleteSite"),e.success?(melisHelper.tabClose(t+"_id_meliscms_tool_sites_edit_site"),melisHelper.melisOkNotification(e.textTitle,e.textMessage),$("#tableToolSites").DataTable().ajax.reload()):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,0),melisCore.flashMessenger(),melisCoreTool.done(".btnDeleteSite")})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))}))}));var modalUrl="/melis/MelisCms/Sites/renderToolSitesModalContainer";function executeFunction(functionToCall){null!=functionToCall&&""!=functionToCall&&eval(functionToCall+"()")}function multiLingualProcess(){cmsSiteHelper.setCurrentStepForm("skip"),hideElement(".step2-forms .sites_step2-multi-language"),hideElement(".step2-forms .sites_step2-single-language")}function languagesProcess(){var e=$("#is_multi_language").bootstrapSwitch("status"),t={};t.isMultiLang=!!e,t.data=getSerializedForm("#step2form-is_multi_lingual"),cmsSiteHelper.setSitesStepData(t,"multiLang"),e?(showElement(".step2-forms .sites_step2-multi-language"),hideElement(".step2-forms .sites_step2-single-language"),cmsSiteHelper.setCurrentStepForm("#step2form-multi_language")):(showElement(".step2-forms .sites_step2-single-language"),hideElement(".step2-forms .sites_step2-multi-language"),cmsSiteHelper.setCurrentStepForm("#step2form-single_language")),hideElement(".sites_step3-single-domain"),hideElement(".sites_step3-multi-domain"),domainSingleOpt=""}function domainsProcess(){var e=$("#is_multi_language").bootstrapSwitch("status"),t="";selectedLanguages="";var i={},a={};if(e){var s=getSerializedForm("#step2form-multi_language");i=processSiteLanguage(s,t);var n=$(".sites_step3-multi-domain #multi-domains_container"),r=$("<div/>",{class:"form-group"});n.empty(),$.each(s,(function(){if("site_selected_lang"==this.name){var e=this.value.split("-");t=""==t?e[2]:t+" / "+e[2];var i=$("<label/>").html(e[2]+"<sup>*</sup>").addClass("err_site-domain-"+this.value);r.append(i);var s="site-domain-"+this.value,o=$("<input/>",{type:"text",class:"form-control",name:s,value:applyDomainValue(s),required:"required",title:""}).attr("data-langId",e[0]);r.append(o),n.append(r)}else"sites_url_setting"==this.name&&(2==this.value?(showElement(".sites_step3-multi-domain"),hideElement(".sites_step3-single-domain"),a.isMultiDomain=!0,cmsSiteHelper.setCurrentStepForm("#step3form-multi_domain"),domainSingleOpt=""):(showElement(".sites_step3-single-domain"),hideElement(".sites_step3-multi-domain"),a.isMultiDomain=!1,cmsSiteHelper.setCurrentStepForm("#step3form-single_domain"),1==this.value?domainSingleOpt=" ("+translations.tr_melis_cms_sites_tool_add_step5_single_dom_opt_1_msg+")":3==this.value&&(domainSingleOpt=" ("+translations.tr_melis_cms_sites_tool_add_step5_single_dom_opt_3_msg+")")))}))}else{cmsSiteHelper.setCurrentStepForm("#step3form-single_domain"),showElement(".sites_step3-single-domain"),hideElement(".sites_step3-multi-domain"),a.isMultiDomain=!1,i=processSiteLanguage(getSerializedForm("#step2form-single_language"),t),t=i.langDetails}cmsSiteHelper.setSitesStepData(i.data,"languages"),cmsSiteHelper.setSitesStepData(a,"domains"),selectedLanguages="- "+translations.tr_melis_cms_sites_tool_add_header_title_lang+" : "+t,hideElement(".step-4-datas")}function modulesProcess(){showElement(".step-4-datas"),cmsSiteHelper.setCurrentStepForm("#step4form_module");var e="",t={};formData.domains.isMultiDomain?(t=getSerializedForm("#step3form-multi_domain"),e="Multiple"):(t=getSerializedForm("#step3form-single_domain"),e="Single"+domainSingleOpt),domainType="- "+translations.tr_melis_cms_sites_tool_add_header_title_domains+" : "+e,cmsSiteHelper.setSitesStepData(processSiteDomain(t),"domains.data"),showElement("#btn-next-step"),hideElement("#btn-finish-step")}function summaryProcess(){var e={};e.data=processSiteModule(),e.newSite=newSite,e.createFile=createFile,cmsSiteHelper.setSitesStepData(e,"module"),showElement("#btn-finish-step"),hideElement("#btn-next-step");var t=translations.tr_melis_cms_sites_tool_add_step5_new_site_using_existing_module;newSite&&(t=translations.tr_melis_cms_sites_tool_add_step5_new_site_using_new_module);var i=t.replace(/%siteModule/g,siteName).replace(/%siteName/g,siteLabel),a=selectedLanguages+"<br />"+domainType+"<br/><p class='step5-message'>"+i+"</p>";cmsSiteHelper.setSummaryStepText(a,"append",!0)}function processSiteLanguage(e,t){var i={},a={};return $.each(e,(function(e,s){if("site_selected_lang"==this.name){var n=this.value.split("-");t=n[2],i[n[1]]=n[0]}else i[s.name]=s.value;a.data=i,a.langDetails=t})),a}function processSiteDomain(e){var t={};return selectedDomainValue=[],$.each(e,(function(e,i){if(selectedDomainValue.push(i),i.name.indexOf("site-domain")>=0){var a=i.name.split("-")[3];t[a]={sdom_domain:i.value}}else t[i.name]=i.value})),t}function processSiteModule(){var e=getSerializedForm("#step4form_module");return $.each(e,(function(t,i){"create_sites_file"==i.name?(newSite&&(createFile="yes"==i.value),delete e[t]):"siteSelectModuleName"==i.name?(delete e[t],newSite||(e.push({site_name:i.value}),siteName=i.value)):"siteCreateModuleName"==i.name?(delete e[t],newSite&&(e.push({site_name:i.value}),siteName=i.value)):"site_label"==i.name&&(siteLabel=i.value)})),e}function applyDomainValue(e){var t="";return $.each(selectedDomainValue,(function(i,a){if(a.name==e)return t=a.value})),t}function isFormEmpty(e,t){if(""!=configFormPath)return e.push({name:"form_config_path",value:configFormPath}),$.ajax({type:"POST",url:"/melis/MelisCms/Sites/validateSiteCreationForm",data:e,beforeSend:function(){melisCoreTool.pending("#btn-next-step"),$("#siteAddAlert").empty().addClass("hidden")}}).done((function(e){return $("#siteAddAlert").text(translations.tr_melis_cms_sites_tool_add_create_site_required_field),melisCoreTool.done("#btn-next-step"),e.success?(owlStep.trigger("owl.next"),!1):(melisHelper.highlightMultiErrors(e.success,e.errors,t),$("#siteAddAlert").removeClass("hidden"),$.each(e.errors,(function(e,t){$.each(t,(function(e,i){"label"!==e&&$("#siteAddAlert").append("<br/><span>"+t.label+": <small>"+i+"</small></span>")}))})),!0)})).fail((function(){return melisCoreTool.done("#btn-next-step"),alert(translations.tr_meliscore_error_message),!1})),!0;var i=[];return $.each(e,(function(e,t){""!=t.value&&i.push(t.name)})),showFormError(t,i)}function showFormError(e,t){var i="",a="",s="",n="",r={},o=0,l=$(e+" input, "+e+" select"),d={},c=[],m=[];if($("#siteAddAlert").text(translations.tr_melis_cms_sites_tool_add_create_site_required_field).addClass("hidden"),"#step4form_module"==e&&!isUserSelectModuleOption)return $("#siteAddAlert").text(translations.tr_melis_cms_sites_tool_add_step4_select_module_option_err).removeClass("hidden"),!0;if(l.each((function(){if($(this).prop("required")){var e=$(this).attr("name"),l=($(this).attr("id"),$(this).closest("div.form-group").find("label:first"));if(-1===jQuery.inArray(e,t)?(l.addClass("fieldErrorColor"),o++):l.removeClass("fieldErrorColor"),"siteCreateModuleName"==e&&(a=$(this).val(),i=$(this).closest("form").find("label.err_"+e).not(":has(input)")),"sdom_domain"==e&&(n=$(this).val(),s=$(this).closest("form").find("label.err_"+e).not(":has(input)")),-1!==e.indexOf("site-domain-")){var d=$(this).val();r[e]=d}}})),o>0)return $("#siteAddAlert").removeClass("hidden"),!0;if(""!=a&&!1===/^[A-Za-z]*$/.test(a))return i.addClass("fieldErrorColor"),$("#siteAddAlert").text(translations.tr_melis_cms_sites_tool_add_step4_create_module_error).removeClass("hidden"),!0;var _=0;return""!=n&&validatedDomainName(s,n)&&_++,$.each(r,(function(e,t){validatedDomainName($("#step3form-multi_domain").find("label.err_"+e).not(":has(input)"),t)&&_++,-1===$.inArray(t,c)?(d[e]=t,c.push(t)):m.push(e)})),_>0?($("#siteAddAlert").text(translations.tr_melis_cms_sites_tool_add_step3_invalid_domain_name).removeClass("hidden"),!0):$.isEmptyObject(d)?""!=n&&($.ajax({type:"POST",url:"/melis/MelisCms/SitesDomains/checkDomain",data:{domain:n},beforeSend:function(){melisCoreTool.pending("#btn-next-step")}}).done((function(e){return $.isEmptyObject(e.result)?(owlStep.trigger("owl.next"),melisCoreTool.done("#btn-next-step"),!1):(s.addClass("fieldErrorColor"),$("#siteAddAlert").text(translations.tr_melis_cms_sites_tool_add_step3_domain_error1+e.result[0]+translations.tr_melis_cms_sites_tool_add_step3_domain_error2),$("#siteAddAlert").removeClass("hidden"),melisCoreTool.done("#btn-next-step"),!0)})).fail((function(e,t,i){melisCoreTool.done("#btn-next-step")})),!0):0!==m.length?($.each(m,(function(e,t){$("#step3form-multi_domain").find("label.err_"+t).not(":has(input)").addClass("fieldErrorColor")})),$("#siteAddAlert").text(translations.tr_melis_cms_sites_tool_add_step3_domain_unique_error).removeClass("hidden"),!0):($.ajax({type:"POST",url:"/melis/MelisCms/SitesDomains/checkDomain",data:{domain:d},beforeSend:function(){melisCoreTool.pending("#btn-next-step")}}).done((function(e){if($.isEmptyObject(e.result))return melisCoreTool.done("#btn-next-step"),owlStep.trigger("owl.next"),!1;$("#siteAddAlert").text("");var t=e.result.length,i=1;$.when($.each(e.result,(function(e,a){var s=$("#step3form-multi_domain").find("label.err_"+e).not(":has(input)");s.addClass("fieldErrorColor");var n=s.text().slice(0,-1);$("#siteAddAlert").append(n+" - "+translations.tr_melis_cms_sites_tool_add_step3_domain_error1+a+translations.tr_melis_cms_sites_tool_add_step3_domain_error2),i!=t&&$("#siteAddAlert").append("</br>"),i++}))).then((function(){return melisCoreTool.done("#btn-next-step"),$("#siteAddAlert").removeClass("hidden"),!0}))})).fail((function(e,t,i){melisCoreTool.done("#btn-next-step"),alert(translations.tr_meliscore_error_message)})),!0)}function removeFormError(e){""!=e&&"skip"!=e&&$(e+" input, "+e+" select").each((function(){var e=$(this).attr("name");$(this).closest("form").find("label.err_"+e).not(":has(input)").removeClass("fieldErrorColor")}))}function validatedDomainName(e,t){return!1===/^(www\.)?(([a-zA-Z0-9-])+\.)?(([a-zA-Z0-9-])+\.)?(([a-zA-Z0-9-])+\.)?(([a-zA-Z0-9-])+\.)?[a-zA-Z0-9\-]{1,}(\.([a-zA-Z]{2,}))$/.test(t)&&(e.addClass("fieldErrorColor"),!0)}function updateSliderHeight(){setInterval((function(){$(".sites-steps-owl").each((function(){$(this).data("owlCarousel").autoHeight()}))}))}function openSiteEditTab(e,t,i){melisHelper.tabOpen(e,"fa-book",t+"_id_meliscms_tool_sites_edit_site","meliscms_tool_sites_edit_site",{siteId:t,moduleName:i},"id_meliscms_tool_sites",(function(){}))}function updateActiveStep(e){var t=e.split("_"),i=$("ul.create-site-step");i.find("span.step-current").text(t[1]),i.each((function(){$(this).find("li").removeClass("active")})),i.each((function(){$(this).find("li."+e).addClass("active")})),i.find("span.step-name").text(i.find("li.active").attr("data-stepName"))}function initVariables(){formData={},selectedLanguages="",domainType="",createFile=!0,newSite=!0,owlStep=null,currentStepForm="",siteName="",siteLabel="",selectedDomainValue=[],isUserSelectModuleOption=!1}function updateSiteTitle(e,t,i,a){return $("#tableToolSites tbody tr").each((function(){var s=$(this).find("td:nth-child(2)").text(),n=$(this).find("td:nth-child(3)").text(),r=$(this).find("td:nth-child(4)").text();a=null==a?r:a;var o=$(this).attr("id");if(e!=o&&t==s&&i==n)return t+=" - "+a})),t}function getSerializedForm(e){return $(e).serializeArray()}function showElement(e){$(e).show()}function hideElement(e){$(e).hide()}function addAttribute(e,t,i){e.attr(t,i)}function removeAttribute(e,t){e.prop(t,null)}function removeParentBodyPropStyle(){setTimeout((function(){$body.prop("style","overflow: hidden").length&&melisCoreTool.removeOverflowHidden()}),500)}$body.on("click","#btn-new-meliscms-tool-sites",(function(){melisCoreTool.pending("#btn-new-meliscms-tool-sites"),melisHelper.createModal("id_meliscms_tool_sites_modal_container","meliscms_tool_sites_modal_add_content",!0,[],modalUrl,(function(){melisCoreTool.done("#btn-new-meliscms-tool-sites"),currentStepForm=""}))})),window.initializeStep=function(){owlStep=$(".sites-steps-owl").owlCarousel({items:1,touchDrag:!1,mouseDrag:!1,dotsSpeed:500,navSpeed:500,dots:!1,pagination:!1,loop:!1,rewindNav:!1,autoHeight:!0,itemsMobile:!1,itemsTablet:!1,itemsDesktopSmall:!1,itemsDesktop:!1,afterMove:function(e){var t=this.currentItem,i=e.find(".item").eq(t).attr("data-afterMove");0===t?hideElement("#btn-prev-step"):showElement("#btn-prev-step"),i=$.parseJSON(i),Array.isArray(i)&&$.each(i,(function(e,t){executeFunction(t)}))},beforeMove:function(e){var t=this.currentItem,i=e.find(".item").eq(t).attr("data-step"),a=e.find(".item").eq(t).attr("data-beforeMove");configFormPath=e.find(".item").eq(t).attr("data-form-path"),a=$.parseJSON(a),Array.isArray(a)&&$.each(a,(function(e,t){executeFunction(t)})),updateActiveStep(i)},afterInit:function(){$(".sites-steps-owl .tool-sites_container_fixed_width").find("label").not(":has(input)").removeClass("melis-radio-box"),setTimeout((function(){$(".sites-steps-owl .tool-sites_container_fixed_width").find("i.tip-info").attr("data-container","body")}),100),isUserSelectModuleOption=!1,domainSingleOpt="",currentStepForm=""}})},$body.on("click","#btn-next-step",(function(e){null!==owlStep&&(""!=currentStepForm&&"skip"!=currentStepForm&&isFormEmpty(getSerializedForm(currentStepForm),currentStepForm)||($("#siteAddAlert").addClass("hidden"),removeFormError(currentStepForm),owlStep.trigger("owl.next")))})),$body.on("click","#btn-prev-step",(function(e){null!==owlStep&&($("#siteAddAlert").addClass("hidden"),removeFormError(currentStepForm),owlStep.trigger("owl.prev"))})),$body.on("click","#btn-finish-step",(function(e){$.ajax({url:"/melis/MelisCms/Sites/createNewSite",method:"POST",data:{data:formData},dataType:"JSON",beforeSend:function(){melisCoreTool.pending("#btn-finish-step")}}).done((function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage,"#72af46"),$("#id_meliscms_tool_sites_modal_container_container").modal("hide"),initVariables(),$("#tableToolSites").DataTable().ajax.reload(),$.each(e.siteIds,(function(t,i){openSiteEditTab(updateSiteTitle(i,e.siteName,e.siteModuleName),i,e.siteModuleName)})),$("input[name=left_tree_search]").val(""),$("#id-mod-menu-dynatree").fancytree("destroy"),mainTree(),cmsSiteHelper.finishCallback()):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger(),melisCoreTool.done("#btn-finish-step")})).fail((function(e,t,i){alert(translations.tr_melis_cms_sites_tool_add_create_site_unknown_error)})),e.preventDefault()})),$body.on("change","#is_create_new_module_for_site input[name='is_create_module']",(function(){$(".step4-forms").removeClass("hidden");var e=$(this).val(),t=$("#step4form_module");"yes"==e?(newSite=!1,createFile=!1,showElement(t.find(".form-group.siteSelectModuleName")),hideElement(t.find(".form-group.siteCreateModuleName")),hideElement(t.find(".form-group.create_sites_file")),addAttribute(t.find(".form-group select[name='siteSelectModuleName']"),"required","required"),removeAttribute(t.find(".form-group input[name='create_sites_file']"),"required"),removeAttribute(t.find(".form-group input[name='siteCreateModuleName']"),"required")):(newSite=!0,showElement(t.find(".form-group.siteCreateModuleName")),showElement(t.find(".form-group.create_sites_file")),hideElement(t.find(".form-group.siteSelectModuleName")),addAttribute(t.find(".form-group input[name='create_sites_file']"),"required","required"),addAttribute(t.find(".form-group input[name='siteCreateModuleName']"),"required","required"),removeAttribute(t.find(".form-group select[name='siteSelectModuleName']"),"required")),updateSliderHeight(),isUserSelectModuleOption=!0})),$body.on("keypress","#step3form-single_domain  #sdom_domain",(function(e){return 13!==e.which})),$body.on("click","#s404_page_id_button span",(function(){var e=$(this).closest("form").attr("id");melisLinkTree.createInputTreeModal("#"+e+" #siteprop_s404_page_id")})),$body.on("click","#site_main_page_id_button span",(function(){var e=$(this).closest("form").attr("id");melisLinkTree.createInputTreeModal("#"+e+" #siteprop_site_main_page_id")})),$body.on("click",".pageSelect span.input-group-addon",(function(){var e=$(this),t=e.siblings("input").attr("id"),i=e.closest("form").attr("id");melisLinkTree.createInputTreeModal("#"+i+" #"+t)})),$body.on("keypress","#meliscms_tool_sites_domain_form  input.form-control",(function(e){return 13!==e.which})),$body.on("change",".sites-tool-lang-tab-checkbox",(function(){var e=$(this),t=e.siblings(".sites-tool-lang-tab-checkbox-lang");"active"!==e.data("active")||this.checked?t.val("false"):melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_melis_cms_sites_tool_languages_title,translations.tr_melis_cms_sites_tool_languages_prompt_delete_data,(function(){t.val("true")}))})),$body.on("click",".cb-cont input[type=checkbox]",(function(){$(this).is(":checked")?($(this).prop("checked",!0),$(this).prev("span").find(".cbmask-inner").addClass("cb-active")):($(this).not(".requried-module").prop("checked",!1),$(this).not(".requried-module").prev("span").find(".cbmask-inner").removeClass("cb-active"))})),$body.on("click","#step2form-multi_language .cb-cont input[type=checkbox]",(function(){$(this).is(":checked")?($(this).prop("checked",!0),$(this).prev("span").find(".cbmask-inner").addClass("cb-active")):($(this).not(".requried-module").prop("checked",!1),$(this).not(".requried-module").prev("span").find(".cbmask-inner").removeClass("cb-active"))})),window.generatePageLink=function(e,t){e="undifined"!=typeof e?e:null;t.data("idPage",e),dataString=t.data(),e?$.ajax({type:"GET",url:"/melis/MelisCms/Page/getPageLink",data:dataString,dataType:"json",encode:!0}).done((function(e){t.val(e.link)})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)})):alert("PageId is null")},$body.on("click",".btnMinifyAssets",(function(){var e=$(this),t=e.parents("tr").attr("id");$.ajax({type:"POST",url:"/minify-assets",data:{siteId:t},dataType:"json",encode:!0,beforeSend:function(){e.attr("disabled",!0)}}).done((function(t){if(t.success)melisHelper.melisOkNotification(t.title,"tr_front_minify_assets_compiled_successfully");else{var i="<h3>"+melisHelper.melisTranslator(t.title)+"</h3>";i+="<p><strong>Error: </strong>  ",i+="<span>"+t.message+"</span>";var a="<div class='melis-modaloverlay overlay-hideonclick'></div>";a+="<div class='melis-modal-cont KOnotif'>  <div class='modal-content'>"+(i+="</p>")+" <span class='btn btn-block btn-primary'>"+translations.tr_meliscore_notification_modal_Close+"</span></div> </div>",$body.append(a)}e.attr("disabled",!1)})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))}));var meliscmsSiteSelectorInputDom="";$body.on("click",".meliscms-site-selector",(function(){zoneId="id_meliscms_page_tree_id_selector",melisKey="meliscms_page_tree_id_selector",modalUrl="melis/MelisCms/Page/renderPageModal",$("#melis-modals-container").find("#id_meliscms_page_tree_id_selector_container").remove(),meliscmsSiteSelectorInputDom=$(this).parents(".input-group").find("input"),$("body").on("hide.bs.modal","#id_meliscms_page_tree_id_selector_container",(function(){$("#id_meliscms_page_tree_id_selector_container").remove(),2==$("body").find(".modal-backdrop").length&&$("body").find(".modal-backdrop").last().remove()})),melisHelper.createModal(zoneId,melisKey,!1,{},modalUrl,(function(){$.contextMenu("destroy",".fancytree-title")}))})),$body.on("click","#meliscms-site-selector",(function(){zoneId="id_meliscms_page_tree_id_selector",melisKey="meliscms_page_tree_id_selector",modalUrl="melis/MelisCms/Page/renderPageModal",$("#melis-modals-container").find("#id_meliscms_page_tree_id_selector_container").remove(),meliscmsSiteSelectorInputDom=$(this).parents(".input-group").find("input"),$("body").on("hide.bs.modal","#id_meliscms_page_tree_id_selector_container",(function(){$("#id_meliscms_page_tree_id_selector_container").remove(),2==$("body").find(".modal-backdrop").length&&$("body").find(".modal-backdrop").last().remove()})),melisHelper.createModal(zoneId,melisKey,!1,{},modalUrl,(function(){$.contextMenu("destroy",".fancytree-title")}))})),$body.on("click","#selectPageId",(function(){var e=$("#find-page-dynatree .fancytree-active").parent("li").attr("id");if(void 0!==e){var t=e.split("_")[1];meliscmsSiteSelectorInputDom.length?(meliscmsSiteSelectorInputDom.val(t),meliscmsSiteSelectorInputDom.data("callback")&&(callback=meliscmsSiteSelectorInputDom.data("callback"),"function"==typeof window[callback]&&window[callback](t,meliscmsSiteSelectorInputDom)),$(this).closest(".modal").modal("hide")):melisHelper.melisKoNotification("tr_meliscms_menu_sitetree_Name","tr_meliscore_error_message")}else melisHelper.melisKoNotification("tr_meliscms_menu_sitetree_Name","tr_meliscms_page_tree_no_selected_page")})),$body.on("change","#siteVarietySelect",(function(){$("#tableToolSites").DataTable().ajax.reload()}))})),window.sitesTableCallback=function(){var e=$("#tableToolSites tbody tr[data-mod-found='false']").find(".btnMinifyAssets");e.prop("disabled",!0),e.attr("disabled",!0),e.attr("title",translations.tr_melis_cms_minify_assets_no_module_button_title)},window.initSitesList=function(e,t){var i=$("#siteVarietySelect");i.length&&(e.site_variety=i.val())};var cmsSiteHelper={setCurrentStepForm:function(e){currentStepForm=e},setSitesStepData:function(e,t){formData[t]=e},getSitesStepData:function(){return formData},finishCallback:function(){},getSummarySteText:function(){return $(".site_creation_info").text()},setSummaryStepText:function(e,t,i){i=null!=i&&i,"append"==(t=null==t?"append":t)?i?$(".site_creation_info").empty().append(e):$(".site_creation_info").append(e):i?$(".site_creation_info").empty().prepend(e):$(".site_creation_info").prepend(e)},siteSaveCallback:function(){}};function formatBytes(e,t){if(0===e)return"0 Bytes";const i=t<0?0:t,a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(i))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][a]}function waitForEl(e,t){var i=setInterval((function(){$jObject=$(e),$jObject.length<1||(clearInterval(i),t($jObject))}),100)}"function"!=typeof Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t}),function(e,t,i,a){var s={init:function(t,i){var a=this;a.$elem=e(i),a.options=e.extend({},e.fn.owlCarousel.options,a.$elem.data(),t),a.userOptions=t,a.loadContent()},loadContent:function(){var t=this;if("function"==typeof t.options.beforeInit&&t.options.beforeInit.apply(this,[t.$elem]),"string"==typeof t.options.jsonPath){var i=t.options.jsonPath;e.getJSON(i,(function(e){if("function"==typeof t.options.jsonSuccess)t.options.jsonSuccess.apply(this,[e]);else{var i="";for(var a in e.owl)i+=e.owl[a].item;t.$elem.html(i)}t.logIn()}))}else t.logIn()},logIn:function(e){var t=this;t.$elem.data("owl-originalStyles",t.$elem.attr("style")).data("owl-originalClasses",t.$elem.attr("class")),t.$elem.css({opacity:0}),t.orignalItems=t.options.items,t.checkBrowser(),t.wrapperWidth=0,t.checkVisible,t.setVars()},setVars:function(){var e=this;if(0===e.$elem.children().length)return!1;e.baseClass(),e.eventTypes(),e.$userItems=e.$elem.children(),e.itemsAmount=e.$userItems.length,e.wrapItems(),e.$owlItems=e.$elem.find(".owl-item"),e.$owlWrapper=e.$elem.find(".owl-wrapper"),e.playDirection="next",e.prevItem=0,e.prevArr=[0],e.currentItem=0,e.customEvents(),e.onStartup()},onStartup:function(){var e=this;e.updateItems(),e.calculateAll(),e.buildControls(),e.updateControls(),e.response(),e.moveEvents(),e.stopOnHover(),e.owlStatus(),!1!==e.options.transitionStyle&&e.transitionTypes(e.options.transitionStyle),!0===e.options.autoPlay&&(e.options.autoPlay=5e3),e.play(),e.$elem.find(".owl-wrapper").css("display","block"),e.$elem.is(":visible")?e.$elem.css("opacity",1):e.watchVisibility(),e.onstartup=!1,e.eachMoveUpdate(),"function"==typeof e.options.afterInit&&e.options.afterInit.apply(this,[e.$elem])},eachMoveUpdate:function(){var e=this;!0===e.options.lazyLoad&&e.lazyLoad(),!0===e.options.autoHeight&&e.autoHeight(),e.onVisibleItems(),"function"==typeof e.options.afterAction&&e.options.afterAction.apply(this,[e.$elem])},updateVars:function(){var e=this;"function"==typeof e.options.beforeUpdate&&e.options.beforeUpdate.apply(this,[e.$elem]),e.watchVisibility(),e.updateItems(),e.calculateAll(),e.updatePosition(),e.updateControls(),e.eachMoveUpdate(),"function"==typeof e.options.afterUpdate&&e.options.afterUpdate.apply(this,[e.$elem])},reload:function(e){var t=this;setTimeout((function(){t.updateVars()}),0)},watchVisibility:function(){var e=this;if(!1!==e.$elem.is(":visible"))return!1;e.$elem.css({opacity:0}),clearInterval(e.autoPlayInterval),clearInterval(e.checkVisible),e.checkVisible=setInterval((function(){e.$elem.is(":visible")&&(e.reload(),e.$elem.animate({opacity:1},200),clearInterval(e.checkVisible))}),500)},wrapItems:function(){var e=this;e.$userItems.wrapAll('<div class="owl-wrapper">').wrap('<div class="owl-item"></div>'),e.$elem.find(".owl-wrapper").wrap('<div class="owl-wrapper-outer">'),e.wrapperOuter=e.$elem.find(".owl-wrapper-outer"),e.$elem.css("display","block")},baseClass:function(){var e=this,t=e.$elem.hasClass(e.options.baseClass),i=e.$elem.hasClass(e.options.theme);t||e.$elem.addClass(e.options.baseClass),i||e.$elem.addClass(e.options.theme)},updateItems:function(){var t=this;if(!1===t.options.responsive)return!1;if(!0===t.options.singleItem)return t.options.items=t.orignalItems=1,t.options.itemsCustom=!1,t.options.itemsDesktop=!1,t.options.itemsDesktopSmall=!1,t.options.itemsTablet=!1,t.options.itemsTabletSmall=!1,t.options.itemsMobile=!1,!1;var i=e(t.options.responsiveBaseWidth).width();if(i>(t.options.itemsDesktop[0]||t.orignalItems)&&(t.options.items=t.orignalItems),void 0!==t.options.itemsCustom&&!1!==t.options.itemsCustom)for(var a in t.options.itemsCustom.sort((function(e,t){return e[0]-t[0]})),t.options.itemsCustom)void 0!==t.options.itemsCustom[a]&&t.options.itemsCustom[a][0]<=i&&(t.options.items=t.options.itemsCustom[a][1]);else i<=t.options.itemsDesktop[0]&&!1!==t.options.itemsDesktop&&(t.options.items=t.options.itemsDesktop[1]),i<=t.options.itemsDesktopSmall[0]&&!1!==t.options.itemsDesktopSmall&&(t.options.items=t.options.itemsDesktopSmall[1]),i<=t.options.itemsTablet[0]&&!1!==t.options.itemsTablet&&(t.options.items=t.options.itemsTablet[1]),i<=t.options.itemsTabletSmall[0]&&!1!==t.options.itemsTabletSmall&&(t.options.items=t.options.itemsTabletSmall[1]),i<=t.options.itemsMobile[0]&&!1!==t.options.itemsMobile&&(t.options.items=t.options.itemsMobile[1]);t.options.items>t.itemsAmount&&!0===t.options.itemsScaleUp&&(t.options.items=t.itemsAmount)},response:function(){var i,a=this;if(!0!==a.options.responsive)return!1;var s=e(t).width();a.resizer=function(){e(t).width()!==s&&(!1!==a.options.autoPlay&&clearInterval(a.autoPlayInterval),clearTimeout(i),i=setTimeout((function(){s=e(t).width(),a.updateVars()}),a.options.responsiveRefreshRate))},e(t).on("resize",a.resizer)},updatePosition:function(){var e=this;e.jumpTo(e.currentItem),!1!==e.options.autoPlay&&e.checkAp()},appendItemsSizes:function(){var t=this,i=0,a=t.itemsAmount-t.options.items;t.$owlItems.each((function(s){var n=e(this);n.css({width:t.itemWidth}).data("owl-item",Number(s)),s%t.options.items!=0&&s!==a||s>a||(i+=1),n.data("owl-roundPages",i)}))},appendWrapperSizes:function(){var e=this,t=e.$owlItems.length*e.itemWidth;e.$owlWrapper.css({width:2*t,left:0}),e.appendItemsSizes()},calculateAll:function(){var e=this;e.calculateWidth(),e.appendWrapperSizes(),e.loops(),e.max()},calculateWidth:function(){var e=this;e.itemWidth=Math.round(e.$elem.width()/e.options.items)},max:function(){var e=this,t=-1*(e.itemsAmount*e.itemWidth-e.options.items*e.itemWidth);return e.options.items>e.itemsAmount?(e.maximumItem=0,t=0,e.maximumPixels=0):(e.maximumItem=e.itemsAmount-e.options.items,e.maximumPixels=t),t},min:function(){return 0},loops:function(){var t=this;t.positionsInArray=[0],t.pagesInArray=[];for(var i=0,a=0,s=0;s<t.itemsAmount;s++)if(a+=t.itemWidth,t.positionsInArray.push(-a),!0===t.options.scrollPerPage){var n=e(t.$owlItems[s]).data("owl-roundPages");n!==i&&(t.pagesInArray[i]=t.positionsInArray[s],i=n)}},buildControls:function(){var t=this;!0!==t.options.navigation&&!0!==t.options.pagination||(t.owlControls=e('<div class="owl-controls"/>').toggleClass("clickable",!t.browser.isTouch).appendTo(t.$elem)),!0===t.options.pagination&&t.buildPagination(),!0===t.options.navigation&&t.buildButtons()},buildButtons:function(){var t=this,i=e('<div class="owl-buttons"/>');t.owlControls.append(i),t.buttonPrev=e("<div/>",{class:"owl-prev",html:t.options.navigationText[0]||""}),t.buttonNext=e("<div/>",{class:"owl-next",html:t.options.navigationText[1]||""}),i.append(t.buttonPrev).append(t.buttonNext),i.on("touchstart.owlControls mousedown.owlControls",'div[class^="owl"]',(function(e){e.preventDefault()})),i.on("touchend.owlControls mouseup.owlControls",'div[class^="owl"]',(function(i){i.preventDefault(),e(this).hasClass("owl-next")?t.next():t.prev()}))},buildPagination:function(){var t=this;t.paginationWrapper=e('<div class="owl-pagination"/>'),t.owlControls.append(t.paginationWrapper),t.paginationWrapper.on("touchend.owlControls mouseup.owlControls",".owl-page",(function(i){i.preventDefault(),Number(e(this).data("owl-page"))!==t.currentItem&&t.goTo(Number(e(this).data("owl-page")),!0)}))},updatePagination:function(){var t=this;if(!1===t.options.pagination)return!1;t.paginationWrapper.html("");for(var i=0,a=t.itemsAmount-t.itemsAmount%t.options.items,s=0;s<t.itemsAmount;s++)if(s%t.options.items==0){if(i+=1,a===s)var n=t.itemsAmount-t.options.items;var r=e("<div/>",{class:"owl-page"}),o=e("<span></span>",{text:!0===t.options.paginationNumbers?i:"",class:!0===t.options.paginationNumbers?"owl-numbers":""});r.append(o),r.data("owl-page",a===s?n:s),r.data("owl-roundPages",i),t.paginationWrapper.append(r)}t.checkPagination()},checkPagination:function(){var t=this;if(!1===t.options.pagination)return!1;t.paginationWrapper.find(".owl-page").each((function(i,a){e(this).data("owl-roundPages")===e(t.$owlItems[t.currentItem]).data("owl-roundPages")&&(t.paginationWrapper.find(".owl-page").removeClass("active"),e(this).addClass("active"))}))},checkNavigation:function(){var e=this;if(!1===e.options.navigation)return!1;!1===e.options.rewindNav&&(0===e.currentItem&&0===e.maximumItem?(e.buttonPrev.addClass("disabled"),e.buttonNext.addClass("disabled")):0===e.currentItem&&0!==e.maximumItem?(e.buttonPrev.addClass("disabled"),e.buttonNext.removeClass("disabled")):e.currentItem===e.maximumItem?(e.buttonPrev.removeClass("disabled"),e.buttonNext.addClass("disabled")):0!==e.currentItem&&e.currentItem!==e.maximumItem&&(e.buttonPrev.removeClass("disabled"),e.buttonNext.removeClass("disabled")))},updateControls:function(){var e=this;e.updatePagination(),e.checkNavigation(),e.owlControls&&(e.options.items>=e.itemsAmount?e.owlControls.hide():e.owlControls.show())},destroyControls:function(){this.owlControls&&this.owlControls.remove()},next:function(e){var t=this;if(t.isTransition)return!1;if(t.currentItem+=!0===t.options.scrollPerPage?t.options.items:1,t.currentItem>t.maximumItem+(1==t.options.scrollPerPage?t.options.items-1:0)){if(!0!==t.options.rewindNav)return t.currentItem=t.maximumItem,!1;t.currentItem=0,e="rewind"}t.goTo(t.currentItem,e)},prev:function(e){var t=this;if(t.isTransition)return!1;if(!0===t.options.scrollPerPage&&t.currentItem>0&&t.currentItem<t.options.items?t.currentItem=0:t.currentItem-=!0===t.options.scrollPerPage?t.options.items:1,t.currentItem<0){if(!0!==t.options.rewindNav)return t.currentItem=0,!1;t.currentItem=t.maximumItem,e="rewind"}t.goTo(t.currentItem,e)},goTo:function(e,t,i){var a=this;if(a.isTransition)return!1;if("function"==typeof a.options.beforeMove&&a.options.beforeMove.apply(this,[a.$elem]),e>=a.maximumItem?e=a.maximumItem:e<=0&&(e=0),a.currentItem=a.owl.currentItem=e,!1!==a.options.transitionStyle&&"drag"!==i&&1===a.options.items&&!0===a.browser.support3d)return a.swapSpeed(0),!0===a.browser.support3d?a.transition3d(a.positionsInArray[e]):a.css2slide(a.positionsInArray[e],1),a.afterGo(),a.singleItemTransition(),!1;var s=a.positionsInArray[e];!0===a.browser.support3d?(a.isCss3Finish=!1,!0===t?(a.swapSpeed("paginationSpeed"),setTimeout((function(){a.isCss3Finish=!0}),a.options.paginationSpeed)):"rewind"===t?(a.swapSpeed(a.options.rewindSpeed),setTimeout((function(){a.isCss3Finish=!0}),a.options.rewindSpeed)):(a.swapSpeed("slideSpeed"),setTimeout((function(){a.isCss3Finish=!0}),a.options.slideSpeed)),a.transition3d(s)):!0===t?a.css2slide(s,a.options.paginationSpeed):"rewind"===t?a.css2slide(s,a.options.rewindSpeed):a.css2slide(s,a.options.slideSpeed),a.afterGo()},jumpTo:function(e){var t=this;"function"==typeof t.options.beforeMove&&t.options.beforeMove.apply(this,[t.$elem]),e>=t.maximumItem||-1===e?e=t.maximumItem:e<=0&&(e=0),t.swapSpeed(0),!0===t.browser.support3d?t.transition3d(t.positionsInArray[e]):t.css2slide(t.positionsInArray[e],1),t.currentItem=t.owl.currentItem=e,t.afterGo()},afterGo:function(){var e=this;e.prevArr.push(e.currentItem),e.prevItem=e.owl.prevItem=e.prevArr[e.prevArr.length-2],e.prevArr.shift(0),e.prevItem!==e.currentItem&&(e.checkPagination(),e.checkNavigation(),e.eachMoveUpdate(),!1!==e.options.autoPlay&&e.checkAp()),"function"==typeof e.options.afterMove&&e.prevItem!==e.currentItem&&e.options.afterMove.apply(this,[e.$elem])},stop:function(){this.apStatus="stop",clearInterval(this.autoPlayInterval)},checkAp:function(){"stop"!==this.apStatus&&this.play()},play:function(){var e=this;if(e.apStatus="play",!1===e.options.autoPlay)return!1;clearInterval(e.autoPlayInterval),e.autoPlayInterval=setInterval((function(){e.next(!0)}),e.options.autoPlay)},swapSpeed:function(e){var t=this;"slideSpeed"===e?t.$owlWrapper.css(t.addCssSpeed(t.options.slideSpeed)):"paginationSpeed"===e?t.$owlWrapper.css(t.addCssSpeed(t.options.paginationSpeed)):"string"!=typeof e&&t.$owlWrapper.css(t.addCssSpeed(e))},addCssSpeed:function(e){return{"-webkit-transition":"all "+e+"ms ease","-moz-transition":"all "+e+"ms ease","-o-transition":"all "+e+"ms ease",transition:"all "+e+"ms ease"}},removeTransition:function(){return{"-webkit-transition":"","-moz-transition":"","-o-transition":"",transition:""}},doTranslate:function(e){return{"-webkit-transform":"translate3d("+e+"px, 0px, 0px)","-moz-transform":"translate3d("+e+"px, 0px, 0px)","-o-transform":"translate3d("+e+"px, 0px, 0px)","-ms-transform":"translate3d("+e+"px, 0px, 0px)",transform:"translate3d("+e+"px, 0px,0px)"}},transition3d:function(e){this.$owlWrapper.css(this.doTranslate(e))},css2move:function(e){this.$owlWrapper.css({left:e})},css2slide:function(e,t){var i=this;i.isCssFinish=!1,i.$owlWrapper.stop(!0,!0).animate({left:e},{duration:t||i.options.slideSpeed,complete:function(){i.isCssFinish=!0}})},checkBrowser:function(){var e="translate3d(0px, 0px, 0px)",a=i.createElement("div");a.style.cssText="  -moz-transform:"+e+"; -ms-transform:"+e+"; -o-transform:"+e+"; -webkit-transform:"+e+"; transform:"+e;var s=a.style.cssText.match(/translate3d\(0px, 0px, 0px\)/g),n=null!==s&&1===s.length,r="ontouchstart"in t||navigator.msMaxTouchPoints;this.browser={support3d:n,isTouch:r}},moveEvents:function(){var e=this;!1===e.options.mouseDrag&&!1===e.options.touchDrag||(e.gestures(),e.disabledEvents())},eventTypes:function(){var e=this,t=["s","e","x"];e.ev_types={},!0===e.options.mouseDrag&&!0===e.options.touchDrag?t=["touchstart.owl mousedown.owl","touchmove.owl mousemove.owl","touchend.owl touchcancel.owl mouseup.owl"]:!1===e.options.mouseDrag&&!0===e.options.touchDrag?t=["touchstart.owl","touchmove.owl","touchend.owl touchcancel.owl"]:!0===e.options.mouseDrag&&!1===e.options.touchDrag&&(t=["mousedown.owl","mousemove.owl","mouseup.owl"]),e.ev_types.start=t[0],e.ev_types.move=t[1],e.ev_types.end=t[2]},disabledEvents:function(){this.$elem.on("dragstart.owl",(function(e){e.preventDefault()})),this.$elem.on("mousedown.disableTextSelect",(function(t){return e(t.target).is("input, textarea, select, option")}))},gestures:function(){var s=this,n={offsetX:0,offsetY:0,baseElWidth:0,relativePos:0,position:null,minSwipe:null,maxSwipe:null,sliding:null,dargging:null,targetElement:null};function r(e){return e.touches?{x:e.touches[0].pageX,y:e.touches[0].pageY}:e.pageX!==a?{x:e.pageX,y:e.pageY}:{x:e.clientX,y:e.clientY}}function o(t){"on"===t?(e(i).on(s.ev_types.move,l),e(i).on(s.ev_types.end,d)):"off"===t&&(e(i).off(s.ev_types.move),e(i).off(s.ev_types.end))}function l(a){a=a.originalEvent||a||t.event;s.newPosX=r(a).x-n.offsetX,s.newPosY=r(a).y-n.offsetY,s.newRelativeX=s.newPosX-n.relativePos,"function"==typeof s.options.startDragging&&!0!==n.dragging&&0!==s.newRelativeX&&(n.dragging=!0,s.options.startDragging.apply(s,[s.$elem])),(s.newRelativeX>8||s.newRelativeX<-8&&!0===s.browser.isTouch)&&(a.preventDefault?a.preventDefault():a.returnValue=!1,n.sliding=!0),(s.newPosY>10||s.newPosY<-10)&&!1===n.sliding&&e(i).off("touchmove.owl");s.newPosX=Math.max(Math.min(s.newPosX,s.newRelativeX/5),s.maximumPixels+s.newRelativeX/5),!0===s.browser.support3d?s.transition3d(s.newPosX):s.css2move(s.newPosX)}function d(i){if((i=i.originalEvent||i||t.event).target=i.target||i.srcElement,n.dragging=!1,!0!==s.browser.isTouch&&s.$owlWrapper.removeClass("grabbing"),s.newRelativeX<0?s.dragDirection=s.owl.dragDirection="left":s.dragDirection=s.owl.dragDirection="right",0!==s.newRelativeX){var a=s.getNewPosition();if(s.goTo(a,!1,"drag"),n.targetElement===i.target&&!0!==s.browser.isTouch){e(i.target).on("click.disable",(function(t){t.stopImmediatePropagation(),t.stopPropagation(),t.preventDefault(),e(i.target).off("click.disable")}));var r=e._data(i.target,"events").click,l=r.pop();r.splice(0,0,l)}}o("off")}s.isCssFinish=!0,s.$elem.on(s.ev_types.start,".owl-wrapper",(function(i){if(3===(i=i.originalEvent||i||t.event).which)return!1;if(!(s.itemsAmount<=s.options.items)){if(!1===s.isCssFinish&&!s.options.dragBeforeAnimFinish)return!1;if(!1===s.isCss3Finish&&!s.options.dragBeforeAnimFinish)return!1;!1!==s.options.autoPlay&&clearInterval(s.autoPlayInterval),!0===s.browser.isTouch||s.$owlWrapper.hasClass("grabbing")||s.$owlWrapper.addClass("grabbing"),s.newPosX=0,s.newRelativeX=0,e(this).css(s.removeTransition());var a=e(this).position();n.relativePos=a.left,n.offsetX=r(i).x-a.left,n.offsetY=r(i).y-a.top,o("on"),n.sliding=!1,n.targetElement=i.target||i.srcElement}}))},getNewPosition:function(){var e,t=this;return(e=t.closestItem())>t.maximumItem?(t.currentItem=t.maximumItem,e=t.maximumItem):t.newPosX>=0&&(e=0,t.currentItem=0),e},closestItem:function(){var t=this,i=!0===t.options.scrollPerPage?t.pagesInArray:t.positionsInArray,a=t.newPosX,s=null;return e.each(i,(function(n,r){a-t.itemWidth/20>i[n+1]&&a-t.itemWidth/20<r&&"left"===t.moveDirection()?(s=r,!0===t.options.scrollPerPage?t.currentItem=e.inArray(s,t.positionsInArray):t.currentItem=n):a+t.itemWidth/20<r&&a+t.itemWidth/20>(i[n+1]||i[n]-t.itemWidth)&&"right"===t.moveDirection()&&(!0===t.options.scrollPerPage?(s=i[n+1]||i[i.length-1],t.currentItem=e.inArray(s,t.positionsInArray)):(s=i[n+1],t.currentItem=n+1))})),t.currentItem},moveDirection:function(){var e,t=this;return t.newRelativeX<0?(e="right",t.playDirection="next"):(e="left",t.playDirection="prev"),e},customEvents:function(){var e=this;e.$elem.on("owl.next",(function(){e.next()})),e.$elem.on("owl.prev",(function(){e.prev()})),e.$elem.on("owl.play",(function(t,i){e.options.autoPlay=i,e.play(),e.hoverStatus="play"})),e.$elem.on("owl.stop",(function(){e.stop(),e.hoverStatus="stop"})),e.$elem.on("owl.goTo",(function(t,i){e.goTo(i)})),e.$elem.on("owl.jumpTo",(function(t,i){e.jumpTo(i)}))},stopOnHover:function(){var e=this;!0===e.options.stopOnHover&&!0!==e.browser.isTouch&&!1!==e.options.autoPlay&&(e.$elem.on("mouseover",(function(){e.stop()})),e.$elem.on("mouseout",(function(){"stop"!==e.hoverStatus&&e.play()})))},lazyLoad:function(){var t=this;if(!1===t.options.lazyLoad)return!1;for(var i=0;i<t.itemsAmount;i++){var s=e(t.$owlItems[i]);if("loaded"!==s.data("owl-loaded")){var n=s.data("owl-item"),r=s.find(".lazyOwl");"string"==typeof r.data("src")?(s.data("owl-loaded")===a&&(r.hide(),s.addClass("loading").data("owl-loaded","checked")),(!0!==t.options.lazyFollow||n>=t.currentItem)&&n<t.currentItem+t.options.items&&r.length&&t.lazyPreload(s,r)):s.data("owl-loaded","loaded")}}},lazyPreload:function(e,t){var i=this,a=0;if("DIV"===t.prop("tagName")){t.css("background-image","url("+t.data("src")+")");var s=!0}else t[0].src=t.data("src");function n(){e.data("owl-loaded","loaded").removeClass("loading"),t.removeAttr("data-src"),"fade"===i.options.lazyEffect?t.fadeIn(400):t.show(),"function"==typeof i.options.afterLazyLoad&&i.options.afterLazyLoad.apply(this,[i.$elem])}!function e(){a+=1,i.completeImg(t.get(0))||!0===s?n():a<=100?setTimeout(e,100):n()}()},autoHeight:function(){var t=this,i=e(t.$owlItems[t.currentItem]).find("img");if(i.get(0)!==a){var s=0;!function e(){s+=1,t.completeImg(i.get(0))?n():s<=100?setTimeout(e,100):t.wrapperOuter.css("height","")}()}else n();function n(){var i=e(t.$owlItems[t.currentItem]).height();t.wrapperOuter.css("height",i+"px"),t.wrapperOuter.hasClass("autoHeight")||setTimeout((function(){t.wrapperOuter.addClass("autoHeight")}),0)}},completeImg:function(e){return!!e.complete&&(void 0===e.naturalWidth||0!=e.naturalWidth)},onVisibleItems:function(){var t=this;!0===t.options.addClassActive&&t.$owlItems.removeClass("active"),t.visibleItems=[];for(var i=t.currentItem;i<t.currentItem+t.options.items;i++)t.visibleItems.push(i),!0===t.options.addClassActive&&e(t.$owlItems[i]).addClass("active");t.owl.visibleItems=t.visibleItems},transitionTypes:function(e){this.outClass="owl-"+e+"-out",this.inClass="owl-"+e+"-in"},singleItemTransition:function(){var e=this;e.isTransition=!0;var t=e.outClass,i=e.inClass,a=e.$owlItems.eq(e.currentItem),s=e.$owlItems.eq(e.prevItem),n=Math.abs(e.positionsInArray[e.currentItem])+e.positionsInArray[e.prevItem],r=Math.abs(e.positionsInArray[e.currentItem])+e.itemWidth/2;e.$owlWrapper.addClass("owl-origin").css({"-webkit-transform-origin":r+"px","-moz-perspective-origin":r+"px","perspective-origin":r+"px"});var o="webkitAnimationEnd oAnimationEnd MSAnimationEnd animationend";s.css(function(e,t){return{position:"relative",left:e+"px"}}(n)).addClass(t).on(o,(function(){e.endPrev=!0,s.off(o),e.clearTransStyle(s,t)})),a.addClass(i).on(o,(function(){e.endCurrent=!0,a.off(o),e.clearTransStyle(a,i)}))},clearTransStyle:function(e,t){var i=this;e.css({position:"",left:""}).removeClass(t),i.endPrev&&i.endCurrent&&(i.$owlWrapper.removeClass("owl-origin"),i.endPrev=!1,i.endCurrent=!1,i.isTransition=!1)},owlStatus:function(){var e=this;e.owl={userOptions:e.userOptions,baseElement:e.$elem,userItems:e.$userItems,owlItems:e.$owlItems,currentItem:e.currentItem,prevItem:e.prevItem,visibleItems:e.visibleItems,isTouch:e.browser.isTouch,browser:e.browser,dragDirection:e.dragDirection}},clearEvents:function(){this.$elem.off(".owl owl mousedown.disableTextSelect"),e(i).off(".owl owl"),e(t).off("resize",this.resizer)},unWrap:function(){var e=this;0!==e.$elem.children().length&&(e.$owlWrapper.unwrap(),e.$userItems.unwrap().unwrap(),e.owlControls&&e.owlControls.remove()),e.clearEvents(),e.$elem.attr("style",e.$elem.data("owl-originalStyles")||"").attr("class",e.$elem.data("owl-originalClasses"))},destroy:function(){var e=this;e.stop(),clearInterval(e.checkVisible),e.unWrap(),e.$elem.removeData()},reinit:function(t){var i=this,a=e.extend({},i.userOptions,t);i.unWrap(),i.init(a,i.$elem)},addItem:function(e,t){var i,s=this;return!!e&&(0===s.$elem.children().length?(s.$elem.append(e),s.setVars(),!1):(s.unWrap(),(i=t===a||-1===t?-1:t)>=s.$userItems.length||-1===i?s.$userItems.eq(-1).after(e):s.$userItems.eq(i).before(e),void s.setVars()))},removeItem:function(e){var t,i=this;if(0===i.$elem.children().length)return!1;t=e===a||-1===e?-1:e,i.unWrap(),i.$userItems.eq(t).remove(),i.setVars()}};e.fn.owlCarousel=function(t){return this.each((function(){if(!0===e(this).data("owl-init"))return!1;e(this).data("owl-init",!0);var i=Object.create(s);i.init(t,this),e.data(this,"owlCarousel",i)}))},e.fn.owlCarousel.options={items:5,itemsCustom:!1,itemsDesktop:[1199,4],itemsDesktopSmall:[979,3],itemsTablet:[768,2],itemsTabletSmall:!1,itemsMobile:[479,1],singleItem:!1,itemsScaleUp:!1,slideSpeed:200,paginationSpeed:800,rewindSpeed:1e3,autoPlay:!1,stopOnHover:!1,navigation:!1,navigationText:["prev","next"],rewindNav:!0,scrollPerPage:!1,pagination:!0,paginationNumbers:!1,responsive:!0,responsiveRefreshRate:200,responsiveBaseWidth:t,baseClass:"owl-carousel",theme:"owl-theme",lazyLoad:!1,lazyFollow:!0,lazyEffect:"fade",autoHeight:!1,jsonPath:!1,jsonSuccess:!1,dragBeforeAnimFinish:!0,mouseDrag:!0,touchDrag:!0,addClassActive:!1,transitionStyle:!1,beforeUpdate:!1,afterUpdate:!1,beforeInit:!1,afterInit:!1,beforeMove:!1,afterMove:!1,afterAction:!1,startDragging:!1,afterLazyLoad:!1}}(jQuery,window,document),$((function(){var e=$("body"),t="#id_meliscms_mini_template_manager_tool_header_add_btn",i="#id_mini_template_manager_tool_add",a="#melis-cms-minitemplate-add-btn",s="#mini-template-manager-tool-table-filter-sites-select",n=".new-minitemplate-thumbnail",r="#mini-template-category-tree",o=".melis-mini-template-manager-table-refresh";e.on("keypress","#miniTemplateName",(function(e){"Enter"===e.key&&e.preventDefault()})),e.on("paste","#miniTemplateName",(function(e){e.preventDefault()})),e.on("click",t,(function(){l.openTab(translations.tr_meliscms_mini_template_manager_tool_header_add_btn,"new_template",{templateName:"new_template",module:$(s).find("option:selected").val()})})),e.on("click",".mini-template-tool-edit-btn",(function(){var e=$("#tableMiniTemplateManager").DataTable().row("#"+$(this).closest("tr").attr("id")).data();$(this).closest("tr").hasClass("child")&&(e=$("#tableMiniTemplateManager").DataTable().row("#"+$(this).closest("tr").prev().attr("id")).data());var t=e.DT_RowAttr.templateName,i=e.DT_RowAttr.module,a=e.DT_RowAttr.thumbnail;l.openTab("Tpl "+t,t,{module:i,templateName:t,thumbnail:a})})),e.on("click",a,(function(){$(i).trigger("submit")})),e.on("submit",i,(function(t){melisCoreTool.pending(a);var i=new FormData(this);i.append("categoryId",$(this).closest("div").find(".mtpl-category-id").val()),i.append("siteId",$("#mini-template-manager-site-id").val()),$.ajax({type:"POST",url:"/melis/MelisCms/MiniTemplateManager/createMiniTemplate",data:i,cache:!1,contentType:!1,processData:!1}).done((function(t){t.success?(melisHelper.tabClose("new_template_id_meliscms_mini_template_manager_tool_add"),l.openTab("Tpl "+t.data.template_name,t.data.template_name,{module:t.data.module,templateName:t.data.template_name,thumbnail:t.data.thumbnail}),e.find(".mini-template-manager-tool-table-refresh "+o).trigger("click"),e.find("#id_meliscms_mini_template_menu_manager_tool").length&&$(r).jstree(!0).refresh(),e.find(".melis-mini-template-menu-manager-table-refresh").trigger("click"),melisHelper.melisOkNotification(t.textTitle,t.textMessage)):(melisHelper.melisKoNotification(translations.tr_meliscms_mini_template_menu_manager_save_mini_template,"",t.errors),melisCoreTool.highlightErrors(t.success,t.errors,"id_mini_template_manager_tool_add")),melisCore.flashMessenger(),melisCoreTool.done(a)})).fail((function(e){melisCoreTool.done(a)})),t.preventDefault()})),e.on("click",".melis-cms-minitemplate-edit-btn",(function(){$(this).closest(".tab-pane").find("form").trigger("submit")})),e.on("submit",".mini_template_manager_tool_update",(function(t){melisCoreTool.pending(".melis-cms-minitemplate-edit-btn");var i=$(this).closest("#id_meliscms_mini_template_manager_tool_add_body_form"),a=i.data("currentmodule"),s=i.data("currenttemplate"),d=new FormData(this),c=!1;"/MelisFront/plugins/images/default.jpg"==$(this).closest(".tab-pane").find(n).attr("src")&&(c=!0),d.append("image",c),d.append("current_module",a),d.append("current_template",s),$.ajax({type:"POST",url:"/melis/MelisCms/MiniTemplateManager/updateMiniTemplate",data:d,cache:!1,contentType:!1,processData:!1}).done((function(t){t.success?(melisHelper.tabClose(s+"_id_meliscms_mini_template_manager_tool_add"),l.openTab("Tpl "+t.data.template_name,t.data.template_name,{module:t.data.module,templateName:t.data.template_name,thumbnail:t.data.thumbnail}),e.find(".mini-template-manager-tool-table-refresh "+o).trigger("click"),e.find("#id_meliscms_mini_template_menu_manager_tool").length&&$(r).jstree(!0).refresh(),e.find(".melis-mini-template-menu-manager-table-refresh").trigger("click"),melisHelper.melisOkNotification(t.textTitle,t.textMessage)):(melisHelper.melisKoNotification(translations.tr_melis_cms_page_tree_import,"",t.errors),melisCoreTool.highlightErrors(t.success,t.errors,"id_mini_template_manager_tool_update")),melisCore.flashMessenger(),melisCoreTool.done(".melis-cms-minitemplate-edit-btn")})).fail((function(e){melisCoreTool.done(".melis-cms-minitemplate-edit-btn")})),t.preventDefault()})),e.on("click",".mini-template-tool-delete-btn",(function(){var t=$("#tableMiniTemplateManager").DataTable().row("#"+$(this).closest("tr").attr("id")).data();$(this).closest("tr").hasClass("child")&&(t=$("#tableMiniTemplateManager").DataTable().row("#"+$(this).closest("tr").prev().attr("id")).data());var i=t.DT_RowAttr.templateName,a=t.DT_RowAttr.module;melisCoreTool.confirm(translations.tr_meliscms_mini_template_manager_tool_delete_modal_confirm,translations.tr_meliscms_mini_template_manager_tool_delete_modal_cancel,translations.tr_meliscms_mini_template_manager_tool_delete_modal_title,translations.tr_meliscms_mini_template_manager_tool_delete_modal_text,(function(){$.ajax({type:"POST",url:"/melis/MelisCms/MiniTemplateManager/deleteMiniTemplate",data:{template:i,module:a}}).done((function(t){t.success?(e.find(".mini-template-manager-tool-table-refresh "+o).trigger("click"),e.find(".melis-mini-template-menu-manager-table-refresh").trigger("click"),e.find("#id_meliscms_mini_template_menu_manager_tool").length&&$(r).jstree(!0).refresh(),e.find(".melis-mini-template-menu-manager-table-refresh").trigger("click"),$('li[data-tool-id="'+i+'_id_meliscms_mini_template_manager_tool_add"]').find("a.close").trigger("click"),melisHelper.melisOkNotification(t.textTitle,t.textMessage)):melisHelper.melisKoNotification(translations.tr_meliscms_mini_template_manager_tool_delete_modal_title,translations.tr_meliscms_mini_template_delete_fail),melisCore.flashMessenger()})).fail((function(e){}))}))})),e.on("click",".remove-mini-template-thumbnail-preview",(function(){$("#"+activeTabId).find('input[name="miniTemplateThumbnail"]').val(""),$("#"+activeTabId).find(n).attr("src","/MelisFront/plugins/images/default.jpg")})),e.on("click",o,(function(){melisHelper.zoneReload("id_meliscms_mini_template_manager_tool_body_data_table","meliscms_mini_template_manager_tool_body_data_table",{})})),e.on("change",s,(function(){$("#tableMiniTemplateManager").DataTable().ajax.reload(),$(t).removeClass("disabled"),$(t).prop("disabled",!1)}));var l={openTab:function(e,t,i){melisHelper.tabOpen(e,"fa fa-tasks",t+"_id_meliscms_mini_template_manager_tool_add","meliscms_mini_template_manager_tool_add",i,"id_meliscms_mini_template_manager_tool")}}})),window.initMiniTemplateManagerToolTableSites=function(e,t){var i=$("#mini-template-manager-tool-table-filter-sites-select");i.length&&(e.site_name=i.val())},window.miniTemplateManagerToolTableCallback=function(){waitForEl("#mini-template-manager-tool-table-filter-sites-select",(function(e){e.val()<1&&(e.find(":first-child").remove(),e.val(e.find("option").val()).trigger("change"))}))},window.thumbnailPreview=function(e,t){var i=$("#"+activeTabId).find("#mini-template-manager-max-size").val();if(t.files&&t.files[0])if(parseInt(t.files[0].size)>parseInt(i))$(t).val(""),$("#"+activeTabId+" "+e).attr("src","/MelisFront/plugins/images/default.jpg"),melisHelper.melisKoNotification(translations.tr_melis_cms_page_tree_import,translations.tr_melis_cms_page_tree_error_file_size_exceeded+formatBytes(i,2),[]);else{var a=new FileReader;a.onload=function(t){$("#"+activeTabId+" "+e).attr("src",t.target.result)},a.readAsDataURL(t.files[0])}else $("#"+activeTabId+" "+e).attr("src","/MelisFront/plugins/images/default.jpg")},$((function(){var e=$("body"),t="#mini-template-menu-manager-site-select",i="#mini-template-category-tree",a=!1,s=melisLangId;e.on("click",".mtpl-menu-plugins-tab",(function(){$(".melis-mini-template-menu-manager-table-refresh").trigger("click")})),e.on("click",".melis-mini-template-menu-manager-table-refresh",(function(){melisHelper.zoneReload("id_meliscms_mini_template_menu_manager_tool_add_category_body_plugins_table","meliscms_mini_template_menu_manager_tool_add_category_body_plugins_table",{formType:"edit"})})),e.on("click",".add-m-tpl-category",(function(){$("#id_meliscms_mini_template_menu_manager_tool_add_category_container").removeClass("hidden"),melisHelper.zoneReload("id_meliscms_mini_template_menu_manager_tool_add_category_container","meliscms_mini_template_menu_manager_tool_add_category_container",{isHidden:!1},(function(){$("#id_meliscms_mini_template_menu_manager_tool_header a").trigger("click")}))})),e.on("click",".add-m-tpl-plugin",(function(){melisHelper.tabOpen(translations.tr_meliscms_mini_template_manager_tool,"fa fa-tasks","id_meliscms_mini_template_manager_tool","meliscms_mini_template_manager_tool");var e=$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscms_mini_template_manager_tool']"),i=setInterval((function(){e.length&&($(".close.close-tab[data-id='new_template_id_meliscms_mini_template_manager_tool_add']").trigger("click"),melisHelper.tabOpen(translations.tr_meliscms_mini_template_manager_tool_header_add_btn,"fa fa-list-alt","new_template_id_meliscms_mini_template_manager_tool_add","meliscms_mini_template_manager_tool_add",{templateName:"new_template",module:$(t).find("option:selected").val()},"id_meliscms_mini_template_manager_tool"),clearInterval(i))}),500)})),e.on("click",".close",(function(){"id_meliscms_mini_template_menu_manager_tool"==$(this).data("id")&&(a=!1,s=melisLangId)})),e.on("click","#close-all-tab",(function(){a=!1})),e.on("change",t,(function(){var s,n=$(this).val();$("#mini-template-tree-no-data").css("display","none"),$("#id_meliscms_mini_template_menu_manager_tool_add_category_container").hasClass("hidden")||melisHelper.zoneReload("id_meliscms_mini_template_menu_manager_tool_add_category_container","meliscms_mini_template_menu_manager_tool_add_category_container",{},(function(){})),0!=n?a?($(i).jstree(!0).settings.core.data.data=[{name:"langlocale",value:$("#mini-template-category-tree").data("langlocale")},{name:"siteId",value:$(t).find("option:selected").data("id")}],$(i).jstree(!0).refresh()):(s=(s="langlocale="+$("#mini-template-category-tree").data("langlocale"))+" &siteId="+$(t).find("option:selected").data("id"),e.on("click","#mini-template-category-tree",(function(e){$("#mini-template-category-tree ul li div").removeClass("jstree-wholerow-clicked"),e.stopPropagation(),e.preventDefault()})),$(i).on("#mini-template-category-tree changed.jstree",(function(e,t){})).on("#mini-template-category-tree refresh.jstree",(function(e,t){0===$("#mini-template-category-tree .jstree-container-ul").children("li").length?$("#mini-template-tree-no-data").css("display","inline-block"):$("#mini-template-tree-no-data").css("display","none")})).on("#mini-template-category-tree loading.jstree",(function(e,t){})).on("#mini-template-category-tree loaded.jstree",(function(e,t){0===$("#mini-template-category-tree .jstree-container-ul").children("li").length?$("#mini-template-tree-no-data").css("display","inline-block"):$("#mini-template-tree-no-data").css("display","none"),$(".add-m-tpl-category").prop("disabled",!1),$(".add-m-tpl-category").attr("title",""),$(".add-m-tpl-plugin").prop("disabled",!1),$(".add-m-tpl-plugin").attr("title",""),$(".mini-template-menu-manager-lang").find("a").removeClass("disabled"),$(".mini-template-menu-manager-lang").find("a").attr("title","")})).on("#mini-template-category-tree ready.jstree",(function(e,t){})).on("#mini-template-category-tree load_node.jstree",(function(e,t){})).on("#mini-template-category-tree open_node.jstree",(function(e,t){})).on("#mini-template-category-tree after_open.jstree",(function(e,t){})).on("#mini-template-category-tree dblclick.jstree",(function(e,t){var a=$(i).jstree().get_selected(!0)[0];if("category"==a.type)$("#id_meliscms_mini_template_menu_manager_tool_add_category_container").removeClass("hidden"),melisHelper.zoneReload("id_meliscms_mini_template_menu_manager_tool_add_category_container","meliscms_mini_template_menu_manager_tool_add_category_container",{isHidden:!1,id:a.id,formType:"edit",status:a.original.status},(function(){$("#id_meliscms_mini_template_menu_manager_tool_header a").trigger("click")}));else if("mini-template"==a.type){melisHelper.tabOpen(translations.tr_meliscms_mini_template_manager_tool,"fa fa-tasks","id_meliscms_mini_template_manager_tool","meliscms_mini_template_manager_tool");var s=$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscms_mini_template_manager_tool']"),n=setInterval((function(){s.length&&(melisHelper.tabOpen("Tpl "+a.original.id,"fa fa-tasks",a.original.id+"_id_meliscms_mini_template_manager_tool_add","meliscms_mini_template_manager_tool_add",{module:a.original.module,templateName:a.original.id,thumbnail:a.original.imgSource},"id_meliscms_mini_template_manager_tool"),clearInterval(n))}),500)}})).on("#mini-template-category-tree move_node.jstree",(function(e,a){var s=$(i).jstree(!0).get_json("#",{flat:!0});$.ajax({type:"POST",url:"/melis/MelisCms/MiniTemplateMenuManager/saveTree",data:{tree_data:JSON.stringify(s),site_id:$(t).find("option:selected").data("id")}}).done((function(e){e.success&&$(".melis-mini-template-menu-manager-table-refresh").trigger("click")})).fail((function(e){}))})).on("#mini-template-category-tree select_node.jstree",(function(e,t){})).jstree({contextmenu:{items:function(e){var a={add_category_template:{label:translations.tr_meliscms_mini_template_menu_manager_tool_jstree_add_minitemplate,icon:"fa fa-plus",action:function(i){melisHelper.tabOpen(translations.tr_meliscms_mini_template_manager_tool,"fa fa-tasks","id_meliscms_mini_template_manager_tool","meliscms_mini_template_manager_tool");var a=$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscms_mini_template_manager_tool']"),s=setInterval((function(){a.length&&($(".close.close-tab[data-id='new_template_id_meliscms_mini_template_manager_tool_add']").trigger("click"),melisHelper.tabOpen(translations.tr_meliscms_mini_template_manager_tool_header_add_btn,"fa fa-tasks","new_template_id_meliscms_mini_template_manager_tool_add","meliscms_mini_template_manager_tool_add",{templateName:"new_template",siteId:$(t).find("option:selected").data("id"),module:$(t).find("option:selected").val(),categoryId:e.original.categoryId},"id_meliscms_mini_template_manager_tool"),clearInterval(s))}),500)}},edit_category:{label:translations.tr_meliscms_mini_template_menu_manager_tool_jstree_edit_category,icon:"fa fa-edit",action:function(t){parseInt(e.id),e.children.length,$("#id_meliscms_mini_template_menu_manager_tool_add_category_container").removeClass("hidden"),melisHelper.zoneReload("id_meliscms_mini_template_menu_manager_tool_add_category_container","meliscms_mini_template_menu_manager_tool_add_category_container",{isHidden:!1,id:e.id,formType:"edit",status:e.original.status},(function(){$("#id_meliscms_mini_template_menu_manager_tool_header a").trigger("click")}))}},delete_category:{label:translations.tr_meliscms_mini_template_menu_manager_tool_jstree_delete_category,icon:"fa fa-trash-o",action:function(t){0==e.children.length?melisCoreTool.confirm(translations.tr_meliscms_mini_template_manager_tool_delete_modal_confirm,translations.tr_meliscms_mini_template_manager_tool_delete_modal_cancel,translations.tr_meliscms_mini_template_menu_manager_tool_jstree_delete_category_title,translations.tr_meliscms_mini_template_menu_manager_tool_jstree_delete_category_text,(function(){$.ajax({type:"POST",url:"/melis/MelisCms/MiniTemplateMenuManager/deleteCategory",data:{id:e.id}}).done((function(e){e.success?($(i).jstree(!0).refresh(),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):melisHelper.melisKoNotification(translations.tr_meliscms_mini_template_menu_manager_tool_jstree_delete_category_title,translations.tr_meliscms_mini_template_menu_manager_category_delete_fail),melisCore.flashMessenger()})).fail((function(e){}))})):melisHelper.melisKoNotification(translations.tr_meliscms_mini_template_menu_manager_tool_jstree_delete_category_title,translations.tr_meliscms_mini_template_menu_manager_tool_jstree_delete_category_error_children,[])}},edit_plugin:{label:translations.tr_meliscms_mini_template_menu_manager_tool_jstree_edit_minitemplate,icon:"fa fa-edit",action:function(t){melisHelper.tabOpen(translations.tr_meliscms_mini_template_manager_tool,"fa fa-tasks","id_meliscms_mini_template_manager_tool","meliscms_mini_template_manager_tool");var i=$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscms_mini_template_manager_tool']"),a=setInterval((function(){i.length&&(melisHelper.tabOpen("Tpl "+e.original.id,"fa fa-tasks",e.original.id+"_id_meliscms_mini_template_manager_tool_add","meliscms_mini_template_manager_tool_add",{module:e.original.module,templateName:e.original.id,thumbnail:e.original.imgSource},"id_meliscms_mini_template_manager_tool"),clearInterval(a))}),500)}}};return"category"==e.original.type&&(delete a.edit_plugin,delete a.delete_plugin),"mini-template"==e.original.type&&(delete a.edit_category,delete a.delete_category,delete a.add_category_template),a}},core:{multiple:!1,check_callback:function(e,t,i,a,s){},animation:500,themes:{name:"proton",responsive:!1},dblclick_toggle:!1,data:{cache:!1,url:"/melis/MelisCms/MiniTemplateMenuManager/getTree?"+s},strings:{"Loading ...":translations.tr_meliscms_mini_template_menu_manager_js_tree_loading}},types:{"#":{valid_children:["mini-template","category"]},category:{valid_children:["mini-template"]},"mini-template":{valid_children:["none"]}},plugins:["contextmenu","changed","dnd","search","types"]}),a=!0):($(i).jstree(!0).destroy(),a=!1,$(".add-m-tpl-category").attr("disabled","disabled"),$(".add-m-tpl-category").attr("title",translations.tr_meliscms_mini_template_menu_manager_select_site_first_btn_title),$(".add-m-tpl-plugin").attr("disabled","disabled"),$(".add-m-tpl-plugin").attr("title",translations.tr_meliscms_mini_template_menu_manager_select_site_first_btn_title),$(".mini-template-menu-manager-lang").find("a").addClass("disabled"),$(".mini-template-menu-manager-lang").find("a").attr("title",translations.tr_meliscms_mini_template_menu_manager_select_site_first_btn_title))})),e.on("click",".mini-template-menu-manager-lang-select li a",(function(){var e=$(this),a=e.text();s=e.data("locale"),$(".mini-template-menu-manager-lang a span.filter-key").text(a),$(i).data("langlocale",s),$(i).jstree(!0).settings.core.data.data=[{name:"langlocale",value:s},{name:"module",value:$(t).val()}],$(i).jstree(!0).refresh()})),e.on("click","#id_meliscms_mini_template_menu_manager_save_btn",(function(){var e=$("#mtpl-category-status").find(".switch-on");e=e.length?1:0;var a=$("#id_meliscms_mini_template_menu_manager_tool_add_category_body_properties_form form").serializeArray();a.push({name:"site_id",value:$(t).find("option:selected").data("id")}),a.push({name:"cat_id",value:$("#menu-manager-category-id").data("id")}),a.push({name:"status",value:e}),a.push({name:"status",value:e}),a.push({name:"currentLocale",value:melisLangId}),melisCoreTool.pending("#id_meliscms_mini_template_menu_manager_save_btn"),$.ajax({type:"POST",url:"/melis/MelisCms/MiniTemplateMenuManager/saveCategory",data:a}).done((function(t){if(t.success)$(i).jstree(!0).refresh(),melisHelper.zoneReload("id_meliscms_mini_template_menu_manager_tool_add_category_container","meliscms_mini_template_menu_manager_tool_add_category_container",{isHidden:!1,id:t.id+"-"+t.categoryName,formType:"edit",status:e},(function(){$("#id_meliscms_mini_template_menu_manager_tool_header a").hasClass("collapsed")&&$("#id_meliscms_mini_template_menu_manager_tool_header a").trigger("click")})),melisHelper.melisOkNotification(t.textTitle,t.textMessage);else{var a={};$.each(t.errors,(function(e,t){if(t.error===translations.tr_meliscms_mini_template_error_category_atleast_one_provided)return a[e]=t,!1;a[e]=t})),melisHelper.melisKoNotification(translations.tr_meliscms_mini_template_menu_manager_save_category,"",a);var s=$("#id_meliscms_mini_template_menu_manager_tool_add_category_body_properties_form form").serializeArray(),n="_id_menu_manager_tool_site_add_category",r="-mini-template-menu-manager-category";void 0!==$("#menu-manager-category-id").data("id")&&(n="_id_menu_manager_tool_site_update_category"),$.each(s,(function(e,i){var a=1,s=i.name.split("_",1),o={},l=0;$.each(t.errors,(function(e,t){i.name==e&&(a=0,o[s+"_category_name"]=t,$('a[href="#'+s+r+'"] span.mm-lang-name').addClass("mm-tab-error-color"),l++)})),0==l&&$('a[href="#'+s+r+'"] span.mm-lang-name').removeClass("mm-tab-error-color"),melisCoreTool.highlightErrors(a,o,s+n)}))}melisCore.flashMessenger(),melisCoreTool.done("#id_meliscms_mini_template_menu_manager_save_btn")})).fail((function(e){melisCoreTool.done("#id_meliscms_mini_template_menu_manager_save_btn")}))})),e.on("click",".menu-mini-template-tool-edit-btn",(function(){var e=$("#tableMiniTemplateMenuManagerPlugins").DataTable().row("#"+$(this).closest("tr").attr("id")).data();$(this).closest("tr").hasClass("child")&&(e=$("#tableMiniTemplateMenuManagerPlugins").DataTable().row("#"+$(this).closest("tr").prev().attr("id")).data());var t=e.DT_RowAttr.templateName,i=e.DT_RowAttr.module,a=e.DT_RowAttr.thumbnail;melisHelper.tabOpen(translations.tr_meliscms_mini_template_manager_tool,"fa fa-tasks","id_meliscms_mini_template_manager_tool","meliscms_mini_template_manager_tool");var s=$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscms_mini_template_manager_tool']"),n=setInterval((function(){s.length&&(melisHelper.tabOpen("Tpl "+t,"fa fa-tasks",t+"_id_meliscms_mini_template_manager_tool_add","meliscms_mini_template_manager_tool_add",{module:i,templateName:t,thumbnail:a},"id_meliscms_mini_template_manager_tool"),clearInterval(n))}),500)})),e.on("click",".menu-mini-template-tool-delete-btn",(function(){var a=$("#tableMiniTemplateMenuManagerPlugins").DataTable().row("#"+$(this).closest("tr").attr("id")).data();$(this).closest("tr").hasClass("child")&&(a=$("#tableMiniTemplateMenuManagerPlugins").DataTable().row("#"+$(this).closest("tr").prev().attr("id")).data());var s=a.DT_RowAttr.templateName;melisCoreTool.confirm(translations.tr_meliscms_mini_template_manager_tool_delete_modal_confirm,translations.tr_meliscms_mini_template_manager_tool_delete_modal_cancel,translations.tr_meliscms_mini_template_menu_manager_remove_plugin,translations.tr_meliscms_mini_template_menu_manager_remove_plugin_text,(function(){$.ajax({type:"POST",url:"/melis/MelisCms/MiniTemplateMenuManager/removePluginFromCategory",data:{template:s,siteId:$(t).find("option:selected").data("id")}}).done((function(t){t.success?(e.find(".melis-mini-template-menu-manager-table-refresh").trigger("click"),e.find("#id_meliscms_mini_template_menu_manager_tool").length&&$(i).jstree(!0).refresh(),$('li[data-tool-id="'+s+'_id_meliscms_mini_template_manager_tool_add"]').find("a.close").trigger("click")):melisHelper.melisKoNotification(translations.tr_meliscms_mini_template_manager_tool_delete_modal_title,translations.tr_meliscms_mini_template_delete_fail)})).fail((function(e){}))}))}))})),window.initMiniTemplateMenuManagerPluginTables=function(e,t){e.id=$("#menu-manager-category-id").data("id"),$("#tableMiniTemplateMenuManagerPlugins").on("row-reorder.dt",(function(e,t,i){i.triggerRow.data()[1];for(var a=0,s=t.length;a<s;a++){$("#tableMiniTemplateMenuManagerPlugins").DataTable().row(t[a].node).data()[1]+" updated to be in position "+t[a].newData+" (was "+t[a].oldData+")<br>"}if(!$.isEmptyObject(t)){var n=new Array,r=new Array;$.each(t,(function(){r.push(this.node.id+"-"+this.newPosition)})),n.push({name:"data",value:r.join()}),n=$.param(n),$.ajax({type:"POST",url:"/melis/MelisCms/MiniTemplateMenuManager/reorderMiniTemplates",data:n,dataType:"json",encode:!0,beforeSend:function(){$("#tableMiniTemplateMenuManagerPlugins").addClass("loading-changes"),$("#tableMiniTemplateMenuManagerPlugins").DataTable().rowReorder.disable()}}).done((function(e){$("#mini-template-category-tree").jstree(!0).refresh(),$("#tableMiniTemplateMenuManagerPlugins").DataTable().rowReorder.enable(),$("#tableMiniTemplateMenuManagerPlugins").removeClass("loading-changes")})).fail((function(){}))}}))},$((function(){var e=$("body");function t(e,t){var i=activeTabId.split("_")[0];$('div[data-siteModule-name="'+e+'"].'+i+"_module_switch").find("div.switch-animate").removeClass("switch-on switch-off").addClass("switch-"+t),"on"===t?$("div[data-siteModule-name="+e+"]."+i+"_module_switch>div>input").attr("checked",!0):$("div[data-siteModule-name="+e+"]."+i+"_module_switch>div>input").prop("checked",!1)}e.on("switch-change","#site-select-deselect-all-module",(function(e,i){var a=activeTabId.split("_")[0],s="";s=!1===i.value?"off":"on",$("."+a+"_module_switch").each((function(e,i){t($(i).attr("data-siteModule-name"),s)}))}));var i="",a=!1,s=!1,n=!1;e.on("switch-change","div[data-siteModule-name]",(function(e,r){var o=$(this),l=activeTabId.split("_")[0],d=o.attr("data-siteModule-name"),c=r.value;i=d,!1===c&&(!1===n&&(a=!0),$("h4#meliscore-tool-module-content-title").html(translations.tr_meliscore_module_management_checking_dependencies),$("."+l+"_module_switch").bootstrapSwitch("setActive",!1),$.ajax({type:"POST",url:"/melis/MelisCms/SitesModuleLoader/getDependents",data:{module:d},dataType:"json",encode:!0}).done((function(e){var i="<br/><br/><div class='container'><div class='row'><div class='col-lg-12'><ul>%s</ul></div></div></div>",a="";$.each(e.modules,(function(e,t){a+="<li>"+t+"</li>"})),i=i.replace("%s",a),e.success?melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_nope,translations.tr_meliscms_tool_site_module_load_deactivation_title,e.message+i+translations.tr_melis_cms_sites_module_loading_deactivate_module_with_prerequisites_notice_confirmation,(function(){$.each(e.modules,(function(e,i){t(i,"off")})),s=!0}),(function(){t(d,"off"),s=!0})):t(d,"off"),$("."+l+"_module_switch").bootstrapSwitch("setActive",!0),$("h4#meliscore-tool-module-content-title").html(translations.tr_meliscore_module_management_modules),setTimeout((function(){$("body").find(".confirm-modal-header").addClass("module-modal-dependency-checker")}),200)})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))),!0===c&&(!1===n&&(a=!1),$("h4#meliscore-tool-module-content-title").html(translations.tr_meliscore_module_management_checking_dependencies),$("."+l+"_module_switch").bootstrapSwitch("setActive",!1),$.ajax({type:"POST",url:"/melis/MelisCms/SitesModuleLoader/getRequiredDependencies?siteId="+l,data:{module:d},dataType:"json",encode:!0}).done((function(e){var i="<br/><br/><div class='container'><div class='row'><div class='col-lg-12'><ul>%s</ul></div></div></div>",a="";$.each(e.modules,(function(e,t){a+="<li>"+t+"</li>"})),i=i.replace("%s",a),e.success?melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_nope,translations.tr_meliscms_tool_site_module_load_activation_title,e.message+i+translations.tr_melis_cms_sites_module_loading_activate_module_with_prerequisites_notice_confirmation,(function(){$.each(e.modules,(function(e,i){t(i,"on"),s=!0})),t(d,"on")}),(function(){t(d,"on"),s=!0})):t(d,"on"),$("."+l+"_module_switch").bootstrapSwitch("setActive",!0),$("h4#meliscore-tool-module-content-title").html(translations.tr_meliscore_module_management_modules),setTimeout((function(){$("body").find(".confirm-modal-header").addClass("module-modal-dependency-checker")}),200)})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))),n=!0})),$(document).on("hidden.bs.modal",".module-modal-dependency-checker",(function(){!1===s&&t(i,!0===a?"on":"off"),s=!1,a=!1,i="",n=!1})),window.moduleLoadJsCallback=function(){setOnOff(),$("#not-admin-notice").length>0&&$(".has-switch").bootstrapSwitch("setActive",!1)}}));var sitesTranslationLoadedTblLists=[];$((function(){var e=$("body"),t=0,i="meliscms_tool_sites_site_translations";e.on("change",".transLangFilter",(function(){var e=$(this).parents().eq(6).find("table").attr("id");$("#"+e).DataTable().ajax.reload()})),e.on("click",".mt-tr-refresh",(function(){var e=activeTabId.split("_")[0];melisHelper.zoneReload(e+"_id_meliscms_tool_sites_site_translations",i,{siteId:e},(function(){$("#"+e+"_id_meliscms_tool_sites_site_translations").addClass("active")}))})),e.on("click",".btnEditSiteTranslation",(function(){var e=$(this),t=e.closest("tr").attr("data-lang-id"),i=e.closest("tr").attr("data-site-id"),a=e.closest("tr").find("td:nth-child(2)").text();e.closest("tr").attr("data-mstt-id"),e.closest("tr").attr("data-mst-id");melisHelper.createModal("id_meliscms_tool_sites_site_translations_modal_edit","meliscms_tool_sites_site_translations_modal_edit",!0,{translationKey:a,langId:t,siteId:i},"/melis/MelisCms/SitesTranslation/renderToolSitesSiteTranslationModal")})),e.on("click","#btnDeleteSiteTranslation",(function(e){var t=activeTabId.split("_")[0],a=$(this).closest("tr").attr("data-mst-id"),s=($(this).closest("tr").attr("data-mstt-id"),$(this).closest("tr").attr("data-site-id")),n={};n.mst_id=a,n.siteId=s,0!=a&&""!=a&&melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_melis_site_translation_name,translations.tr_melis_site_translation_delete_confirm,(function(){$.ajax({type:"POST",url:"/melis/MelisCms/SitesTranslation/deleteTranslation",data:$.param(n)}).done((function(e){e.success&&(melisHelper.melisOkNotification(translations.tr_meliscore_common_success,translations.tr_melis_site_translation_delete_success),melisHelper.zoneReload(t+"_id_meliscms_tool_sites_site_translations",i,{siteId:t},(function(){$("#"+t+"_id_meliscms_tool_sites_site_translations").addClass("active")})))}))})),e.preventDefault()})),e.on("click",".btnSaveSiteTranslation",(function(e){var a=activeTabId.split("_")[0],s=$("form[name='sitestranslationform']").serializeArray();$.ajax({type:"POST",url:"/melis/MelisCms/SitesTranslation/saveTranslation",data:$.param(s)}).done((function(e){e.success?(0==t?melisHelper.melisOkNotification(translations.tr_meliscore_common_success,translations.tr_melis_site_translation_inserting_success):melisHelper.melisOkNotification(translations.tr_meliscore_common_success,translations.tr_melis_site_translation_update_success),$("#modal-site-translation").modal("hide"),melisHelper.zoneReload(a+"_id_meliscms_tool_sites_site_translations",i,{siteId:a},(function(){t=0,0,$("#"+a+"_id_meliscms_tool_sites_site_translations").addClass("active")}))):(melisHelper.melisKoNotification(translations.tr_melis_site_translations,translations.tr_melis_site_translation_save_failed,e.errors),$.each(e.langErrorIds,(function(t,i){melisCoreTool.highlightErrors(0,e.errors,i+"_site-translation-form")})))})),e.preventDefault()})),e.on("shown.bs.tab",".sites-tool-tabs a[data-bs-toggle='tab']",(function(){if($(window).width()<=768){var e=$(this).attr("href"),t=(e=e.replace("#","")).replace(/\d+/g,"");if(""!=e){var i=e.split("_");"_id_meliscms_tool_sites_site_translations"==t&&$("#"+i[0]+"_tableMelisSiteTranslation").DataTable().columns.adjust().responsive.recalc()}}}))})),window.siteTransTableCallBack=function(e,t){var i=activeTabId.split("_")[0];$("#"+i+"_tableMelisSiteTranslation tbody tr[data-mst-id='0']").find("#btnDeleteSiteTranslation").remove()},window.initAdditionalTransParam=function(e){var t=activeTabId.split("_")[0];e.site_translation_language_name=$("#"+t+"_siteTranslationLanguageName").val(),e.siteId=t};
