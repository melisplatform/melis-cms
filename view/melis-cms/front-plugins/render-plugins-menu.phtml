<?php
function displayMenuPlugin($moduleName, $pluginName, $pluginConf, $siteModule)
{
    $conf = $pluginConf['melis'];
    if (!empty($conf['thumbnail']))
        $thumbnail = $conf['thumbnail'];
        else
            $thumbnail = '/MelisFront/plugins/images/default.jpg';
            
            if (!empty($conf['name'])) {
                $name = $conf['name'];
            }
            else {
                $name = $pluginName;
            }
            ?>
            <?php
                if(isset($conf['subcategory']['id'])) {
                    $pluginid = $conf['subcategory']['id'];
                    /**
                     * check if plugin is came from the mini template
                     * to remove the thumbnail
                     */
                    if (strpos($pluginid, 'miniTemplatePlugins') !== false) { ?>
                        <div class="melis-cms-plugin-snippets plugins-override-padding" data-module-name="<?= $moduleName; ?>" data-plugin-name="<?= $pluginName; ?>" data-plugin-site-module="<?= $siteModule ?>" title="<?php if (!empty($conf['description'])){ echo $conf['description']; } ?>">
                            <span class="melis-cms-plugin-title plugins-name-override-margin"><?= $name; ?></span>
                        </div>
                    <?php } else { ?>
                        <div class="melis-cms-plugin-snippets" data-module-name="<?= $moduleName; ?>" data-plugin-name="<?= $pluginName; ?>" data-plugin-site-module="<?= $siteModule ?>" title="<?php if (!empty($conf['description'])){ echo $conf['description']; } ?>">
                            <img src="<?= $thumbnail; ?>" alt="">
                            <span class="melis-cms-plugin-title"><?= $name; ?></span>
                        </div>
                    <?php }
                }else{ ?>
                    <div class="melis-cms-plugin-snippets" data-module-name="<?= $moduleName; ?>" data-plugin-name="<?= $pluginName; ?>" data-plugin-site-module="<?= $siteModule ?>" title="<?php if (!empty($conf['description'])){ echo $conf['description']; } ?>">
                        <img src="<?= $thumbnail; ?>" alt="">
                        <span class="melis-cms-plugin-title"><?= $name; ?></span>
                    </div>
               <?php }
            ?>
    	<?php       
    }
?>

<div class="melis-cms-dnd-box">
    <div class="melis-cms-dnd-fix-menu">
        <div class="melis-cms-dnd-title"><?= $this->translate('tr_meliscms_Plugins'); ?></div>
        <div class="melis-cms-plugin-filter-box">
            <?php 
               foreach ($this->pluginsConfig as $moduleName => $pluginList)
               {
                   $sectionTranslated = $this->translate('tr_PluginSection_' . $moduleName);
                   if ($sectionTranslated == 'tr_PluginSection_' . $moduleName)
                       $sectionTranslated = $moduleName;
                   ?>
                    <div class="melis-cms-ps-box">
                        <span class="melis-cms-filter-btn"><?= $sectionTranslated; ?> <i class="fa fa-angle-down"></i></span>
                        <div class="melis-cms-plugin-snippets-box">
                        
                        	<?php 
                        	   
                        	
                        	   if (!empty($pluginList['subcategories']))
                        	   {
                        	       $cpt = 1;
                            	   foreach ($pluginList['subcategories'] as $categoryPluginId => $categoryPlugins)
                            	   {
                        	           if (!empty($categoryPlugins['name']))
                        	               $nameSubCategory = $categoryPlugins['name'];
                        	           else
                        	               $nameSubCategory = $categoryPluginId;
                        	           
                            	       ?>
                        	       		<div class="melis-cms-category-box">
                                       		<span class="melis-cms-category-btn"><?= $nameSubCategory; ?> <i class="fa fa-angle-down"></i></span>
                            	       		<div class="melis-cms-category-plugins-box">
                            	       <?php   

                            	       foreach ($categoryPlugins['plugins'] as $catPluginName => $catPluginConf)
                            	           displayMenuPlugin($moduleName, $catPluginName, $catPluginConf, $this->siteModule);
                            	       
                            	       ?>    
                                            </div>
                            	   		</div>
                            	       <?php    
                            	       
                            	       $cpt++;
                            	   }
                        	   }
                        	   
                               foreach ($pluginList['plugins'] as $pluginName => $pluginConf)
                               {
                                   displayMenuPlugin($moduleName, $pluginName, $pluginConf, $this->siteModule);
                               }
                            ?>
                        </div>  
                    </div>
                   <?php
               }
            ?>
        </div>
    </div>
    <div id="melisPluginBtn">
        <i class="fa fa-plug"></i>
    </div>
</div>


<!--  ======================= tinymce temp CSS ============================= -->
<link rel="stylesheet" href="/MelisCms/css/jquery-ui.css">
<link rel="stylesheet" href="/MelisCms/css/plugin-mini-menu.css">
<link rel="stylesheet" href="/MelisCms/css/dragndrop.css">
<script type="text/javascript" src="/MelisCms/js/dragndrop/jquery-ui.js"></script>
<script type="text/javascript" src="/MelisCms/js/dragndrop/jquery.ui.touch-punch.min.js"></script>
<script type="text/javascript" src="/MelisCms/js/plugins/plugin.sortable.js"></script>
<script type="text/javascript" src="/MelisCms/js/dragndrop/dragndrop.js"></script>